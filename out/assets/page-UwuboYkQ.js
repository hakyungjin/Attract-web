import{u as e,j as s,s as t}from"./index-DMrnIJCM.js";import{e as r,r as n}from"./vendor-DkI5JUVe.js";import{k as i,r as a}from"./kakaoPayService-B3EPZI6U.js";import"./supabase-DEy9n1le.js";function l(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function c(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(s&&s.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),s&&d(e,s)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,s){return(d=Object.setPrototypeOf||function(e,s){return e.__proto__=s,e})(e,s)}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function u(e,s,t){return(u=m()?Reflect.construct:function(e,s,t){var r=[null];r.push.apply(r,s);var n=new(Function.bind.apply(e,r));return t&&d(n,t.prototype),n}).apply(null,arguments)}function x(e){var s="function"==typeof Map?new Map:void 0;return x=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==s){if(s.has(e))return s.get(e);s.set(e,r)}function r(){return u(e,arguments,o(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),d(r,e)},x(e)}function p(e,s){if(s&&("object"==typeof s||"function"==typeof s))return s;if(void 0!==s)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e){var s=m();return function(){var t,r=o(e);if(s){var n=o(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return p(this,t)}}var h=null;function b(e){return window[e]}var j=function(){c(s,x(Error));var e=f(s);function s(t){var r;return l(this,s),(r=e.call(this,"[TossPayments SDK] ".concat(t," is not available"))).name="NamespaceNotAvailableError",r}return s}(),y=function(){c(s,x(Error));var e=f(s);function s(t){var r;return l(this,s),(r=e.call(this,"[TossPayments SDK] Failed to load script: [".concat(t,"]"))).name="ScriptLoadFailedError",r}return s}();function g(e){var s=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).src,t=void 0===s?"https://js.tosspayments.com/v1":s;return"undefined"==typeof window?Promise.resolve({requestPayment:function(){throw new Error("[TossPayments SDK] It looks like runtime is not from browser. This method is only executable on browser.")},requestBillingAuth:function(){throw new Error("[TossPayments SDK] It looks like runtime is not from browser. This method is only executable on browser.")},cancelPayment:function(){throw new Error("[TossPayments SDK] It looks like runtime is not from browser. This method is only executable on browser.")}}):function(e,s){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=h)return h;var r=new Promise(function(r,n){try{var i=function(){null!=b(s)?r(b(s)):n(new j(s))},a=function(){n(new y(e))};if("undefined"==typeof window||"undefined"==typeof document)return r(null);if(null!=b(s))return r(b(s));var l,c=document.querySelector('script[src="'.concat(e,'"]'));null!=c&&(c.removeEventListener("load",i),c.removeEventListener("error",a),null===(l=c.parentElement)||void 0===l||l.removeChild(c));var o=document.createElement("script");o.src=e,o.addEventListener("load",i),o.addEventListener("error",a),null!=t.priority&&(o.fetchPriority=t.priority),document.head.appendChild(o)}catch(d){return void n(d)}});return h=r.catch(function(e){return h=null,Promise.reject(e)})}(t,"TossPayments").then(function(s){return s(e)})}function v(){const l=r(),{user:c}=e(),[o,d]=n.useState(null),[m,u]=n.useState(!1),[x,p]=n.useState("KAKAOPAY"),[f,h]=n.useState(!1),[b,j]=n.useState(null),[y,v]=n.useState([]),[N,w]=n.useState(0),[S,k]=n.useState(!0);n.useEffect(()=>{(async()=>{try{const{data:e,error:s}=await t.from("coin_packages").select("*").order("display_order",{ascending:!0});if(s)v([{id:"basic",coins:50,price:5e3},{id:"standard",coins:100,price:9e3,bonus:10},{id:"premium",coins:300,price:25e3,bonus:50,popular:!0},{id:"vip",coins:500,price:4e4,bonus:100},{id:"mega",coins:1e3,price:75e3,bonus:250},{id:"ultra",coins:2e3,price:14e4,bonus:600}]);else if(e&&e.length>0){const s=e.map(e=>({id:e.id.toString(),name:e.name,coins:e.coins,price:e.price,bonus_coins:e.bonus_coins,bonus:e.bonus_coins,is_popular:e.is_popular,popular:e.is_popular}));v(s)}if(c?.id){const{data:e,error:s}=await t.from("users").select("coins").eq("id",c.id).single();!s&&e&&w(e.coins||0)}}catch(e){}finally{k(!1)}})()},[c]),n.useEffect(()=>{(async()=>{try{const e=await g("test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq");j(e)}catch(e){}})()},[]);return s.jsxs("div",{className:"min-h-screen bg-white",children:[s.jsx("div",{className:"border-b border-gray-100 sticky top-0 z-30 bg-white",children:s.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[s.jsx("button",{onClick:()=>l(-1),className:"w-10 h-10 flex items-center justify-center cursor-pointer",children:s.jsx("i",{className:"ri-arrow-left-line text-2xl text-gray-800"})}),s.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"ìì„ ì¶©ì „"}),s.jsx("div",{className:"w-10"})]})}),s.jsxs("div",{className:"px-5 py-8 text-center border-b border-gray-100",children:[s.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"ë³´ìœ  ìì„"}),s.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[s.jsx("img",{src:"/image/magnet.png",alt:"ìì„",className:"w-8 h-8"}),s.jsx("span",{className:"text-4xl font-bold text-gray-900",children:S?"...":N.toLocaleString()})]})]}),s.jsxs("div",{className:"px-5 py-6",children:[s.jsx("div",{className:"space-y-3",children:y.map(e=>s.jsxs("button",{onClick:()=>(e=>{d(e),u(!0)})(e),className:"w-full flex items-center justify-between p-5 rounded-2xl border-2 transition-all cursor-pointer "+(e.popular?"border-pink-500 bg-pink-50":"border-gray-200 bg-white hover:border-gray-300"),children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center "+(e.popular?"bg-pink-50":"bg-gray-100"),children:s.jsx("img",{src:"/image/magnet.png",alt:"ìì„",className:"w-8 h-8"})}),s.jsxs("div",{className:"text-left",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx("span",{className:"text-2xl font-bold text-gray-900",children:e.coins.toLocaleString()}),(e.bonus||e.bonus_coins)&&s.jsxs("span",{className:"text-sm font-medium text-pink-500",children:["+",e.bonus_coins||e.bonus]})]}),(e.popular||e.is_popular)&&s.jsx("span",{className:"text-xs font-medium text-pink-500",children:"ì¸ê¸°"})]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"text-xl font-bold text-gray-900",children:[e.price.toLocaleString(),"ì›"]})})]},e.id))}),s.jsxs("div",{className:"mt-8 bg-gray-50 rounded-2xl p-5",children:[s.jsxs("h3",{className:"text-base font-bold text-gray-900 mb-4 flex items-center",children:[s.jsx("i",{className:"ri-information-line text-cyan-500 mr-2"}),"ì„œë¹„ìŠ¤ ì´ìš© ì•ˆë‚´"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"ğŸ“… ì„œë¹„ìŠ¤ ì œê³µì¼"}),s.jsxs("ul",{className:"text-xs text-gray-600 space-y-1 ml-4",children:[s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"mr-2",children:"â€¢"}),s.jsx("span",{children:"ê²°ì œ ì™„ë£Œ ì¦‰ì‹œ ìì„ì´ ì¶©ì „ë©ë‹ˆë‹¤"})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"mr-2",children:"â€¢"}),s.jsx("span",{children:"ì¶©ì „ëœ ìì„ì€ ìœ íš¨ê¸°ê°„ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤"})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"ğŸ”„ êµí™˜ ê·œì •"}),s.jsxs("ul",{className:"text-xs text-gray-600 space-y-1 ml-4",children:[s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"mr-2",children:"â€¢"}),s.jsx("span",{children:"ë””ì§€í„¸ ì½˜í…ì¸  íŠ¹ì„±ìƒ êµí™˜ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤"})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"mr-2",children:"â€¢"}),s.jsx("span",{children:"ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë¡œ ë³€ê²½ì„ ì›í•˜ì‹œëŠ” ê²½ìš° í™˜ë¶ˆ í›„ ì¬êµ¬ë§¤ ê°€ëŠ¥í•©ë‹ˆë‹¤"})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"ğŸ’° í™˜ë¶ˆ ê·œì •"}),s.jsxs("ul",{className:"text-xs text-gray-600 space-y-1 ml-4",children:[s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"mr-2",children:"â€¢"}),s.jsx("span",{className:"font-semibold text-pink-600",children:"ê²°ì œ í›„ 7ì¼ ì´ë‚´, ë¯¸ì‚¬ìš© ì‹œ 100% í™˜ë¶ˆ ê°€ëŠ¥"})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"mr-2",children:"â€¢"}),s.jsx("span",{children:"ë¶€ë¶„ ì‚¬ìš©í•œ ê²½ìš° ì‚¬ìš©í•œ ë§Œí¼ ì°¨ê° í›„ í™˜ë¶ˆ"})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"mr-2",children:"â€¢"}),s.jsx("span",{children:"ë³´ë„ˆìŠ¤ ìì„ì€ í™˜ë¶ˆ ê¸ˆì•¡ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤"})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"mr-2",children:"â€¢"}),s.jsx("span",{children:"í™˜ë¶ˆ ìš”ì²­ì€ [ì„¤ì •] â†’ [ê³ ê°ì„¼í„°] â†’ [í™˜ë¶ˆ ì‹ ì²­]ì—ì„œ ê°€ëŠ¥í•©ë‹ˆë‹¤"})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"mr-2",children:"â€¢"}),s.jsx("span",{children:"í™˜ë¶ˆì€ ì˜ì—…ì¼ ê¸°ì¤€ 3~5ì¼ ì†Œìš”ë©ë‹ˆë‹¤"})]})]})]}),s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-3",children:[s.jsxs("h4",{className:"text-xs font-semibold text-yellow-800 mb-2 flex items-center",children:[s.jsx("i",{className:"ri-alert-line mr-1"}),"ì£¼ì˜ì‚¬í•­"]}),s.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1 ml-4",children:[s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"mr-2",children:"â€¢"}),s.jsx("span",{children:"ìì„ êµ¬ë§¤ ì‹œ [ì „ììƒê±°ë˜ë²•]ì— ë”°ë¼ ì²­ì•½ì² íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤"})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"mr-2",children:"â€¢"}),s.jsx("span",{children:"ê²°ì œ ì˜¤ë¥˜ ë°œìƒ ì‹œ ê³ ê°ì„¼í„°ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”"})]})]})]})]})]})]}),m&&o&&s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white w-full max-w-sm rounded-2xl overflow-hidden animate-scale-in shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"ê²°ì œí•˜ê¸°"}),s.jsx("button",{onClick:()=>u(!1),className:"w-8 h-8 flex items-center justify-center cursor-pointer rounded-full hover:bg-gray-100",children:s.jsx("i",{className:"ri-close-line text-xl text-gray-500"})})]}),s.jsxs("div",{className:"p-5",children:[s.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-xl p-4 mb-5",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("img",{src:"/image/magnet.png",alt:"ìì„",className:"w-10 h-10"}),s.jsx("div",{children:s.jsxs("div",{className:"text-xl font-bold text-gray-900",children:[o.coins.toLocaleString(),(o.bonus||o.bonus_coins)&&s.jsxs("span",{className:"text-sm text-pink-500 ml-1",children:["+",o.bonus_coins||o.bonus]})]})})]}),s.jsxs("div",{className:"text-xl font-bold text-gray-900",children:[o.price.toLocaleString(),"ì›"]})]}),s.jsx("button",{onClick:async()=>{if(o){if(!c?.id)return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."),void l("/login");h(!0);try{const e=o.bonus_coins||o.bonus||0,s=o.coins+e,t=`ìì„ ${o.coins}ê°œ${e>0?` (+${e} ë³´ë„ˆìŠ¤)`:""}`;if(localStorage.setItem("selectedPackageId",o.id),localStorage.setItem("selectedCoins",s.toString()),localStorage.setItem("selectedBonusCoins",e.toString()),localStorage.setItem("selectedPackageName",o.name||t),"KAKAOPAY"===x){const s=await i(c.id,{id:o.id,name:t,coins:o.coins,price:o.price,bonus:e});return void(s.success&&s.data?a(s.data):alert(s.error||"ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."))}if(!b)return void alert("ê²°ì œ ì‹œìŠ¤í…œì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");const r=`ORDER_${Date.now()}_${Math.random().toString(36).substring(2,11)}`;await b.requestPayment(x,{amount:o.price,orderId:r,orderName:t,successUrl:`${window.location.origin}/payment/success?orderId=${r}`,failUrl:`${window.location.origin}/payment/fail`,customerName:c.name||"ì‚¬ìš©ì"})}catch(e){alert(e.message||"ê²°ì œ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")}finally{h(!1)}}},disabled:f,className:"w-full bg-yellow-400 text-black py-4 rounded-xl font-bold text-lg hover:bg-yellow-500 transition-all cursor-pointer disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:f?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-5 h-5 border-2 border-black border-t-transparent rounded-full animate-spin"}),s.jsx("span",{children:"ê²°ì œ ì§„í–‰ ì¤‘..."})]}):s.jsx(s.Fragment,{children:s.jsx("span",{className:"font-bold",children:"ì¹´ì¹´ì˜¤í˜ì´"})})}),s.jsx("p",{className:"text-xs text-gray-400 text-center mt-3",children:"ê²°ì œ ì‹œ ì¹´ì¹´ì˜¤í˜ì´ ì•±ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤"})]})]})})]})}export{v as default};
