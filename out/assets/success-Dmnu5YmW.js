import{u as e,j as s,b as t}from"./index-CkhljOBK.js";import{u as a,b as r,r as n}from"./vendor-Dma7sgzX.js";import{getFunctions as l,httpsCallable as c}from"./index.esm-DHxoGJbb.js";function i(){const i=a(),{user:o}=e(),[d]=r(),[m,x]=n.useState(!0),[g,h]=n.useState(null);return n.useEffect(()=>{(async()=>{const e=d.get("pg_token"),s=d.get("orderId"),a=d.get("paymentKey"),r=d.get("amount");if(e)return alert("카카오페이 결제 승인은 아직 구현되지 않았습니다."),void i("/coin-shop");if(!s||!a||!r)return alert("결제 정보가 올바르지 않습니다."),void i("/coin-shop");if(!o?.id)return alert("로그인이 필요합니다."),void i("/login");try{const e=parseInt(localStorage.getItem("selectedCoins")||"0"),n=parseInt(localStorage.getItem("selectedBonusCoins")||"0"),i=localStorage.getItem("selectedPackageId")||"",d=localStorage.getItem("selectedPackageName")||"",m=l(t),g=c(m,"confirmPayment"),p=(await g({orderId:s,paymentKey:a,amount:parseInt(r),userId:o.id,coins:e,bonusCoins:n,packageId:i,packageName:d})).data;if(!p||!p.success)throw new Error(p?.message||"결제 승인에 실패했습니다.");h({orderId:p.data.orderId,amount:p.data.amount,coins:p.data.coins,currentCoins:p.data.currentCoins,approvedAt:p.data.approvedAt}),localStorage.removeItem("selectedPackageId"),localStorage.removeItem("selectedCoins"),localStorage.removeItem("selectedBonusCoins"),localStorage.removeItem("selectedPackageName"),x(!1)}catch(n){const e=n.message||"결제 승인에 실패했습니다.";alert(e),i(`/payment/fail?message=${encodeURIComponent(e)}`)}})()},[d,i,o]),m?s.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"결제를 처리하고 있습니다..."})]})}):s.jsxs("div",{className:"min-h-screen bg-white",children:[s.jsx("div",{className:"border-b border-gray-100 sticky top-0 z-30 bg-white",children:s.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[s.jsx("div",{className:"w-10"}),s.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"결제 완료"}),s.jsx("div",{className:"w-10"})]})}),s.jsxs("div",{className:"flex flex-col items-center justify-center px-5 py-12",children:[s.jsx("div",{className:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6",children:s.jsx("i",{className:"ri-check-line text-5xl text-green-500"})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"결제가 완료되었습니다"}),s.jsx("p",{className:"text-gray-500 mb-8",children:"자석이 충전되었습니다"}),g&&s.jsxs("div",{className:"w-full max-w-md bg-gray-50 rounded-2xl p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center justify-center mb-6 pb-6 border-b border-gray-200",children:[s.jsx("img",{src:"/image/magnet.png",alt:"자석",className:"w-12 h-12 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"충전된 자석"}),s.jsxs("p",{className:"text-3xl font-bold text-pink-500",children:["+",g.coins.toLocaleString()]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"주문번호"}),s.jsx("span",{className:"text-gray-900 font-medium text-sm",children:g.orderId})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"결제금액"}),s.jsxs("span",{className:"text-gray-900 font-bold text-xl",children:[g.amount.toLocaleString(),"원"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"현재 보유 자석"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("img",{src:"/image/magnet.png",alt:"자석",className:"w-5 h-5"}),s.jsx("span",{className:"text-gray-900 font-bold text-lg",children:g.currentCoins?.toLocaleString()||0})]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"결제일시"}),s.jsx("span",{className:"text-gray-900 font-medium",children:new Date(g.approvedAt).toLocaleString("ko-KR")})]})]})]}),s.jsxs("div",{className:"w-full max-w-md space-y-3",children:[s.jsx("button",{onClick:()=>i("/"),className:"w-full bg-gray-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-800 transition-all cursor-pointer",children:"홈으로 돌아가기"}),s.jsx("button",{onClick:()=>i("/coin-shop"),className:"w-full bg-white text-gray-900 py-4 rounded-xl font-bold text-lg border-2 border-gray-200 hover:bg-gray-50 transition-all cursor-pointer",children:"더 충전하기"})]})]})]})}export{i as default};
