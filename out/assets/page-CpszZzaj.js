import{u as e,f as t,j as s,l as a}from"./index-0bpRGtBK.js";import{u as r,r as i}from"./vendor-DiTsd9F_.js";import{s as l}from"./supabase-CdHtCIDc.js";import"./supabase-F6L96wRu.js";function n({coins:a=0}){const l=r(),{user:n}=e(),[o,c]=i.useState(!1),[d,m]=i.useState(0);i.useEffect(()=>{if(!n?.id)return;x();const e=setInterval(x,3e4);return()=>clearInterval(e)},[n?.id]);const x=async()=>{try{if(!n?.id)return void m(0);const{notifications:e,error:s}=await t.notifications.getUserNotifications(n.id);if(!s&&e){const t=e.filter(e=>!e.read);m(t.length)}}catch(e){}};return s.jsxs(s.Fragment,{children:[s.jsx("header",{className:"fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-[400px] glass z-50 transition-all duration-300",style:{paddingTop:"env(safe-area-inset-top)"},children:s.jsxs("div",{className:"flex items-center justify-between px-4 py-1 h-14",children:[s.jsx("div",{className:"flex items-center cursor-pointer",onClick:()=>l("/"),children:s.jsxs("h1",{className:"flex items-center space-x-1 group",children:[s.jsx("div",{className:"relative transform transition-transform group-hover:scale-110 duration-300 -my-2",children:s.jsx("img",{src:"/image/icon.png",alt:"Attract ë§ˆìŠ¤ì½”íŠ¸",className:"w-14 h-14 object-contain drop-shadow-md"})}),s.jsx("span",{className:"text-xl font-bold font-display bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent tracking-tight",children:"Attract"})]})}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{onClick:()=>l("/coin-shop"),className:"group flex items-center gap-1 bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-2 py-1 rounded-full hover:from-blue-600 hover:to-cyan-600 transition-all duration-300 shadow-lg shadow-blue-500/30 hover:shadow-blue-500/50 transform hover:-translate-y-0.5",children:[s.jsx("img",{src:"/image/magnet.png",alt:"ìžì„",className:"w-8 h-8 object-contain group-hover:rotate-12 transition-transform"}),s.jsx("span",{className:"text-sm font-bold font-display pr-1",children:a.toLocaleString()})]}),s.jsxs("button",{onClick:()=>l("/notifications"),className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 transition-colors relative group",children:[s.jsx("i",{className:"ri-notification-line text-slate-600 text-xl group-hover:text-primary-600 transition-colors"}),d>0&&s.jsx("span",{className:"absolute -top-0.5 -right-0.5 bg-red-500 text-white text-[10px] font-bold rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1 border-2 border-white shadow-sm animate-pulse",children:d>9?"9+":d})]}),s.jsx("button",{onClick:()=>c(!o),className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 transition-colors group",children:s.jsx("i",{className:`ri-menu-line text-slate-600 text-xl group-hover:text-primary-600 transition-colors ${o?"rotate-90":""} duration-300`})})]})]})}),o&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-slate-900/20 backdrop-blur-sm z-40 animate-fade-in",onClick:()=>c(!1)}),s.jsxs("div",{className:"fixed top-20 right-4 bg-white/90 backdrop-blur-xl rounded-2xl shadow-2xl py-2 w-56 z-50 animate-slide-up border border-white/20",children:[s.jsxs("div",{className:"px-4 py-3 border-b border-slate-100",children:[s.jsx("p",{className:"text-sm text-slate-500",children:"í™˜ì˜í•©ë‹ˆë‹¤!"}),s.jsxs("p",{className:"font-bold text-slate-800",children:[n?.name||"ì‚¬ìš©ìž","ë‹˜"]})]}),s.jsx("div",{className:"py-2",children:[{icon:"ri-user-line",label:"ë§ˆì´íŽ˜ì´ì§€",action:()=>{c(!1),l("/"),setTimeout(()=>{const e=new CustomEvent("switchTab",{detail:{tab:"profile"}});window.dispatchEvent(e)},100)}},{icon:"ri-settings-line",label:"ì„¤ì •",action:()=>{c(!1),l("/settings")}},{icon:"ri-question-line",label:"FAQ",action:()=>{c(!1),l("/faq")}},{icon:"ri-customer-service-line",label:"1:1ë¬¸ì˜",action:()=>{c(!1),l("/support")}}].map((e,t)=>s.jsxs("button",{onClick:e.action,className:"w-full text-left px-4 py-2.5 hover:bg-primary-50 text-slate-600 hover:text-primary-600 transition-colors flex items-center space-x-3 group",children:[s.jsx("i",{className:`${e.icon} text-lg group-hover:scale-110 transition-transform`}),s.jsx("span",{className:"font-medium",children:e.label})]},t))}),s.jsx("div",{className:"border-t border-slate-100 mt-1 pt-1",children:s.jsxs("button",{onClick:()=>{localStorage.removeItem("auth_user"),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userEmail"),localStorage.removeItem("user_id"),localStorage.removeItem("user_data"),window.location.href="/login"},className:"w-full text-left px-4 py-2.5 hover:bg-red-50 text-red-500 hover:text-red-600 transition-colors flex items-center space-x-3 group",children:[s.jsx("i",{className:"ri-logout-box-line text-lg group-hover:scale-110 transition-transform"}),s.jsx("span",{className:"font-medium",children:"ë¡œê·¸ì•„ì›ƒ"})]})})]})]})]})}function o({activeTab:e,onTabChange:t}){return s.jsx("div",{className:"fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[400px] z-50 bg-white border-t border-gray-200",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:s.jsx("div",{className:"flex items-center justify-around py-2",children:[{id:"matching",icon:"ri-heart-3-line",activeIcon:"ri-heart-3-fill",label:"ë§¤ì¹­"},{id:"community",icon:"ri-group-line",activeIcon:"ri-group-fill",label:"ì»¤ë®¤ë‹ˆí‹°"},{id:"chat",icon:"ri-chat-3-line",activeIcon:"ri-chat-3-fill",label:"ì±„íŒ…"},{id:"profile",icon:"ri-user-line",activeIcon:"ri-user-fill",label:"My"}].map(a=>{const r=e===a.id;return s.jsxs("button",{onClick:()=>t(a.id),className:"flex flex-col items-center justify-center flex-1 py-2 "+(r?"text-primary-600":"text-gray-400"),children:[s.jsx("i",{className:`text-2xl ${r?a.activeIcon:a.icon}`}),s.jsx("span",{className:"text-[10px] font-medium mt-1",children:a.label})]},a.id)})})})}function c(){return s.jsxs("div",{className:"bg-white rounded-3xl overflow-hidden shadow-lg",children:[s.jsx("div",{className:"aspect-[3/4] bg-slate-200 animate-pulse"}),s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"h-6 w-24 bg-slate-200 rounded animate-pulse"}),s.jsx("div",{className:"h-5 w-12 bg-slate-200 rounded-full animate-pulse"})]}),s.jsx("div",{className:"h-4 w-32 bg-slate-200 rounded animate-pulse"}),s.jsx("div",{className:"h-4 w-40 bg-slate-200 rounded animate-pulse"})]})]})}function d(){return s.jsx("div",{className:"grid grid-cols-2 gap-3 px-3 py-4",children:[...Array(4)].map((e,t)=>s.jsx(c,{},t))})}function m(){return s.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-200 animate-pulse"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded animate-pulse"}),s.jsx("div",{className:"h-3 w-32 bg-slate-200 rounded animate-pulse"})]}),s.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-200 animate-pulse"})]}),s.jsxs("div",{className:"mt-3 space-y-2",children:[s.jsx("div",{className:"h-4 w-full bg-slate-200 rounded animate-pulse"}),s.jsx("div",{className:"h-4 w-3/4 bg-slate-200 rounded animate-pulse"})]})]})}function x(){return s.jsx("div",{className:"space-y-3 px-4",children:[...Array(5)].map((e,t)=>s.jsx(m,{},t))})}function h({src:e,alt:t,className:a="",placeholderColor:r="bg-slate-200",...l}){const[n,o]=i.useState(!1),[c,d]=i.useState(!1),[m,x]=i.useState(!1),h=i.useRef(null);i.useEffect(()=>{const e=new IntersectionObserver(([t])=>{t.isIntersecting&&(d(!0),e.disconnect())},{rootMargin:"100px",threshold:.1});return h.current&&e.observe(h.current),()=>e.disconnect()},[]);return s.jsxs("div",{ref:h,className:`relative overflow-hidden ${a}`,children:[!n&&s.jsx("div",{className:`absolute inset-0 ${r} animate-pulse`,children:s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx("i",{className:"ri-image-line text-slate-300 text-3xl"})})}),c&&!m&&s.jsx("img",{src:e,alt:t,onLoad:()=>{o(!0)},onError:()=>{x(!0),o(!0)},className:"w-full h-full object-cover object-top transition-opacity duration-300 "+(n?"opacity-100":"opacity-0"),...l}),m&&s.jsx("div",{className:`absolute inset-0 ${r} flex items-center justify-center`,children:s.jsx("i",{className:"ri-user-line text-slate-400 text-4xl"})})]})}let u={male:[],female:[]},p={male:0,female:0};function f(){const a=r(),{user:l}=e(),[n,o]=i.useState(""),[c,m]=i.useState(!1),[x,f]=i.useState(!1),[g,b]=i.useState(""),[j,v]=i.useState(!0),[y,w]=i.useState([]),[N,k]=i.useState(0),[_,C]=i.useState(!0),S=i.useRef(!1),[I,q]=i.useState(""),[D,E]=i.useState("ì „ì²´");i.useEffect(()=>(document.body.style.overflow=c?"hidden":"",()=>{document.body.style.overflow=""}),[c]),i.useEffect(()=>{(async()=>{if(l?.id)try{const{user:e}=await t.users.getUserById(l.id);e?.gender&&("male"===e.gender?o("female"):"female"===e.gender&&o("male"))}catch(e){}})()},[l?.id]),i.useEffect(()=>{if(!n)return;const e=n,t=Date.now();u[e].length>0&&t-p[e]<3e5?(w(u[e]),v(!1)):S.current||T()},[n]);const T=async(e=!1)=>{if(n&&(!S.current||e)){S.current=!0,v(!0);try{const s=e?N+1:0,{users:a,error:r,totalCount:i}=await t.users.getUsersByGender(n,l?.id,20,void 0);if(r)throw r;if(a){const t=a.filter(e=>!!(e.avatar_url||e.profile_image)).map(e=>{const t=e.avatar_url||e.profile_image||"",s=[];return t&&s.push(t),e.photos&&Array.isArray(e.photos)&&e.photos.forEach(e=>{e&&!s.includes(e)&&s.push(e)}),{id:e.id,name:e.name||"ì•Œ ìˆ˜ ì—†ìŒ",age:e.age||20,gender:e.gender||"ë¬´ê´€",location:e.location||"ìœ„ì¹˜ ë¯¸ì„¤ì •",school:e.school||"í•™êµ ë¯¸ì„¤ì •",mbti:e.mbti||"",character:t,bio:e.bio||"ìžê¸°ì†Œê°œê°€ ì—†ìŠµë‹ˆë‹¤.",hasLikedMe:!1,photos:s,profile_image:t,height:e.height||"",body_type:e.body_type||"",bodyType:e.body_type||"",style:e.style||"",religion:e.religion||"",smoking:e.smoking||"",drinking:e.drinking||"",interests:e.interests||[]}});e?w(e=>[...e,...t]):(w(t),"male"!==n&&"female"!==n||(u[n]=t,p[n]=Date.now())),k(s),C(t.length>=20)}}catch(s){e||w([])}finally{v(!1),S.current=!1}}},L=i.useMemo(()=>y.filter(e=>e.gender===n),[y,n]);return j?s.jsxs("div",{className:"min-h-screen bg-slate-50 pt-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4 px-3",children:[s.jsx("div",{className:"h-7 w-16 bg-slate-200 rounded animate-pulse"}),s.jsx("div",{className:"h-10 w-10 bg-slate-200 rounded-full animate-pulse"})]}),s.jsx(d,{})]}):0===L.length?s.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-50 space-y-4 px-4",children:[s.jsx("i",{className:"ri-search-line text-6xl text-slate-300"}),s.jsx("p",{className:"text-center text-slate-600 font-medium",children:"ì¡°ê±´ì— ë§žëŠ” í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤"})]}):s.jsxs("div",{className:"px-3 pt-2 pb-4 min-h-screen",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"ë§¤ì¹­"}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsx("button",{onClick:()=>{q(n),m(!c)},className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md cursor-pointer hover:shadow-lg transition-all hover:scale-105 group",children:s.jsx("i",{className:"ri-filter-line text-slate-400 group-hover:text-primary-500 text-lg transition-colors"})})})]}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:L.map(e=>s.jsxs("div",{onClick:()=>(e=>{const t={...e,bodyType:e.body_type||e.bodyType};a("/profile-detail",{state:{profile:t}})})(e),className:"bg-white rounded-2xl shadow-lg overflow-hidden cursor-pointer hover:shadow-2xl hover:shadow-primary-500/10 transition-all duration-300 relative group transform hover:-translate-y-1",children:[e.hasLikedMe&&s.jsx("div",{className:"absolute top-3 right-3 w-7 h-7 bg-gradient-to-br from-pink-500 to-rose-500 rounded-full flex items-center justify-center z-10 shadow-lg shadow-pink-500/30 animate-pulse-soft",children:s.jsx("i",{className:"ri-heart-fill text-white text-xs"})}),s.jsxs("div",{className:"absolute top-3 left-3 z-10 flex items-center space-x-1.5",children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center shadow-md "+("female"===e.gender?"bg-gradient-to-br from-pink-400 to-pink-500":"bg-gradient-to-br from-blue-400 to-blue-500"),children:s.jsx("i",{className:"text-xs text-white "+("female"===e.gender?"ri-women-line":"ri-men-line")})}),s.jsx("span",{className:"bg-white/95 text-slate-700 px-2.5 py-1 rounded-full text-[10px] font-bold shadow-md",children:e.mbti||"MBTI"})]}),s.jsxs("div",{className:"relative aspect-[3/4] overflow-hidden bg-slate-100",children:[s.jsx(h,{src:e.character,alt:e.name,className:"w-full h-full"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/90 via-slate-900/30 to-transparent opacity-80"}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3 text-white",children:[s.jsx("h3",{className:"font-bold text-base mb-0.5 truncate",children:e.name}),s.jsxs("div",{className:"flex items-center text-xs text-slate-200 space-x-1",children:[s.jsxs("span",{children:[e.age,"ì„¸"]}),s.jsx("span",{children:"Â·"}),s.jsx("span",{className:"truncate",children:e.location})]}),s.jsxs("div",{className:"flex items-center text-[10px] mt-1.5 text-slate-300 bg-white/10 rounded px-1.5 py-0.5 w-fit backdrop-blur-sm",children:[s.jsx("i",{className:"ri-school-line mr-1"}),s.jsx("span",{className:"truncate max-w-[80px]",children:e.school})]})]})]})]},e.id))}),s.jsx("div",{className:"mt-10 text-center pb-8",children:s.jsxs("button",{onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},className:"bg-white text-slate-600 px-8 py-3 rounded-full font-bold shadow-lg hover:shadow-xl hover:text-primary-600 hover:scale-105 transition-all cursor-pointer whitespace-nowrap flex items-center mx-auto space-x-2",children:[s.jsx("span",{children:"ì¹œêµ¬ ë”ë³´ê¸°"}),s.jsx("i",{className:"ri-arrow-down-s-line"})]})}),c&&s.jsxs("div",{className:"fixed inset-0 z-50 flex justify-center",onClick:()=>m(!1),children:[s.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm animate-fade-in"}),s.jsx("div",{className:"relative w-full max-w-[400px] flex items-start justify-center pt-20",children:s.jsxs("div",{className:"bg-white w-[90%] rounded-3xl p-6 max-h-[70vh] overflow-y-auto shadow-2xl overscroll-contain touch-pan-y animate-slide-up",style:{WebkitOverflowScrolling:"touch"},onClick:e=>e.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h3",{className:"text-xl font-bold font-display text-slate-800",children:"í•„í„°"}),s.jsx("button",{onClick:()=>m(!1),className:"w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-slate-100 rounded-full transition-colors",children:s.jsx("i",{className:"ri-close-line text-2xl text-slate-400"})})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-slate-800 mb-3 text-base",children:"ì„±ë³„"}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("button",{onClick:()=>q("female"),className:"flex-1 py-3 rounded-xl font-bold transition-all cursor-pointer border-2 "+("female"===I?"border-primary-500 bg-primary-50 text-primary-600":"border-slate-100 bg-white text-slate-400 hover:border-slate-200"),children:"ì—¬ìž"}),s.jsx("button",{onClick:()=>q("male"),className:"flex-1 py-3 rounded-xl font-bold transition-all cursor-pointer border-2 "+("male"===I?"border-primary-500 bg-primary-50 text-primary-600":"border-slate-100 bg-white text-slate-400 hover:border-slate-200"),children:"ë‚¨ìž"})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-slate-800 mb-3 text-base",children:"ì§€ì—­"}),s.jsx("div",{className:"grid grid-cols-3 gap-2",children:["ì „ì²´","ì¸ì²œ/ì„œìš¸","ê²½ê¸°/ê°•ì›","ê²½ìƒê¶Œ","ì¶©ì²­ê¶Œ","í˜¸ë‚¨ê¶Œ"].map(e=>s.jsx("button",{onClick:()=>E(e),className:"px-2 py-2.5 rounded-xl text-sm font-medium transition-colors cursor-pointer whitespace-nowrap border "+(D===e?"border-primary-500 bg-primary-50 text-primary-600":"border-slate-100 bg-slate-50 text-slate-600 hover:bg-primary-50 hover:text-primary-600"),children:e},e))})]})]}),s.jsxs("div",{className:"flex space-x-3 mt-8",children:[s.jsx("button",{onClick:()=>{q(n),E("ì „ì²´"),m(!1)},className:"flex-1 py-3 bg-slate-100 text-slate-600 rounded-xl font-bold cursor-pointer hover:bg-slate-200 transition-colors",children:"ë‹«ê¸°"}),s.jsx("button",{onClick:()=>{o(I),m(!1),u={male:[],female:[]},p={male:0,female:0},w([]),k(0),C(!0)},className:"flex-1 py-3 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-xl font-bold cursor-pointer shadow-lg shadow-primary-500/30 hover:shadow-primary-500/50 transition-all",children:"ì ìš©í•˜ê¸°"})]})]})})]}),x&&s.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",children:s.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl animate-slide-up",children:[s.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-slate-100",children:[s.jsx("h3",{className:"text-xl font-bold font-display text-slate-800",children:g}),s.jsx("button",{onClick:()=>f(!1),className:"w-8 h-8 flex items-center justify-center cursor-pointer hover:bg-slate-100 rounded-full transition-colors",children:s.jsx("i",{className:"ri-close-line text-xl text-slate-400"})})]}),s.jsxs("div",{className:"p-5",children:[s.jsx("div",{className:"w-full h-64 bg-slate-100 rounded-2xl overflow-hidden shadow-inner",children:s.jsx("iframe",{src:`https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dO_X0Q&q=${encodeURIComponent(g)}`,width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:`${g} ì§€ë„`})}),s.jsxs("div",{className:"mt-5 space-y-3",children:[s.jsxs("div",{className:"flex items-center text-sm text-slate-600 bg-slate-50 p-3 rounded-xl",children:[s.jsx("i",{className:"ri-map-pin-line text-primary-500 text-lg mr-3"}),s.jsx("span",{className:"font-medium",children:g})]}),s.jsxs("div",{className:"flex items-center text-sm text-slate-600 bg-slate-50 p-3 rounded-xl cursor-pointer hover:bg-primary-50 hover:text-primary-700 transition-colors group",children:[s.jsx("i",{className:"ri-navigation-line text-primary-500 text-lg mr-3 group-hover:scale-110 transition-transform"}),s.jsx("span",{className:"font-medium",children:"ê¸¸ì°¾ê¸°ë¡œ ì´ë™"})]})]}),s.jsx("button",{onClick:()=>f(!1),className:"w-full mt-6 bg-gradient-to-r from-primary-500 to-primary-600 text-white py-4 rounded-2xl font-bold hover:from-primary-600 hover:to-primary-700 transition-all cursor-pointer shadow-lg shadow-primary-500/30",children:"í™•ì¸"})]})]})})]})}function g({post:t,onBack:n,onUpdatePost:o,onDeletePost:c}){const d=r(),{user:m}=e(),[x,h]=i.useState(t),[u,p]=i.useState(""),[f,g]=i.useState(!1);i.useEffect(()=>{window.scrollTo(0,0)},[t]);const b=async()=>{if(u.trim())if(m)try{const e={post_id:x.id,user_id:m.id,author_name:m.name||"ìµëª…",avatar_url:m.profile_image||"",content:u,likes:0},{data:t,error:s}=await l.from("post_comments").insert([e]).select().single();if(s)throw s;if(t){const e={id:t.id,author:t.author_name,avatar:t.avatar_url||"https://readdy.ai/api/search-image?query=Korean%20person%20profile%20avatar%2C%20friendly%20expression%2C%20professional%20portrait%20photography%2C%20soft%20natural%20lighting%2C%20clean%20white%20background%2C%20high%20quality%2C%20realistic&width=100&height=100&seq=myavatar&orientation=squarish",content:t.content,timeAgo:"ë°©ê¸ˆ ì „",likes:0,isLiked:!1},s={...x,comments:[...x.comments,e]};h(s),o(s),p("")}}catch(e){a.error("ëŒ“ê¸€ ìž‘ì„± ì˜¤ë¥˜",e),alert("ëŒ“ê¸€ ìž‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}else alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.")};return s.jsxs("div",{className:"min-h-screen bg-white pb-32",children:[s.jsxs("div",{className:"sticky top-0 z-40 bg-white flex items-center px-4 h-14 border-b border-gray-100",children:[s.jsx("button",{onClick:n,className:"mr-4",children:s.jsx("i",{className:"ri-arrow-left-line text-2xl text-gray-800"})}),s.jsx("h1",{className:"text-lg font-bold text-gray-800 flex-1 text-center mr-8",children:"ê²Œì‹œê¸€"})]}),s.jsxs("div",{className:"bg-white",children:[s.jsxs("div",{className:"px-4 py-4",children:[s.jsxs("div",{className:"flex items-center mb-3",children:[s.jsx("img",{src:x.avatar,alt:x.author,className:"w-10 h-10 rounded-full object-cover mr-3 flex-shrink-0 border border-gray-100 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{if(x.userId!==m?.id)if(x.authorData){const e=x.authorData.avatar_url||x.authorData.profile_image;d("/profile-detail",{state:{profile:{id:x.authorData.id,name:x.authorData.name,age:x.authorData.age,gender:x.authorData.gender,location:x.authorData.location,school:x.authorData.school,mbti:x.authorData.mbti,bio:x.authorData.bio,photos:e?[e]:[],interests:x.authorData.interests||[],height:x.authorData.height,bodyType:x.authorData.body_type,religion:x.authorData.religion,smoking:x.authorData.smoking,drinking:x.authorData.drinking}}})}else x.userId&&(async e=>{try{const{data:t,error:s}=await l.from("users").select("*").eq("id",e).single();if(s)throw s;t&&d("/profile-detail",{state:{profile:{id:t.id,name:t.name,age:t.age,gender:t.gender,location:t.location,school:t.school,mbti:t.mbti,bio:t.bio,photos:t.profile_image?[t.profile_image]:[],interests:t.interests||[],height:t.height,bodyType:t.body_type,religion:t.religion,smoking:t.smoking,drinking:t.drinking}}})}catch(t){a.error("í”„ë¡œí•„ ë¡œë“œ ì‹¤íŒ¨",t),alert("í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}})(x.userId);else d("/my-profile")}}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-bold text-gray-900 text-sm truncate",children:x.author}),s.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:x.timeAgo})]}),x.userId===m?.id&&s.jsx("button",{onClick:async()=>{if(x.userId===m?.id){if(window.confirm("ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){g(!0);try{const{error:e}=await l.from("community_posts").delete().eq("id",x.id);if(e)throw e;c&&c(x.id),alert("ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),n()}catch(e){a.error("ê²Œì‹œê¸€ ì‚­ì œ ì˜¤ë¥˜",e),alert("ê²Œì‹œê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{g(!1)}}}else alert("ìžì‹ ì˜ ê²Œì‹œê¸€ë§Œ ì‚­ì œí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.")},disabled:f,className:"text-gray-400 p-2 -mr-2",children:s.jsx("i",{className:`ri-${f?"loader-4-line animate-spin":"more-fill"} text-xl`})})]}),s.jsx("p",{className:"text-sm text-gray-800 whitespace-pre-wrap leading-relaxed",children:x.content})]}),x.image&&s.jsx("div",{className:"w-full mb-2",children:s.jsx("img",{src:x.image,alt:"ê²Œì‹œê¸€ ì´ë¯¸ì§€",className:"w-full h-auto object-cover"})}),s.jsxs("div",{className:"px-4 py-3 flex items-center gap-4 border-b border-gray-50",children:[s.jsxs("button",{onClick:async()=>{const e=x.isLiked?x.likes-1:x.likes+1,t={...x,isLiked:!x.isLiked,likes:e};h(t),o(t);try{await l.from("community_posts").update({likes:e}).eq("id",x.id)}catch(s){a.error("ì¢‹ì•„ìš” ì—…ë°ì´íŠ¸ ì˜¤ë¥˜",s)}},className:"flex items-center gap-1.5 transition-colors",children:[s.jsx("i",{className:(x.isLiked?"ri-heart-fill text-pink-500":"ri-heart-line text-gray-400")+" text-xl"}),s.jsx("span",{className:"text-sm text-gray-600",children:x.likes})]}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("i",{className:"ri-chat-3-line text-xl text-gray-400"}),s.jsx("span",{className:"text-sm text-gray-600",children:"ëŒ“ê¸€"})]})]})]}),s.jsxs("div",{className:"px-4 py-4",children:[s.jsxs("div",{className:"font-bold text-sm mb-4",children:["ëŒ“ê¸€ ",x.comments.length]}),0===x.comments.length?s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-300",children:[s.jsx("i",{className:"ri-chat-3-line text-4xl mb-2 opacity-50"}),s.jsx("p",{className:"text-sm",children:"ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!"})]}):s.jsx("div",{className:"space-y-5",children:x.comments.map(e=>s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("img",{src:e.avatar,alt:e.author,className:"w-8 h-8 rounded-full object-cover flex-shrink-0 border border-gray-100"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("span",{className:"text-sm font-bold text-gray-900",children:e.author}),s.jsx("span",{className:"text-xs text-gray-400",children:e.timeAgo})]}),s.jsx("p",{className:"text-sm text-gray-700 leading-relaxed break-words",children:e.content}),s.jsxs("button",{onClick:()=>(async e=>{const t=x.comments.find(t=>t.id===e);if(!t)return;const s=t.isLiked?t.likes-1:t.likes+1,r={...x,comments:x.comments.map(t=>t.id===e?{...t,isLiked:!t.isLiked,likes:s}:t)};h(r),o(r);try{await l.from("post_comments").update({likes:s}).eq("id",e)}catch(i){a.error("ëŒ“ê¸€ ì¢‹ì•„ìš” ì—…ë°ì´íŠ¸ ì˜¤ë¥˜",i)}})(e.id),className:"text-xs mt-1.5 flex items-center gap-1 "+(e.isLiked?"text-pink-500":"text-gray-400"),children:[s.jsx("i",{className:e.isLiked?"ri-heart-fill":"ri-heart-line"}),s.jsxs("span",{children:["ì¢‹ì•„ìš” ",e.likes>0&&e.likes]})]})]})]},e.id))})]}),s.jsxs("div",{className:"fixed left-1/2 -translate-x-1/2 w-full max-w-[400px] bg-white border-t border-gray-100 px-4 py-3 flex items-center gap-3 z-40",style:{bottom:"calc(80px + env(safe-area-inset-bottom, 0px))"},children:[s.jsx("img",{src:m?.profile_image||"https://via.placeholder.com/100",alt:"ë‚´ í”„ë¡œí•„",className:"w-8 h-8 rounded-full object-cover border border-gray-100 flex-shrink-0"}),s.jsxs("div",{className:"flex-1 relative",children:[s.jsx("input",{value:u,onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),b())},placeholder:"ëŒ“ê¸€ì„ ìž…ë ¥í•˜ì„¸ìš”...",className:"w-full bg-gray-100 rounded-full pl-4 pr-10 py-2.5 text-sm focus:outline-none focus:ring-1 focus:ring-gray-200 transition-shadow"}),s.jsx("button",{onClick:b,disabled:!u.trim(),className:"absolute right-1.5 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-full transition-colors "+(u.trim()?"text-primary-500 hover:bg-gray-200":"text-gray-300"),children:s.jsx("i",{className:"ri-send-plane-fill text-lg"})})]})]})]})}let b=null,j=0;function v(){const e=r(),[t,a]=i.useState("dating"),[n,o]=i.useState(b||[]),[c,d]=i.useState(""),[m,h]=i.useState(!1),[u,p]=i.useState(null),[f,v]=i.useState(!b),[y,w]=i.useState(void 0),[N,k]=i.useState(!1),[_,C]=i.useState("latest"),S=i.useRef(!1);i.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("auth_user");if(t)try{const e=JSON.parse(t);return void w(e)}catch(e){}const{data:{user:s}}=await l.auth.getUser();if(s){w(s);try{const{data:e,error:t}=await l.from("users").select("*").eq("id",s.id).single();!t&&e&&w({...s,profile:e})}catch(e){}}else w(null)}catch(e){w(null)}})()},[]),i.useEffect(()=>{const e=Date.now();b&&e-j<3e5?(o(b),v(!1)):S.current||I()},[]);const I=async()=>{if(!S.current){S.current=!0,v(!0);try{const e=new Promise((e,t)=>setTimeout(()=>t(new Error("Timeout")),5e3)),t=l.from("community_posts").select("\n          *,\n          post_comments (\n            id,\n            author_name,\n            avatar_url,\n            content,\n            likes,\n            created_at\n          )\n        ").order("created_at",{ascending:!1}),{data:s,error:a}=await Promise.race([t,e]);if(a)throw a;if(!(s&&s.length>0))throw new Error("No data");{let e=[];if(y){const{data:t}=await l.from("community_post_likes").select("post_id").eq("user_id",y.id);e=t?.map(e=>e.post_id)||[]}const t=[...new Set(s.map(e=>e.user_id).filter(Boolean))];let a={};if(t.length>0){const{data:e}=await l.from("users").select("id, name, avatar_url, profile_image, age, location, gender, bio, school, job").in("id",t);e&&e.forEach(e=>{a[e.id]=e})}const r=s.map(t=>{const s=a[t.user_id],r=s?.name||t.author_name||"ìµëª…",i=s?.avatar_url||s?.profile_image||t.avatar_url||"https://via.placeholder.com/100";return{id:t.id,author:r,avatar:i,content:t.content,image:t.image_url,likes:t.likes,comments:t.post_comments?.map(e=>({id:e.id,author:e.author_name,avatar:e.avatar_url||"https://via.placeholder.com/100",content:e.content,timeAgo:q(e.created_at),likes:e.likes,isLiked:!1}))||[],timeAgo:q(t.created_at),isLiked:e.includes(t.id),age:s?.age||t.age,location:s?.location||t.location,job:s?.job||t.job,views:t.views,category:t.category,userId:t.user_id,authorData:s?{id:s.id,name:s.name||"ìµëª…",avatar_url:s.avatar_url||s.profile_image,age:s.age,location:s.location,gender:s.gender,bio:s.bio,school:s.school,job:s.job}:{id:t.user_id,name:t.author_name||"ìµëª…",avatar_url:t.avatar_url,age:t.age,location:t.location,gender:t.gender,bio:t.bio,school:t.school,job:t.job}}});b=r,j=Date.now(),o(r)}}catch(e){o([])}finally{v(!1),S.current=!1}}},q=e=>{const t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/6e4);if(a<1)return"ë°©ê¸ˆ ì „";if(a<60)return`${a}ë¶„ ì „`;const r=Math.floor(a/60);if(r<24)return`${r}ì‹œê°„ ì „`;return`${Math.floor(r/24)}ì¼ ì „`},D=()=>{p(null),window.scrollTo(0,0)},E=e=>{o(n.map(t=>t.id===e.id?e:t))},T=i.useMemo(()=>{const e=n.filter(e=>e.category===t);return"latest"===_?e:[...e].sort((e,t)=>(t.views||0)-(e.views||0))},[n,t,_]);return u?s.jsx(g,{post:u,onBack:D,onUpdatePost:E,onDeletePost:e=>{o(n.filter(t=>t.id!==e)),p(null)}}):s.jsxs("div",{className:"px-4 py-4 pb-20 min-h-screen",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-bold font-display text-slate-800 whitespace-nowrap",children:"ì»¤ë®¤ë‹ˆí‹°"}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("button",{onClick:()=>C("latest"),className:"px-3 py-1.5 text-xs font-medium rounded-lg transition-all cursor-pointer "+("latest"===_?"bg-cyan-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"ìµœì‹ ìˆœ"}),s.jsx("button",{onClick:()=>C("views"),className:"px-3 py-1.5 text-xs font-medium rounded-lg transition-all cursor-pointer "+("views"===_?"bg-cyan-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"ì¡°íšŒìˆœ"})]})]}),s.jsxs("div",{className:"flex space-x-3 mb-6 overflow-x-auto pb-2 scrollbar-hide",children:[s.jsx("button",{onClick:()=>a("dating"),className:"px-5 py-2.5 rounded-full text-sm font-bold whitespace-nowrap cursor-pointer transition-all duration-300 "+("dating"===t?"bg-gradient-to-r from-primary-500 to-primary-600 text-white shadow-lg shadow-primary-500/30 scale-105":"bg-white text-slate-500 hover:bg-slate-50 border border-slate-100"),children:"ì…€í”„ì†Œê°œíŒ…"}),s.jsx("button",{onClick:()=>a("chat"),className:"px-5 py-2.5 rounded-full text-sm font-bold whitespace-nowrap cursor-pointer transition-all duration-300 "+("chat"===t?"bg-gradient-to-r from-primary-500 to-primary-600 text-white shadow-lg shadow-primary-500/30 scale-105":"bg-white text-slate-500 hover:bg-slate-50 border border-slate-100"),children:"ìž¡ë‹´"})]}),s.jsxs("div",{className:"flex space-x-2 mb-6",children:[s.jsx("button",{className:"px-4 py-1.5 bg-primary-50 text-primary-600 rounded-full text-xs font-bold whitespace-nowrap cursor-pointer border border-primary-100",children:"ì¶”ì²œìˆœ"}),s.jsx("button",{className:"px-4 py-1.5 bg-white text-slate-400 rounded-full text-xs font-medium whitespace-nowrap cursor-pointer hover:bg-slate-50 border border-transparent hover:border-slate-100 transition-colors",children:"ìµœì‹ ìˆœ"})]}),f?s.jsx(x,{}):s.jsx("div",{className:"space-y-3",children:T.map(e=>s.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden cursor-pointer hover:shadow-lg hover:border-primary-100 transition-all duration-300",onClick:()=>(async e=>{if(localStorage.getItem("auth_user")){try{await l.from("community_posts").update({views:(e.views||0)+1}).eq("id",e.id),o(n.map(t=>t.id===e.id?{...t,views:(t.views||0)+1}:t))}catch(t){}p(e)}else k(!0)})(e),children:s.jsxs("div",{className:"flex p-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("div",{className:"w-16 h-16 rounded-full p-0.5 bg-gradient-to-br from-pink-400 to-pink-500",children:s.jsx("img",{src:e.avatar,alt:e.author,className:"w-full h-full rounded-full object-cover border-2 border-white",onError:e=>{e.target.src="https://via.placeholder.com/100"}})})}),s.jsxs("div",{className:"flex-1 ml-3 min-w-0",children:[s.jsx("h3",{className:"text-[15px] font-bold text-slate-800 line-clamp-1 mb-1",children:e.content.split("\n")[0]}),s.jsxs("p",{className:"text-sm text-slate-500 mb-2",children:[e.author," (",e.location||"ìœ„ì¹˜ ë¯¸ì„¤ì •"," / ",e.age||"?","ì„¸ / ",e.job||"ì§ì—… ë¯¸ì„¤ì •",")"]}),s.jsxs("div",{className:"flex items-center space-x-3 text-xs text-slate-400",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("i",{className:"ri-eye-line"}),s.jsx("span",{children:e.views||0})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("i",{className:"ri-chat-3-line"}),s.jsx("span",{children:e.comments.length})]}),s.jsx("span",{children:"|"}),s.jsx("span",{children:e.timeAgo})]})]}),e.image&&s.jsx("div",{className:"flex-shrink-0 ml-3",children:s.jsx("div",{className:"w-16 h-16 rounded-xl overflow-hidden",children:s.jsx("img",{src:e.image,alt:"ê²Œì‹œë¬¼ ì´ë¯¸ì§€",className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}})})})]})},e.id))}),s.jsx("button",{onClick:()=>e("/post/create"),className:"fixed bottom-24 right-6 w-14 h-14 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-full shadow-lg shadow-primary-500/40 flex items-center justify-center hover:from-primary-600 hover:to-primary-700 hover:scale-110 transition-all cursor-pointer z-30 group",children:s.jsx("i",{className:"ri-add-line text-2xl group-hover:rotate-90 transition-transform duration-300"})}),m&&s.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-end animate-fade-in",children:s.jsxs("div",{className:"bg-white w-full rounded-t-[2rem] p-6 animate-slide-up shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h3",{className:"text-xl font-bold font-display text-slate-800",children:"ìƒˆ ê¸€ ìž‘ì„±"}),s.jsx("button",{onClick:()=>h(!1),className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 transition-colors cursor-pointer",children:s.jsx("i",{className:"ri-close-line text-xl text-slate-400"})})]}),s.jsx("textarea",{value:c,onChange:e=>d(e.target.value),placeholder:"ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê³  ìžˆë‚˜ìš”?",className:"w-full px-5 py-4 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm resize-none bg-slate-50 placeholder-slate-400 transition-all",rows:5,maxLength:500}),s.jsxs("div",{className:"flex justify-between items-center mt-4",children:[s.jsxs("span",{className:"text-xs font-medium text-slate-400",children:[c.length,"/500"]}),s.jsx("button",{onClick:async()=>{if(c.trim())if(y)try{const e={user_id:y.id,author_name:y.profile?.name||"ìµëª…",avatar_url:y.profile?.avatar_url||"",title:c.substring(0,50),content:`${y.profile?.name||"ìµëª…"} (${y.profile?.location||"ìœ„ì¹˜ ë¯¸ì„¤ì •"} / ${y.profile?.age||"ë‚˜ì´ ë¯¸ì„¤ì •"}ì„¸ / ${y.profile?.school||"ì§ì—… ë¯¸ì„¤ì •"})`,image_url:y.profile?.avatar_url||"https://readdy.ai/api/search-image?query=Korean%20person%20casual%20portrait%2C%20friendly%20expression%2C%20natural%20lighting%2C%20clean%20background%2C%20high%20quality%2C%20realistic&width=400&height=500&seq=newpost&orientation=portrait",likes:0,views:0,category:t,age:y.profile?.age,location:y.profile?.location,job:y.profile?.school},{data:s,error:a}=await l.from("community_posts").insert([e]).select().single();if(a)throw a;if(s){const e={id:s.id,author:s.title,avatar:s.avatar_url,content:s.content,image:s.image_url,likes:0,comments:[],timeAgo:"ë°©ê¸ˆ ì „",isLiked:!1,age:s.age,location:s.location,job:s.job,views:0,category:s.category};o([e,...n]),d(""),h(!1)}}catch(e){alert("ê²Œì‹œê¸€ ìž‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}else alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.")},className:"px-6 py-2.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-full hover:from-primary-600 hover:to-primary-700 transition-all cursor-pointer whitespace-nowrap text-sm font-bold shadow-lg shadow-primary-500/30",children:"ê²Œì‹œí•˜ê¸°"})]})]})}),N&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-md",onClick:()=>k(!1)}),s.jsxs("div",{className:"relative bg-white rounded-3xl p-8 max-w-sm w-full mx-4 text-center shadow-2xl",children:[s.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("i",{className:"ri-lock-line text-3xl text-primary-500"})}),s.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤"}),s.jsx("p",{className:"text-slate-500 text-sm mb-6",children:"ê²Œì‹œê¸€ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”"}),s.jsx("button",{onClick:()=>e("/login"),className:"w-full bg-gradient-to-r from-primary-500 to-primary-600 text-white py-3 rounded-2xl font-bold hover:from-primary-600 hover:to-primary-700 transition-all",children:"ë¡œê·¸ì¸í•˜ê¸°"})]})]})]})}const y=e=>"male"===e?"https://readdy.ai/api/search-image?query=minimalist%20male%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=male-default-avatar&orientation=squarish":"https://readdy.ai/api/search-image?query=minimalist%20female%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=female-default-avatar&orientation=squarish";function w({onChatViewChange:t}){const a=r(),{user:l}=e(),[n,o]=i.useState(null),[c,d]=i.useState(""),m=i.useRef(null),[x,h]=i.useState([]),[u,p]=i.useState([]),[f,g]=i.useState(!0),[b,j]=i.useState(!1),[v,w]=i.useState(!1);i.useEffect(()=>{t?.(!!n)},[n,t]),i.useEffect(()=>{n&&m.current&&m.current.scrollIntoView({behavior:"smooth"})},[u,n]),i.useEffect(()=>{const e=()=>{n&&(o(null),p([]))};return n&&window.history.pushState({chatRoom:!0},""),window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[n]),i.useEffect(()=>{if(!l?.id)return;N();const e=supabase.channel("chat-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{N(),n&&e.new.room_id===n.roomId&&k(n.roomId)}).subscribe(),t=supabase.channel("chat-rooms").on("postgres_changes",{event:"*",schema:"public",table:"chat_rooms"},()=>{N()}).subscribe();return()=>{e.unsubscribe(),t.unsubscribe()}},[l?.id,n]);const N=async()=>{if(l?.id)try{g(!0);const e=String(l.id),{data:t,error:s}=await supabase.from("chat_rooms").select("\n          id,\n          user1_id,\n          user2_id,\n          last_message,\n          last_message_at,\n          last_message_sender_id,\n          is_active,\n          created_at\n        ").or(`user1_id.eq.${e},user2_id.eq.${e}`).eq("is_active",!0).order("last_message_at",{ascending:!1,nullsFirst:!1});if(s)return void h([]);if(!t||0===t.length)return void h([]);const a=t.map(t=>t.user1_id===e?t.user2_id:t.user1_id),{data:r}=await supabase.from("users").select("id, name, profile_image, gender").in("id",a),i=new Map((r||[]).map(e=>[e.id,e])),n=await Promise.all(t.map(async t=>{const s=t.user1_id===e?t.user2_id:t.user1_id,a=i.get(s),{count:r}=await supabase.from("messages").select("*",{count:"exact",head:!0}).eq("room_id",t.id).eq("recipient_id",l.id).eq("is_read",!1);return{roomId:t.id,partnerId:s,partnerName:a?.name||"ì‚¬ìš©ìž",partnerAvatar:a?.profile_image||y(a?.gender),partnerGender:a?.gender,lastMessage:t.last_message||"ëŒ€í™”ë¥¼ ì‹œìž‘í•´ë³´ì„¸ìš”!",lastMessageTime:t.last_message_at?new Date(t.last_message_at).toLocaleTimeString("ko-KR",{hour:"numeric",minute:"2-digit",hour12:!0}):"ë°©ê¸ˆ ì „",unreadCount:r||0}}));h(n)}catch(e){h([])}finally{g(!1)}},k=async e=>{if(l?.id)try{const{data:t,error:s}=await supabase.from("messages").select("id, sender_id, content, created_at, is_read").eq("room_id",e).order("created_at",{ascending:!0});if(s)return;if(t){const s=t.map(e=>({id:e.id,senderId:e.sender_id,content:e.content,timestamp:new Date(e.created_at).toLocaleTimeString("ko-KR",{hour:"numeric",minute:"2-digit",hour12:!0}),isRead:e.is_read}));p(s),await supabase.from("messages").update({is_read:!0}).eq("room_id",e).eq("recipient_id",l.id).eq("is_read",!1)}}catch(t){}},_=async e=>{try{const{data:t,error:s}=await supabase.from("users").select("*").eq("id",e).single();if(s)throw s;a("/profile-detail",{state:{profile:{id:t.id,name:t.name,age:t.age,gender:t.gender,location:t.location,school:t.school,mbti:t.mbti,bio:t.bio,photos:t.profile_image?[t.profile_image]:[],interests:t.interests||[],height:t.height,bodyType:t.body_type,style:t.style,religion:t.religion,smoking:t.smoking,drinking:t.drinking,isMatched:!0}}})}catch(t){alert("í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},C=async()=>{if(n){w(!0);try{await supabase.from("messages").delete().eq("room_id",n.roomId);const{error:e}=await supabase.from("chat_rooms").delete().eq("id",n.roomId);if(e)throw e;h(e=>e.filter(e=>e.roomId!==n.roomId)),o(null),p([]),j(!1),alert("ì±„íŒ…ë°©ì„ ë‚˜ê°”ìŠµë‹ˆë‹¤.")}catch(e){alert("ì±„íŒ…ë°© ë‚˜ê°€ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{w(!1)}}},S=async()=>{if(c.trim()&&n&&l?.id)try{const{error:e}=await supabase.from("messages").insert({room_id:n.roomId,sender_id:String(l.id),recipient_id:String(n.partnerId),content:c,is_read:!1}).select().single();if(e)throw e;d(""),k(n.roomId)}catch(e){alert(`ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: ${e.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`)}},I=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())},q=()=>{o(null),p([]),window.history.replaceState(null,"")};return n?s.jsx("div",{className:"fixed inset-0 z-50 flex justify-center bg-slate-100",children:s.jsxs("div",{className:"w-full max-w-[400px] bg-white flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-100 bg-white flex-shrink-0",style:{paddingTop:"max(12px, env(safe-area-inset-top))"},children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:q,className:"w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-slate-100 rounded-full transition-colors",children:s.jsx("i",{className:"ri-arrow-left-line text-xl text-slate-600"})}),s.jsxs("button",{onClick:()=>_(n.partnerId),className:"flex items-center space-x-3 cursor-pointer hover:opacity-80 transition-opacity",children:[s.jsx("img",{src:n.partnerAvatar||y(n.partnerGender),alt:n.partnerName,className:"w-10 h-10 rounded-full object-cover object-top shadow-sm",onError:e=>{e.target.src=y(n.partnerGender)}}),s.jsxs("div",{className:"text-left",children:[s.jsx("h3",{className:"font-bold text-slate-800",children:n.partnerName}),s.jsx("span",{className:"text-[10px] text-slate-400",children:"í”„ë¡œí•„ ë³´ê¸° â†’"})]})]})]}),s.jsx("button",{onClick:()=>j(!0),className:"w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-red-50 rounded-full transition-colors text-slate-400 hover:text-red-500",children:s.jsx("i",{className:"ri-logout-box-r-line text-xl"})})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50",children:[0===u.length?s.jsxs("div",{className:"text-center py-16",children:[s.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("i",{className:"ri-chat-smile-2-line text-3xl text-slate-400"})}),s.jsx("p",{className:"text-slate-500 text-sm",children:"ì²« ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë³´ì„¸ìš”! ðŸ’¬"})]}):u.map(e=>s.jsx("div",{className:"flex "+(e.senderId===l?.id?"justify-end":"justify-start"),children:s.jsxs("div",{className:"flex items-end space-x-2 max-w-[75%] "+(e.senderId!==l?.id?"flex-row":"flex-row-reverse space-x-reverse"),children:[e.senderId!==l?.id&&s.jsx("button",{onClick:()=>_(n.partnerId),className:"flex-shrink-0",children:s.jsx("img",{src:n.partnerAvatar||y(n.partnerGender),alt:n.partnerName,className:"w-8 h-8 rounded-full object-cover object-top shadow-sm mb-1 cursor-pointer hover:opacity-80 transition-opacity",onError:e=>{e.target.src=y(n.partnerGender)}})}),s.jsxs("div",{className:"flex flex-col",children:[e.senderId!==l?.id&&s.jsx("span",{className:"text-xs text-slate-400 mb-1 ml-1",children:n.partnerName}),s.jsxs("div",{className:"flex items-end space-x-1",children:[e.senderId===l?.id&&s.jsx("span",{className:"text-[10px] text-slate-400 mb-1",children:e.timestamp}),s.jsx("div",{className:"px-4 py-2.5 rounded-2xl shadow-sm "+(e.senderId===l?.id?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-br-sm":"bg-white text-slate-700 rounded-bl-sm border border-slate-100"),children:s.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:e.content})}),e.senderId!==l?.id&&s.jsx("span",{className:"text-[10px] text-slate-400 mb-1",children:e.timestamp})]})]})]})},e.id)),s.jsx("div",{ref:m})]}),s.jsx("div",{className:"px-4 pt-3 bg-white border-t border-slate-100 flex-shrink-0",style:{paddingBottom:"calc(12px + env(safe-area-inset-bottom, 12px))"},children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),onKeyPress:I,placeholder:"ë©”ì‹œì§€ë¥¼ ìž…ë ¥í•˜ì„¸ìš”...",className:"flex-1 px-4 py-2.5 bg-slate-100 rounded-full focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:bg-white transition-all text-sm",maxLength:500}),s.jsx("button",{onClick:S,disabled:!c.trim(),className:"w-10 h-10 rounded-full flex items-center justify-center transition-all cursor-pointer flex-shrink-0 "+(c.trim()?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white hover:scale-105 shadow-md":"bg-slate-200 text-slate-400 cursor-not-allowed"),children:s.jsx("i",{className:"ri-send-plane-fill text-base"})})]})}),b&&s.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-sm p-6",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("i",{className:"ri-logout-box-r-line text-3xl text-red-500"})}),s.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:"ì±„íŒ…ë°© ë‚˜ê°€ê¸°"}),s.jsxs("p",{className:"text-sm text-slate-500",children:["ì±„íŒ…ë°©ì„ ë‚˜ê°€ë©´ ëª¨ë“  ëŒ€í™” ë‚´ìš©ì´ ì‚­ì œë©ë‹ˆë‹¤.",s.jsx("br",{}),"ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?"]})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("button",{onClick:()=>j(!1),className:"flex-1 py-3 bg-slate-100 text-slate-600 rounded-xl font-medium",disabled:v,children:"ì·¨ì†Œ"}),s.jsx("button",{onClick:C,disabled:v,className:"flex-1 py-3 bg-red-500 text-white rounded-xl font-medium disabled:opacity-50",children:v?"ë‚˜ê°€ëŠ” ì¤‘...":"ë‚˜ê°€ê¸°"})]})]})})]})}):s.jsxs("div",{className:"min-h-screen px-5 pt-2",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"ì±„íŒ…"}),s.jsx("button",{onClick:N,className:"w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-slate-400 hover:text-cyan-500 hover:shadow-md transition-all",children:s.jsx("i",{className:"ri-refresh-line text-xl"})})]}),f?s.jsx("div",{className:"space-y-4",children:[1,2,3].map(e=>s.jsx("div",{className:"bg-white rounded-2xl p-4 animate-pulse",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-14 h-14 rounded-full bg-slate-200"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"h-4 bg-slate-200 rounded w-24 mb-2"}),s.jsx("div",{className:"h-3 bg-slate-100 rounded w-40"})]})]})},e))}):x.length>0?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider px-1 mb-3",children:["ë§¤ì¹­ëœ ëŒ€í™” (",x.length,")"]}),x.map(e=>s.jsx("div",{onClick:()=>(e=>{o(e),k(e.roomId)})(e),className:"bg-white rounded-2xl p-4 shadow-sm hover:shadow-md transition-all cursor-pointer border border-slate-100 active:scale-[0.98]",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"relative flex-shrink-0",children:[s.jsx("img",{src:e.partnerAvatar||y(e.partnerGender),alt:e.partnerName,className:"w-14 h-14 rounded-full object-cover object-top shadow-sm",onError:t=>{t.target.src=y(e.partnerGender)}}),e.unreadCount>0&&s.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center",children:e.unreadCount})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("h3",{className:"font-bold text-slate-800 truncate",children:e.partnerName}),s.jsx("span",{className:"text-[11px] text-slate-400 flex-shrink-0 ml-2",children:e.lastMessageTime})]}),s.jsx("p",{className:"text-sm truncate "+(e.unreadCount>0?"text-slate-800 font-medium":"text-slate-500"),children:e.lastMessage})]}),s.jsx("i",{className:"ri-arrow-right-s-line text-slate-300 text-xl"})]})},e.roomId))]}):s.jsxs("div",{className:"text-center py-20",children:[s.jsx("div",{className:"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx("i",{className:"ri-chat-3-line text-4xl text-slate-300"})}),s.jsx("h3",{className:"text-xl font-bold text-slate-700 mb-2",children:"ì•„ì§ ì±„íŒ…ì´ ì—†ì–´ìš”"}),s.jsx("p",{className:"text-slate-500 mb-2",children:"ë§¤ì¹­ì´ ì„±ì‚¬ë˜ë©´ ì±„íŒ…ì„ ì‹œìž‘í•  ìˆ˜ ìžˆì–´ìš”!"}),s.jsxs("p",{className:"text-xs text-slate-400",children:["ë§¤ì¹­ íƒ­ì—ì„œ ë§ˆìŒì— ë“œëŠ” ìƒëŒ€ì—ê²Œ",s.jsx("br",{}),"í•˜íŠ¸ë¥¼ ë³´ë‚´ë³´ì„¸ìš” ðŸ’•"]})]})]})}function N({unit:e,width:t=320,height:a=100,className:r=""}){const l=i.useRef(null),n=i.useRef(!1);return i.useEffect(()=>{if(!e)return;if(n.current)return;const t=document.createElement("script");t.src="https://t1.daumcdn.net/kas/static/ba.min.js",t.async=!0,t.onload=()=>{n.current=!0,l.current&&(l.current.style.display="block")},t.onerror=()=>{};return document.querySelector('script[src="https://t1.daumcdn.net/kas/static/ba.min.js"]')?(n.current=!0,l.current&&(l.current.style.display="block")):document.head.appendChild(t),()=>{l.current&&(l.current.innerHTML="")}},[e]),e?s.jsx("div",{className:`flex justify-center ${r}`,children:s.jsx("ins",{ref:l,className:"kakao_ad_area",style:{display:"none",width:`${t}px`,height:`${a}px`},"data-ad-unit":e,"data-ad-width":t.toString(),"data-ad-height":a.toString()})}):null}const k=e=>"ë‚¨ìž"===e||"male"===e?"https://readdy.ai/api/search-image?query=minimalist%20male%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=male-default-avatar&orientation=squarish":"https://readdy.ai/api/search-image?query=minimalist%20female%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=female-default-avatar&orientation=squarish";function _(){const a=r(),{user:l}=e(),[n,o]=i.useState({name:"ì‚¬ìš©ìž",age:0,gender:"ì—¬ìž",location:"ìœ„ì¹˜ ë¯¸ì„¤ì •",avatar:"",bio:"",interests:[]}),[c,d]=i.useState({received:0,sent:0}),[m,x]=i.useState(!0);i.useEffect(()=>{h(),u()},[l?.id]);const h=async()=>{try{if(!l?.id)return void x(!1);const{user:e,error:s}=await t.users.getUserById(l.id);if(s)return void x(!1);e&&o({name:e.name||"ì‚¬ìš©ìž",age:e.age||0,gender:"male"===e.gender?"ë‚¨ìž":"ì—¬ìž",location:e.location||"ìœ„ì¹˜ ë¯¸ì„¤ì •",avatar:e.avatar_url||e.profile_image||"",bio:e.bio||"",interests:e.interests||[]})}catch(e){}finally{x(!1)}},u=async()=>{try{if(!l?.id)return;const{requests:e}=await t.matching.getReceivedRequests(l.id,"pending"),{requests:s}=await t.matching.getSentRequests(l.id,"pending");d({received:e.length||0,sent:s.length||0})}catch(e){}};if(m)return s.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-50 space-y-4",children:[s.jsxs("div",{className:"relative w-16 h-16",children:[s.jsx("div",{className:"absolute inset-0 border-4 border-slate-200 rounded-full"}),s.jsx("div",{className:"absolute inset-0 border-4 border-primary-500 border-t-transparent rounded-full animate-spin"})]}),s.jsx("div",{className:"text-sm font-medium text-slate-500",children:"í”„ë¡œí•„ ë¡œë“œ ì¤‘..."})]});const p=()=>{a("/profile-edit")},f=()=>{a("/matching-requests")};return s.jsx("div",{className:"px-4 py-6 pb-20 min-h-screen",children:s.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-[2rem] shadow-lg shadow-primary-500/5 p-8 animate-slide-up relative overflow-hidden group",children:[s.jsx("div",{className:"absolute top-0 left-0 w-full h-32 bg-gradient-to-br from-primary-100 to-secondary-100 opacity-50"}),s.jsxs("div",{className:"relative text-center",children:[s.jsxs("div",{className:"relative inline-block mb-4",children:[s.jsx("div",{className:"p-1 bg-white rounded-full shadow-lg",children:s.jsx("img",{src:n.avatar||k(n.gender),alt:n.name,className:"w-28 h-28 rounded-full object-cover group-hover:scale-105 transition-transform duration-500",onError:e=>{e.target.src=k(n.gender)}})}),s.jsx("button",{onClick:p,className:"absolute bottom-2 right-2 w-9 h-9 bg-slate-800 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-black transition-colors cursor-pointer hover:scale-110 transform duration-300 border-2 border-white",children:s.jsx("i",{className:"ri-camera-line text-lg"})})]}),s.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-1 font-display",children:n.name}),s.jsxs("p",{className:"text-slate-500 mb-4 font-medium",children:[n.age,"ì„¸ Â· ",n.location]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("button",{onClick:p,className:"w-full bg-slate-800 text-white py-3 rounded-2xl font-bold hover:bg-black transition-all cursor-pointer whitespace-nowrap shadow-lg shadow-slate-200 hover:shadow-xl transform hover:-translate-y-0.5",children:"í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°"}),s.jsxs("button",{onClick:()=>a("/my-profile"),className:"w-full bg-gradient-to-r from-primary-500 to-secondary-500 text-white py-3 rounded-2xl font-bold hover:from-primary-600 hover:to-secondary-600 transition-all cursor-pointer whitespace-nowrap flex items-center justify-center gap-2",children:[s.jsx("i",{className:"ri-eye-line"}),"ë‚´ í”„ë¡œí•„ ë¯¸ë¦¬ë³´ê¸°"]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-[2rem] shadow-lg shadow-primary-500/5 p-6 animate-slide-up",style:{animationDelay:"0.1s"},children:[s.jsxs("div",{className:"flex items-center justify-between mb-5",children:[s.jsx("h3",{className:"font-bold text-lg text-slate-800 font-display",children:"ë§¤ì¹­ í˜„í™©"}),s.jsx("button",{onClick:f,className:"text-primary-500 text-sm font-medium hover:text-primary-600 cursor-pointer",children:"ì „ì²´ë³´ê¸°"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{onClick:f,className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-2xl p-4 cursor-pointer hover:shadow-md transition-all",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm",children:s.jsx("i",{className:"ri-heart-fill text-pink-500 text-xl"})}),s.jsx("span",{className:"text-2xl font-bold text-pink-600",children:c.received})]}),s.jsx("div",{className:"text-sm font-bold text-pink-700",children:"ë°›ì€ ìš”ì²­"}),s.jsx("div",{className:"text-xs text-pink-500 mt-0.5",children:"ìƒˆë¡œìš´ ê´€ì‹¬ í‘œì‹œ"})]}),s.jsxs("div",{onClick:f,className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-4 cursor-pointer hover:shadow-md transition-all",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm",children:s.jsx("i",{className:"ri-send-plane-fill text-blue-500 text-xl"})}),s.jsx("span",{className:"text-2xl font-bold text-blue-600",children:c.sent})]}),s.jsx("div",{className:"text-sm font-bold text-blue-700",children:"ë³´ë‚¸ ìš”ì²­"}),s.jsx("div",{className:"text-xs text-blue-500 mt-0.5",children:"ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­"})]})]})]}),s.jsx("div",{className:"animate-slide-up",style:{animationDelay:"0.2s"},children:s.jsx(N,{unit:"DAN-xzcTogwnUXAFXJ7t",width:320,height:100,className:"mx-auto"})}),s.jsx("div",{className:"animate-slide-up",style:{animationDelay:"0.25s"},children:s.jsx(N,{unit:"DAN-VPAvNk4a33lBM3D8",width:320,height:100,className:"mx-auto"})}),s.jsx("div",{className:"bg-white rounded-[2rem] shadow-lg shadow-primary-500/5 p-4 animate-slide-up",style:{animationDelay:"0.3s"},children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("button",{onClick:()=>a("/settings"),className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-2xl transition-all cursor-pointer group",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center group-hover:bg-blue-100 transition-colors",children:s.jsx("i",{className:"ri-settings-3-line text-blue-500 text-xl"})}),s.jsx("span",{className:"font-bold text-slate-700 group-hover:text-slate-900",children:"ì„¤ì •"})]}),s.jsx("i",{className:"ri-arrow-right-s-line text-slate-300 group-hover:text-slate-500 text-xl transition-colors"})]}),s.jsxs("button",{onClick:()=>alert("ê°œì¸ì •ë³´ ë³´í˜¸ ì •ì±… íŽ˜ì´ì§€ ì¤€ë¹„ì¤‘ìž…ë‹ˆë‹¤."),className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-2xl transition-all cursor-pointer group",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-full flex items-center justify-center group-hover:bg-green-100 transition-colors",children:s.jsx("i",{className:"ri-shield-check-line text-green-500 text-xl"})}),s.jsx("span",{className:"font-bold text-slate-700 group-hover:text-slate-900",children:"ê°œì¸ì •ë³´ ë³´í˜¸"})]}),s.jsx("i",{className:"ri-arrow-right-s-line text-slate-300 group-hover:text-slate-500 text-xl transition-colors"})]}),s.jsxs("button",{onClick:()=>a("/support"),className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-2xl transition-all cursor-pointer group",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-full flex items-center justify-center group-hover:bg-purple-100 transition-colors",children:s.jsx("i",{className:"ri-question-line text-purple-500 text-xl"})}),s.jsx("span",{className:"font-bold text-slate-700 group-hover:text-slate-900",children:"ê³ ê°ì„¼í„°"})]}),s.jsx("i",{className:"ri-arrow-right-s-line text-slate-300 group-hover:text-slate-500 text-xl transition-colors"})]})]})})]})})}function C(){const t=r(),{user:a,loading:l}=e(),[c,d]=i.useState("matching"),[m]=i.useState(150),[x,h]=i.useState(!1),u=i.useCallback(e=>{d(e),window.scrollTo({top:0,behavior:"smooth"})},[]);if(i.useEffect(()=>{if(!l){const e=localStorage.getItem("user");a||e||t("/login")}},[l,a,t]),l)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"ë¡œë”© ì¤‘..."})]})});return s.jsxs("div",{className:"min-h-screen bg-slate-50",children:[!x&&s.jsx(n,{coins:m}),s.jsx("main",{className:x?"":"pb-28",style:x?{}:{paddingTop:"calc(5rem + env(safe-area-inset-top))"},children:(()=>{switch(c){case"matching":default:return s.jsx(f,{});case"community":return s.jsx(v,{});case"chat":return s.jsx(w,{onChatViewChange:h});case"profile":return s.jsx(_,{})}})()}),!x&&s.jsx(o,{activeTab:c,onTabChange:u})]})}export{C as default};
