import{j as e}from"./index-MGgYOwZh.js";import{d as s,f as t,r as a}from"./vendor-DxrR1XxW.js";import"./supabase-DKAQY1gD.js";function r(){const r=s(),[n]=t(),[l,c]=a.useState(!0),[i,o]=a.useState(null);return a.useEffect(()=>{(async()=>{const e=n.get("orderId"),s=n.get("paymentKey"),t=n.get("amount");if(!e||!s||!t)return alert("결제 정보가 올바르지 않습니다."),void r("/coin-shop");try{const a=parseInt(localStorage.getItem("selectedCoins")||"0"),r=localStorage.getItem("userId")||"temp-user-id",n=await fetch("http://localhost:3001/api/payment/confirm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,paymentKey:s,amount:parseInt(t),userId:r,coins:a})}),l=await n.json();if(!n.ok||!l.success)throw new Error(l.message||"결제 승인에 실패했습니다.");o({orderId:l.data.orderId,amount:l.data.amount,coins:l.data.coins,currentCoins:l.data.currentCoins,approvedAt:l.data.approvedAt}),localStorage.removeItem("selectedPackageId"),localStorage.removeItem("selectedCoins"),c(!1)}catch(a){const e=a.message||"결제 승인에 실패했습니다.";alert(e),r(`/payment/fail?message=${encodeURIComponent(e)}`)}})()},[n,r]),l?e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"결제를 처리하고 있습니다..."})]})}):e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"border-b border-gray-100 sticky top-0 z-30 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("div",{className:"w-10"}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"결제 완료"}),e.jsx("div",{className:"w-10"})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center px-5 py-12",children:[e.jsx("div",{className:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6",children:e.jsx("i",{className:"ri-check-line text-5xl text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"결제가 완료되었습니다"}),e.jsx("p",{className:"text-gray-500 mb-8",children:"자석이 충전되었습니다"}),i&&e.jsxs("div",{className:"w-full max-w-md bg-gray-50 rounded-2xl p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center mb-6 pb-6 border-b border-gray-200",children:[e.jsx("img",{src:"/images/magnet.png",alt:"자석",className:"w-12 h-12 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"충전된 자석"}),e.jsxs("p",{className:"text-3xl font-bold text-pink-500",children:["+",i.coins.toLocaleString()]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"주문번호"}),e.jsx("span",{className:"text-gray-900 font-medium text-sm",children:i.orderId})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"결제금액"}),e.jsxs("span",{className:"text-gray-900 font-bold text-xl",children:[i.amount.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"현재 보유 자석"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("img",{src:"/images/magnet.png",alt:"자석",className:"w-5 h-5"}),e.jsx("span",{className:"text-gray-900 font-bold text-lg",children:i.currentCoins?.toLocaleString()||0})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"결제일시"}),e.jsx("span",{className:"text-gray-900 font-medium",children:new Date(i.approvedAt).toLocaleString("ko-KR")})]})]})]}),e.jsxs("div",{className:"w-full max-w-md space-y-3",children:[e.jsx("button",{onClick:()=>r("/"),className:"w-full bg-gray-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-800 transition-all cursor-pointer",children:"홈으로 돌아가기"}),e.jsx("button",{onClick:()=>r("/coin-shop"),className:"w-full bg-white text-gray-900 py-4 rounded-xl font-bold text-lg border-2 border-gray-200 hover:bg-gray-50 transition-all cursor-pointer",children:"더 충전하기"})]})]})]})}export{r as default};
