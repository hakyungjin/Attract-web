import{u as e,j as t,s}from"./index-MGgYOwZh.js";import{d as a,r}from"./vendor-DxrR1XxW.js";import"./supabase-DKAQY1gD.js";const i=e=>"남자"===e?"https://readdy.ai/api/search-image?query=minimalist%20male%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=male-default-avatar&orientation=squarish":"https://readdy.ai/api/search-image?query=minimalist%20female%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=female-default-avatar&orientation=squarish";function l(){const l=a(),{user:n}=e(),[o,c]=r.useState({nickname:"",name:"",age:20,gender:"여자",location:"",bio:"",mbti:"",school:"",height:"160~165",bodyType:"보통",style:"캐주얼",religion:"무교",smoking:"비흡연",drinking:"가끔",interests:[],avatar:"",photos:[]}),[d,m]=r.useState(""),[x,g]=r.useState(!1),[h,u]=r.useState(!1),[p,b]=r.useState(""),[f,y]=r.useState(!0);r.useEffect(()=>{(async()=>{if(n?.id)try{const{data:e,error:t}=await s.from("users").select("*").eq("id",n.id).single();if(t)return void y(!1);if(e){const t=e.profile_image||"";b(""),c({nickname:e.name||"",name:e.name||"",age:e.age||20,gender:"female"===e.gender?"여자":"남자",location:e.location||"",bio:e.bio||"",mbti:e.mbti||"",school:e.school||"",height:e.height||"160~165",bodyType:e.body_type||"보통",style:e.style||"캐주얼",religion:e.religion||"무교",smoking:e.smoking||"비흡연",drinking:e.drinking||"가끔",interests:e.interests||[],avatar:t,photos:e.photos||(t?[t]:[])})}}catch(e){}finally{y(!1)}else y(!1)})()},[n?.id]);const j=()=>{l(-1)},N=(e,t)=>{c(s=>({...s,[e]:t}))},v=()=>{d.trim()&&!o.interests.includes(d.trim())&&(c(e=>({...e,interests:[...e.interests,d.trim()]})),m(""))};return n?f?t.jsx("div",{className:"min-h-screen bg-cyan-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"프로필 정보를 불러오는 중..."})]})}):t.jsxs("div",{className:"min-h-screen bg-cyan-50 pb-20",children:[t.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:t.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[t.jsx("button",{onClick:j,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors cursor-pointer",children:t.jsx("i",{className:"ri-arrow-left-line text-xl"})}),t.jsx("h1",{className:"text-lg font-bold",children:"프로필 수정"}),t.jsx("button",{onClick:async()=>{if(!n?.id)return alert("로그인이 필요합니다."),void l("/login");u(!0);try{const e={name:o.name,age:o.age,gender:"여자"===o.gender?"female":"male",location:o.location,bio:o.bio,mbti:o.mbti,school:o.school,job:o.name,height:o.height,body_type:o.bodyType,style:o.style,religion:o.religion,smoking:o.smoking,drinking:o.drinking,interests:o.interests,profile_image:p||o.avatar||o.photos[0]||"",photos:o.photos,updated_at:(new Date).toISOString()},{error:t}=await s.from("users").update(e).eq("id",n.id);if(t)return alert("프로필 저장에 실패했습니다."),void u(!1);const a=localStorage.getItem("auth_user");if(a){const e={...JSON.parse(a),name:o.name,profile_image:p||o.avatar};localStorage.setItem("auth_user",JSON.stringify(e))}g(!0)}catch(e){alert("프로필 저장에 실패했습니다.")}finally{u(!1)}},disabled:h,className:"font-medium cursor-pointer whitespace-nowrap "+(h?"text-gray-400":"text-cyan-500"),children:h?"저장 중...":"저장"})]})}),t.jsxs("div",{className:"px-4 py-6 max-w-md mx-auto",children:[t.jsx("div",{className:"bg-white rounded-3xl shadow-sm p-6 mb-4",children:t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"relative inline-block mb-4",children:[h&&t.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center z-10",children:t.jsx("i",{className:"ri-loader-4-line text-white text-2xl animate-spin"})}),t.jsx("img",{src:o.avatar||i(o.gender),alt:"프로필",className:"w-24 h-24 rounded-full object-cover",onError:e=>{e.target.src=i(o.gender)}}),t.jsx("input",{type:"file",id:"avatar-upload",accept:"image/*",onChange:async e=>{const t=e.target.files?.[0];if(!t)return;if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(t.type))return void alert("JPG, PNG, WEBP, GIF 형식의 이미지만 업로드 가능합니다.");if(t.size>5242880)alert("이미지 크기는 5MB 이하여야 합니다.");else{u(!0);try{const e=`profile_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,{error:a,data:r}=await s.storage.from("profile-images").upload(e,t,{cacheControl:"3600",upsert:!1});if(a){let e=a.message||"이미지 업로드에 실패했습니다.";throw e.includes("Bucket not found")?e='⚠️ Supabase Storage가 제대로 설정되지 않았습니다.\n관리자에게 문의해주세요.\n\n기술 정보: "user-profiles" bucket이 없습니다.':(e.includes("401")||e.includes("Unauthorized"))&&(e="⚠️ 인증 오류: Supabase 설정을 확인해주세요."),new Error(e)}b(`${"https://ytffobltrwkgxiedorsd.supabase.co"}/storage/v1/object/public/profile-images/${e}`);const i=new FileReader;i.onloadend=()=>{c(e=>({...e,avatar:i.result}))},i.readAsDataURL(t)}catch(a){alert(a.message||"이미지 업로드에 실패했습니다.")}finally{u(!1)}}},disabled:h,className:"hidden"}),t.jsx("label",{htmlFor:"avatar-upload",className:"absolute bottom-0 right-0 w-8 h-8 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-full flex items-center justify-center shadow-lg transition-all "+(h?"opacity-50 cursor-not-allowed":"hover:from-cyan-600 hover:to-blue-700 cursor-pointer"),children:t.jsx("i",{className:"ri-camera-line"})})]}),t.jsx("p",{className:"text-sm text-gray-500",children:"대표 프로필 사진"})]})}),t.jsxs("div",{className:"bg-white rounded-3xl shadow-sm p-6 mb-4",children:[t.jsxs("h3",{className:"font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx("i",{className:"ri-gallery-line mr-2 text-cyan-500"}),"내 사진 (",o.photos.length,"/",6,")"]}),t.jsxs("p",{className:"text-xs text-gray-500 mb-4",children:["최대 ",6,"장까지 업로드 가능합니다. 첫 번째 사진이 대표 사진이 됩니다."]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[o.photos.map((e,s)=>t.jsxs("div",{className:"relative aspect-square rounded-xl overflow-hidden group",children:[t.jsx("img",{src:e,alt:`사진 ${s+1}`,className:"w-full h-full object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:t.jsx("button",{onClick:()=>{const e=o.photos.filter((e,t)=>t!==s);c({...o,photos:e})},className:"w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600",children:t.jsx("i",{className:"ri-delete-bin-line"})})}),0===s&&t.jsx("div",{className:"absolute top-1 left-1 bg-cyan-500 text-white text-[10px] px-1.5 py-0.5 rounded",children:"대표"})]},s)),o.photos.length<6&&t.jsxs("label",{className:"aspect-square rounded-xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center cursor-pointer hover:border-cyan-500 hover:bg-cyan-50 transition-colors",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files?.[0];if(t){u(!0);try{const e=t.name.split(".").pop(),a=`profile-photos/${`${n?.id}_${Date.now()}.${e}`}`,{error:r}=await s.storage.from("profiles").upload(a,t);if(r)throw r;const{data:{publicUrl:i}}=s.storage.from("profiles").getPublicUrl(a);c(e=>({...e,photos:[...e.photos,i],avatar:0===e.photos.length?i:e.avatar}))}catch(a){alert("사진 업로드에 실패했습니다.")}finally{u(!1)}}},className:"hidden"}),t.jsx("i",{className:"ri-add-line text-2xl text-gray-400"}),t.jsx("span",{className:"text-xs text-gray-400 mt-1",children:"추가"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-3xl shadow-sm p-6 mb-4",children:[t.jsxs("h3",{className:"font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx("i",{className:"ri-user-line mr-2 text-cyan-500"}),"기본 정보"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이름"}),t.jsx("input",{type:"text",value:o.name,onChange:e=>c({...o,name:e.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent",placeholder:"이름을 입력하세요"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"나이"}),t.jsx("input",{type:"number",value:o.age,onChange:e=>c({...o,age:parseInt(e.target.value)}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent",placeholder:"나이를 입력하세요"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["성별 ",t.jsx("span",{className:"text-xs text-gray-400",children:"(변경 불가)"})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("div",{className:"flex-1 py-3 rounded-xl font-medium text-center "+("여자"===o.gender?"bg-gradient-to-r from-pink-400 to-pink-500 text-white":"bg-gray-100 text-gray-400"),children:"여자"}),t.jsx("div",{className:"flex-1 py-3 rounded-xl font-medium text-center "+("남자"===o.gender?"bg-gradient-to-r from-blue-400 to-blue-500 text-white":"bg-gray-100 text-gray-400"),children:"남자"})]}),t.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:[t.jsx("i",{className:"ri-information-line mr-1"}),"성별은 회원가입 시 설정한 후 변경할 수 없습니다"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"지역"}),t.jsx("input",{type:"text",value:o.location,onChange:e=>c({...o,location:e.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent",placeholder:"지역을 입력하세요"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-3xl shadow-sm p-6 mb-4",children:[t.jsxs("h3",{className:"font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx("i",{className:"ri-file-list-3-line mr-2 text-cyan-500"}),"상세 정보"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"학교"}),t.jsx("input",{type:"text",value:o.school,onChange:e=>N("school",e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent",placeholder:"학교를 입력하세요"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"키 (cm)"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:["150~155","155~160","160~165","165~170","170~175","175~180","180~185","185~190"].map(e=>t.jsx("button",{onClick:()=>N("height",e),className:"py-2 px-3 rounded-xl text-sm font-medium transition-colors cursor-pointer whitespace-nowrap "+(o.height===e?"bg-gradient-to-r from-cyan-500 to-blue-600 text-white":"bg-gray-100 text-gray-600"),children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"체형"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:["마른","보통","통통","근육질","건장한"].map(e=>t.jsx("button",{onClick:()=>N("bodyType",e),className:"py-2 px-3 rounded-xl text-sm font-medium transition-colors cursor-pointer whitespace-nowrap "+(o.bodyType===e?"bg-gradient-to-r from-cyan-500 to-blue-600 text-white":"bg-gray-100 text-gray-600"),children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"스타일"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:["캐주얼","스포티","모던","클래식","스트릿","페미닌"].map(e=>t.jsx("button",{onClick:()=>N("style",e),className:"py-2 px-3 rounded-xl text-sm font-medium transition-colors cursor-pointer whitespace-nowrap "+(o.style===e?"bg-gradient-to-r from-cyan-500 to-blue-600 text-white":"bg-gray-100 text-gray-600"),children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"종교"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:["무교","기독교","천주교","불교","원불교","기타"].map(e=>t.jsx("button",{onClick:()=>N("religion",e),className:"py-2 px-3 rounded-xl text-sm font-medium transition-colors cursor-pointer whitespace-nowrap "+(o.religion===e?"bg-gradient-to-r from-cyan-500 to-blue-600 text-white":"bg-gray-100 text-gray-600"),children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"MBTI"}),t.jsx("input",{type:"text",value:o.mbti,onChange:e=>N("mbti",e.target.value.toUpperCase()),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent uppercase",placeholder:"MBTI를 입력하세요 (예: ENFP)",maxLength:4})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"흡연"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["비흡연","흡연"].map(e=>t.jsx("button",{onClick:()=>N("smoking",e),className:"py-2 px-3 rounded-xl text-sm font-medium transition-colors cursor-pointer whitespace-nowrap "+(o.smoking===e?"bg-gradient-to-r from-cyan-500 to-blue-600 text-white":"bg-gray-100 text-gray-600"),children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"음주"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:["안 마심","가끔","자주","매일"].map(e=>t.jsx("button",{onClick:()=>N("drinking",e),className:"py-2 px-3 rounded-xl text-sm font-medium transition-colors cursor-pointer whitespace-nowrap "+(o.drinking===e?"bg-gradient-to-r from-cyan-500 to-blue-600 text-white":"bg-gray-100 text-gray-600"),children:e},e))})]})]})]}),t.jsxs("div",{className:"bg-white rounded-3xl shadow-sm p-6 mb-4",children:[t.jsxs("h3",{className:"font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx("i",{className:"ri-chat-smile-2-line mr-2 text-cyan-500"}),"자기소개"]}),t.jsx("textarea",{value:o.bio,onChange:e=>c({...o,bio:e.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent resize-none",rows:4,placeholder:"자신을 소개해주세요",maxLength:500}),t.jsxs("div",{className:"text-right text-xs text-gray-400 mt-2",children:[o.bio.length,"/500"]})]}),t.jsxs("div",{className:"bg-white rounded-3xl shadow-sm p-6",children:[t.jsxs("h3",{className:"font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx("i",{className:"ri-heart-line mr-2 text-cyan-500"}),"관심사"]}),t.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:o.interests.map((e,s)=>t.jsxs("span",{className:"bg-cyan-50 text-cyan-700 px-4 py-2 rounded-full text-sm flex items-center space-x-2",children:[t.jsx("span",{children:e}),t.jsx("button",{onClick:()=>(e=>{c(t=>({...t,interests:t.interests.filter(t=>t!==e)}))})(e),className:"w-4 h-4 flex items-center justify-center hover:bg-cyan-200 rounded-full transition-colors cursor-pointer",children:t.jsx("i",{className:"ri-close-line text-xs"})})]},s))}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("input",{type:"text",value:d,onChange:e=>m(e.target.value),onKeyPress:e=>"Enter"===e.key&&v(),className:"flex-1 px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent",placeholder:"관심사 추가"}),t.jsx("button",{onClick:v,className:"px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-xl font-medium hover:from-cyan-600 hover:to-blue-700 transition-all cursor-pointer whitespace-nowrap",children:"추가"})]})]})]}),x&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm w-full text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx("i",{className:"ri-check-line text-white text-2xl"})}),t.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"저장 완료!"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"프로필이 성공적으로 업데이트되었습니다."}),t.jsx("button",{onClick:()=>{g(!1),j()},className:"w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white py-3 rounded-full font-medium hover:from-cyan-600 hover:to-blue-700 transition-all cursor-pointer whitespace-nowrap",children:"확인"})]})})]}):t.jsx("div",{className:"min-h-screen bg-cyan-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"로그인이 필요합니다"}),t.jsx("p",{className:"text-gray-600 mb-8",children:"프로필을 수정하려면 먼저 로그인해주세요."}),t.jsx("button",{onClick:()=>l("/login"),className:"px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-semibold hover:from-cyan-600 hover:to-blue-600 transition-all cursor-pointer",children:"로그인하기"})]})})}export{l as default};
