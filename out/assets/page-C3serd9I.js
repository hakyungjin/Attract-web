import{u as e,j as s,f as l,l as a}from"./index-CkhljOBK.js";import{u as o,a as t,r}from"./vendor-Dma7sgzX.js";import{u as n}from"./imageUpload-D9qqtnFs.js";import{M as i}from"./mbti-Cb-19GtP.js";import{K as c,g as d,s as x}from"./schools-BXrPHggY.js";function u(){const u=o(),m=t(),{setUser:h}=e(),[b,p]=r.useState({phone_number:"",name:"",age:20,gender:"male",location:"",bio:"",mbti:"",school:"",job:"",height:"160~165",body_type:"보통",style:"캐주얼",religion:"무교",smoking:"비흡연",drinking:"가끔",interests:[],profile_image:""}),[g,y]=r.useState(""),[f,j]=r.useState(!1),[v,N]=r.useState(""),[w,k]=r.useState(!1),[_,C]=r.useState(""),[S,U]=r.useState(""),[q,z]=r.useState([]);r.useEffect(()=>{const e=m.state?.phoneNumber;if(e){(async()=>{const{user:s}=await l.users.findUserByPhoneNumber(e);s&&p(e=>({...e,phone_number:s.phone_number,name:s.name,age:s.age||20,gender:s.gender||"male",location:s.location||"",bio:s.bio||"",mbti:s.mbti||"",school:s.school||"",job:s.job||""}))})()}},[m]);const B=()=>{g.trim()&&!b.interests.includes(g)&&(p(e=>({...e,interests:[...e.interests,g]})),y(""))};return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 via-sky-50 to-blue-50 py-8",children:s.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"프로필 완성"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"추가 정보를 입력하여 더 나은 매칭을 받으세요"})]}),s.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-8 space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"MBTI"}),s.jsxs("select",{value:b.mbti,onChange:e=>p(s=>({...s,mbti:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 bg-white cursor-pointer",children:[s.jsx("option",{value:"",children:"MBTI를 선택하세요"}),i.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:[s.jsx("span",{className:"text-cyan-500",children:"거주지역"}),"을 선택해 주세요"]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{className:"relative",children:[s.jsxs("select",{value:_,onChange:e=>{C(e.target.value),p(e=>({...e,location:""}))},className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 bg-white appearance-none cursor-pointer",children:[s.jsx("option",{value:"",children:"시/도 선택"}),c.map(e=>s.jsx("option",{value:e.sido,children:e.sido},e.sido))]}),s.jsx("i",{className:"ri-arrow-down-s-line absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("select",{value:b.location?b.location.split(" ").slice(1).join(" "):"",onChange:e=>{e.target.value&&p(s=>({...s,location:`${_} ${e.target.value}`}))},className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 bg-white appearance-none cursor-pointer",disabled:!_,children:[s.jsx("option",{value:"",children:"시/군/구 선택"}),_&&d(_).map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsx("i",{className:"ri-arrow-down-s-line absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]})]}),b.location&&s.jsxs("div",{className:"mt-2 bg-cyan-50 px-4 py-2 rounded-xl flex items-center",children:[s.jsx("i",{className:"ri-map-pin-line mr-2 text-cyan-500"}),s.jsx("span",{className:"text-cyan-700 font-medium",children:b.location})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:[s.jsx("span",{className:"text-cyan-500",children:"학교/직업"}),"을 입력해 주세요"]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",value:S||b.school||b.job,onChange:e=>{U(e.target.value),z(x(e.target.value,8))},placeholder:"학교 또는 직업을 검색하세요",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500"}),q.length>0&&s.jsx("div",{className:"absolute z-20 w-full mt-1 bg-white border border-gray-200 rounded-xl shadow-lg max-h-48 overflow-y-auto",children:q.map(e=>s.jsx("button",{type:"button",onClick:()=>{e.includes("대학교")||e.includes("대학")||e.includes("학교")?p(s=>({...s,school:e,job:""})):p(s=>({...s,job:e,school:""})),U(""),z([])},className:"w-full px-4 py-3 text-left hover:bg-cyan-50 border-b border-gray-100 last:border-b-0 transition-colors",children:e},e))})]}),(b.school||b.job)&&s.jsxs("div",{className:"mt-2 bg-cyan-50 px-4 py-2 rounded-xl flex items-center justify-between",children:[s.jsx("span",{className:"text-cyan-700 font-medium",children:b.school||b.job}),s.jsx("button",{type:"button",onClick:()=>p(e=>({...e,school:"",job:""})),className:"text-cyan-500 hover:text-cyan-700",children:s.jsx("i",{className:"ri-close-line"})})]}),s.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[s.jsx("i",{className:"ri-information-line mr-1 text-cyan-500"}),"직장인, 스타트업, 자영업 등도 검색 가능합니다"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"키"}),s.jsxs("select",{value:b.height,onChange:e=>p(s=>({...s,height:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[s.jsx("option",{value:"150~155",children:"150~155"}),s.jsx("option",{value:"155~160",children:"155~160"}),s.jsx("option",{value:"160~165",children:"160~165"}),s.jsx("option",{value:"165~170",children:"165~170"}),s.jsx("option",{value:"170~175",children:"170~175"}),s.jsx("option",{value:"175~180",children:"175~180"}),s.jsx("option",{value:"180~185",children:"180~185"}),s.jsx("option",{value:"185+",children:"185+"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"체형"}),s.jsxs("select",{value:b.body_type,onChange:e=>p(s=>({...s,body_type:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[s.jsx("option",{value:"마름",children:"마름"}),s.jsx("option",{value:"보통",children:"보통"}),s.jsx("option",{value:"근육질",children:"근육질"}),s.jsx("option",{value:"통통",children:"통통"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"스타일"}),s.jsxs("select",{value:b.style,onChange:e=>p(s=>({...s,style:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[s.jsx("option",{value:"캐주얼",children:"캐주얼"}),s.jsx("option",{value:"포멀",children:"포멀"}),s.jsx("option",{value:"스포츠",children:"스포츠"}),s.jsx("option",{value:"클래식",children:"클래식"}),s.jsx("option",{value:"트렌디",children:"트렌디"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"종교"}),s.jsxs("select",{value:b.religion,onChange:e=>p(s=>({...s,religion:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[s.jsx("option",{value:"무교",children:"무교"}),s.jsx("option",{value:"기독교",children:"기독교"}),s.jsx("option",{value:"천주교",children:"천주교"}),s.jsx("option",{value:"불교",children:"불교"}),s.jsx("option",{value:"이슬람",children:"이슬람"}),s.jsx("option",{value:"기타",children:"기타"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"흡연"}),s.jsxs("select",{value:b.smoking,onChange:e=>p(s=>({...s,smoking:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[s.jsx("option",{value:"비흡연",children:"비흡연"}),s.jsx("option",{value:"흡연",children:"흡연"}),s.jsx("option",{value:"가끔",children:"가끔"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"음주"}),s.jsxs("select",{value:b.drinking,onChange:e=>p(s=>({...s,drinking:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[s.jsx("option",{value:"안함",children:"안함"}),s.jsx("option",{value:"가끔",children:"가끔"}),s.jsx("option",{value:"자주",children:"자주"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"관심사"}),s.jsxs("div",{className:"flex gap-2 mb-3",children:[s.jsx("input",{type:"text",value:g,onChange:e=>y(e.target.value),onKeyPress:e=>"Enter"===e.key&&B(),placeholder:"관심사 입력",maxLength:20,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500"}),s.jsx("button",{onClick:B,className:"px-4 py-3 bg-cyan-500 text-white rounded-xl hover:bg-cyan-600 transition-colors cursor-pointer whitespace-nowrap font-semibold",children:"추가"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:b.interests.map((e,l)=>s.jsxs("div",{className:"flex items-center gap-2 bg-cyan-100 text-cyan-800 px-3 py-2 rounded-full text-sm",children:[e,s.jsx("button",{onClick:()=>(e=>{p(s=>({...s,interests:s.interests.filter((s,l)=>l!==e)}))})(l),className:"text-cyan-600 hover:text-cyan-800 cursor-pointer",children:"×"})]},l))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"자기소개"}),s.jsx("textarea",{value:b.bio,onChange:e=>p(s=>({...s,bio:e.target.value})),placeholder:"자신을 소개해주세요...",maxLength:200,rows:4,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 resize-none"}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[b.bio.length,"/200"]})]}),s.jsxs("div",{className:"text-center pt-6 border-t border-gray-100",children:[s.jsxs("label",{className:"block text-sm font-semibold text-gray-800 mb-4",children:["프로필 사진 ",s.jsx("span",{className:"text-red-500",children:"*"})," (필수)"]}),s.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"얼굴이 잘 나온 사진을 업로드해주세요"}),s.jsxs("div",{className:"relative inline-block mb-4",children:[w&&s.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center z-10",children:s.jsx("i",{className:"ri-loader-4-line text-white text-2xl animate-spin"})}),s.jsx("img",{src:v||b.profile_image||"https://readdy.ai/api/search-image?query=minimalist%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=default-avatar&orientation=squarish",alt:"프로필",className:"w-32 h-32 rounded-full object-cover border-4 border-cyan-200",onError:e=>{e.target.src="https://readdy.ai/api/search-image?query=minimalist%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=default-avatar&orientation=squarish"}}),s.jsx("input",{type:"file",id:"profile-image-upload",accept:"image/*",onChange:async e=>{const s=e.target.files?.[0];if(!s)return;a.info("파일 선택",{name:s.name,type:s.type,size:s.size});if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(s.type))return void alert("JPG, PNG, WEBP, GIF 형식의 이미지만 업로드 가능합니다.");if(s.size>5242880)alert("이미지 크기는 5MB 이하여야 합니다.");else{k(!0);try{a.info("Firebase Storage 업로드 시작");const e=await n(s,"avatars");a.info("생성된 공개 URL",{publicUrl:e}),N(e),alert("이미지가 업로드되었습니다!")}catch(l){a.error("업로드 중 오류",l),alert("업로드 중 오류: "+l.message)}finally{k(!1)}}},disabled:w,className:"hidden"}),s.jsx("label",{htmlFor:"profile-image-upload",className:"absolute bottom-0 right-0 w-10 h-10 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-full flex items-center justify-center shadow-lg transition-all cursor-pointer "+(w?"opacity-50 cursor-not-allowed":"hover:from-cyan-600 hover:to-blue-700"),children:s.jsx("i",{className:"ri-camera-line"})})]}),v||b.profile_image?s.jsx("p",{className:"text-sm text-green-500 font-semibold",children:"✓ 프로필 사진 완료"}):s.jsx("p",{className:"text-sm text-red-500 font-semibold",children:"프로필 사진을 업로드해주세요"})]}),s.jsxs("div",{className:"flex gap-3 pt-6",children:[s.jsx("button",{onClick:()=>u("/"),className:"flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors cursor-pointer font-semibold",children:"나중에"}),s.jsx("button",{onClick:async()=>{if(v||b.profile_image){a.info("프로필 저장",{uploadedImageUrl:v,profile_image:b.profile_image}),j(!0);try{const{user:e}=await l.users.findUserByPhoneNumber(b.phone_number);if(!e)return void alert("사용자를 찾을 수 없습니다.");const{error:s}=await l.users.updateUser(e.id,{mbti:b.mbti,location:b.location,bio:b.bio,school:b.school,job:b.job,height:b.height,body_type:b.body_type,style:b.style,religion:b.religion,smoking:b.smoking,drinking:b.drinking,interests:b.interests,profile_image:v||b.profile_image,avatar_url:v||b.profile_image,profile_completed:!0});if(s)return alert("프로필 저장 실패: "+s.message),void a.error("저장 에러",s);const o=localStorage.getItem("auth_user");if(o){const e={...JSON.parse(o),profile_image:v||b.profile_image,profile_completed:!0};localStorage.setItem("auth_user",JSON.stringify(e)),h(e)}alert("프로필이 완성되었습니다!"),u("/")}catch(e){alert("저장 중 오류: "+e.message)}finally{j(!1)}}else alert("프로필 사진을 업로드해주세요. (필수)")},disabled:f,className:"flex-1 px-4 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl hover:from-cyan-600 hover:to-blue-600 transition-colors disabled:opacity-50 cursor-pointer font-semibold",children:f?"저장 중...":"완성"})]})]})]})})}export{u as default};
