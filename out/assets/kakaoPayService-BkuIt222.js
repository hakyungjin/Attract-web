import{s as e}from"./index-1T8840xh.js";const a=async(e,a)=>({success:!1,error:"카카오페이 설정이 완료되지 않았습니다."}),t=async a=>{const t=sessionStorage.getItem("kakao_pay_tid"),r=sessionStorage.getItem("kakao_pay_order_id"),o=sessionStorage.getItem("kakao_pay_user_id");if(!t||!r||!o)return{success:!1,error:"결제 정보를 찾을 수 없습니다."};const s={cid:"TC0ONETIME",tid:t,partner_order_id:r,partner_user_id:o,pg_token:a};try{const a=await fetch("https://open-api.kakaopay.com/online/v1/payment/approve",{method:"POST",headers:{Authorization:"SECRET_KEY undefined","Content-Type":"application/json"},body:JSON.stringify(s)}),t=await a.json();if(!a.ok)return await e.from("payments").update({status:"failed"}).eq("order_id",r),{success:!1,error:t.msg||"결제 승인에 실패했습니다."};const{data:i}=await e.from("payments").update({status:"completed",payment_key:t.aid,approved_at:t.approved_at}).eq("order_id",r).select().single();return i&&await e.rpc("add_coins",{user_id:o,amount:i.coins}),sessionStorage.removeItem("kakao_pay_tid"),sessionStorage.removeItem("kakao_pay_order_id"),sessionStorage.removeItem("kakao_pay_user_id"),{success:!0,data:t}}catch(i){return{success:!1,error:i.message||"결제 승인 중 오류가 발생했습니다."}}},r=e=>{const a=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);window.location.href=a?e.next_redirect_mobile_url:e.next_redirect_pc_url};export{t as a,a as k,r};
