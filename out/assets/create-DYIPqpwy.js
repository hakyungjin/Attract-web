import{u as e,j as t,f as a}from"./index-BAJ1soMH.js";import{u as s,r}from"./vendor-Dma7sgzX.js";import{u as l}from"./imageUpload-JGYVewY-.js";function i(){const i=s(),{user:n}=e(),[o,c]=r.useState(""),[d,m]=r.useState("dating"),[g,u]=r.useState([]),[h,x]=r.useState([]),[b,p]=r.useState(!1),[f,y]=r.useState(!1),j=async e=>{if(e.preventDefault(),!o.trim())return void alert("내용을 입력해주세요.");const t=(()=>{if(n)return n;const e=localStorage.getItem("auth_user");return e?JSON.parse(e):null})();if(!t)return alert("로그인이 필요합니다."),void i("/login");if(t.id){y(!0);try{const e={author_name:t.name||"익명",avatar_url:t.profile_image||t.avatar_url||"",title:o.substring(0,50),content:o.trim(),images:g,likes:0,views:0,category:d};g.length>0&&(e.image_url=g[0]),t.age&&(e.age=t.age),t.location&&(e.location=t.location),(t.school||t.job)&&(e.job=t.school||t.job);const{post:s,error:r}=await a.posts.createPost(t.id,e);if(r)throw r;if(!s)throw new Error("게시물이 생성되지 않았습니다.");alert("게시물이 작성되었습니다!"),i("/",{state:{activeTab:"community"}})}catch(s){alert(`게시물 작성에 실패했습니다.\n${s.message||"알 수 없는 오류가 발생했습니다."}`)}finally{y(!1)}}else alert("사용자 정보를 확인할 수 없습니다. 다시 로그인해주세요.")};return t.jsxs("div",{className:"min-h-screen bg-white",children:[t.jsx("div",{className:"border-b border-gray-100 sticky top-0 z-30 bg-white",children:t.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[t.jsx("button",{onClick:()=>i(-1),className:"text-gray-600 hover:text-gray-900",children:t.jsx("i",{className:"ri-close-line text-2xl"})}),t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"새 게시물"}),t.jsx("button",{onClick:j,disabled:f||!o.trim(),className:"text-pink-500 font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:f?"게시 중...":"게시"})]})}),t.jsxs("form",{onSubmit:j,className:"p-5",children:[t.jsxs("div",{className:"flex gap-2 mb-4",children:[t.jsx("button",{type:"button",onClick:()=>m("dating"),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors "+("dating"===d?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"소개팅"}),t.jsx("button",{type:"button",onClick:()=>m("chat"),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors "+("chat"===d?"bg-cyan-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"잡담"})]}),t.jsx("textarea",{value:o,onChange:e=>c(e.target.value),placeholder:"무슨 생각을 하고 계신가요?",className:"w-full min-h-[200px] text-lg border-none outline-none resize-none",autoFocus:!0}),h.length>0&&t.jsx("div",{className:"grid grid-cols-2 gap-2 mt-4",children:h.map((e,a)=>t.jsxs("div",{className:"relative aspect-square",children:[t.jsx("img",{src:e,alt:`미리보기 ${a+1}`,className:"w-full h-full object-cover rounded-lg"}),t.jsx("button",{type:"button",onClick:()=>(e=>{u(t=>t.filter((t,a)=>a!==e)),x(t=>t.filter((t,a)=>a!==e))})(a),className:"absolute top-2 right-2 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center text-white hover:bg-black/70",children:t.jsx("i",{className:"ri-close-line text-lg"})})]},a))}),t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-5",children:t.jsxs("label",{className:"flex items-center justify-center w-full py-4 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer hover:border-pink-500 hover:bg-pink-50 transition-all "+(b?"opacity-50 cursor-not-allowed":""),children:[t.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:async e=>{const t=Array.from(e.target.files||[]);if(0!==t.length)if(g.length+t.length>5)alert("이미지는 최대 5개까지 업로드할 수 있습니다.");else{p(!0);try{const e=t.map(async e=>{const t=URL.createObjectURL(e);x(e=>[...e,t]);return await l(e,"posts","community")}),a=await Promise.all(e);u(e=>[...e,...a])}catch(a){alert("이미지 업로드에 실패했습니다.")}finally{p(!1)}}},className:"hidden",disabled:b||g.length>=5}),b?t.jsxs("span",{className:"text-gray-600",children:[t.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"업로드 중..."]}):t.jsxs("span",{className:"text-gray-600",children:[t.jsx("i",{className:"ri-image-add-line text-xl mr-2"}),"사진 추가 (",g.length,"/5)"]})]})})]})]})}export{i as default};
