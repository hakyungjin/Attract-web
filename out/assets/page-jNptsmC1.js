import{s as e,j as s}from"./index-C_8blxm2.js";import{e as t,r as a}from"./vendor-DkI5JUVe.js";import"./supabase-DEy9n1le.js";function l(){const l=t(),[i,r]=a.useState("dashboard"),[n,c]=a.useState(!0),[d,x]=a.useState(!1),[m,o]=a.useState([]),[h,u]=a.useState(null),[p,j]=a.useState(""),[f,g]=a.useState(!1),[N,b]=a.useState(""),[y,w]=a.useState([]),[v,_]=a.useState(null),[k,C]=a.useState([]),[S,L]=a.useState(!1),[U,z]=a.useState({totalUsers:0,activeUsers:0,totalCoins:0,totalChatRooms:0,totalMessages:0});a.useEffect(()=>{M()},[]);const M=async()=>{c(!0);try{const{data:s}=await e.from("users").select("*").order("created_at",{ascending:!1});if(s){o(s);const e=s.reduce((e,s)=>e+(s.coins||0),0);z(t=>({...t,totalUsers:s.length,activeUsers:s.filter(e=>e.last_login).length,totalCoins:e}))}const{count:t}=await e.from("chat_rooms").select("*",{count:"exact",head:!0}),{count:a}=await e.from("messages").select("*",{count:"exact",head:!0});z(e=>({...e,totalChatRooms:t||0,totalMessages:a||0}))}catch(s){}finally{c(!1)}},R=async()=>{c(!0);try{const{data:s,error:t}=await e.from("chat_rooms").select("*").order("last_message_at",{ascending:!1,nullsFirst:!1});if(t)throw t;if(s&&s.length>0){const t=new Set;s.forEach(e=>{t.add(e.user1_id),t.add(e.user2_id)});const{data:a}=await e.from("users").select("id, name, profile_image").in("id",Array.from(t)),l=new Map((a||[]).map(e=>[e.id,e])),i=await Promise.all(s.map(async s=>{const{count:t}=await e.from("messages").select("*",{count:"exact",head:!0}).eq("room_id",s.id),a=l.get(s.user1_id),i=l.get(s.user2_id);return{...s,user1_name:a?.name||"ì•Œ ìˆ˜ ì—†ìŒ",user2_name:i?.name||"ì•Œ ìˆ˜ ì—†ìŒ",user1_avatar:a?.profile_image,user2_avatar:i?.profile_image,message_count:t||0}}));w(i)}else w([])}catch(s){}finally{c(!1)}};a.useEffect(()=>{"chats"===i&&R()},[i]);const D=m.filter(e=>(e.name||"").toLowerCase().includes(p.toLowerCase())||(e.phone_number||"").includes(p)),q=e=>{r(e),x(!1)};return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsxs("div",{className:"fixed top-0 left-0 right-0 bg-white shadow-sm z-30 px-4 py-3 flex items-center justify-between",children:[s.jsx("button",{onClick:()=>x(!0),className:"w-10 h-10 flex items-center justify-center",children:s.jsx("i",{className:"ri-menu-line text-xl text-gray-600"})}),s.jsx("h1",{className:"font-bold text-gray-800",children:"ê´€ë¦¬ì"}),s.jsx("button",{onClick:()=>l("/"),className:"w-10 h-10 flex items-center justify-center",children:s.jsx("i",{className:"ri-home-line text-xl text-gray-600"})})]}),d&&s.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>x(!1)}),s.jsxs("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-white shadow-lg z-50 transform transition-transform "+(d?"translate-x-0":"-translate-x-full"),children:[s.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-xl flex items-center justify-center",children:s.jsx("i",{className:"ri-admin-line text-white text-xl"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"font-bold text-gray-800",children:"ê´€ë¦¬ì"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Admin Panel"})]})]}),s.jsx("button",{onClick:()=>x(!1),className:"w-8 h-8 flex items-center justify-center",children:s.jsx("i",{className:"ri-close-line text-xl text-gray-500"})})]}),s.jsxs("nav",{className:"p-4 space-y-2",children:[s.jsxs("button",{onClick:()=>q("dashboard"),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-colors "+("dashboard"===i?"bg-pink-50 text-pink-600":"text-gray-600"),children:[s.jsx("i",{className:"ri-dashboard-line text-xl"}),s.jsx("span",{className:"font-medium",children:"ëŒ€ì‹œë³´ë“œ"})]}),s.jsxs("button",{onClick:()=>q("users"),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-colors "+("users"===i?"bg-pink-50 text-pink-600":"text-gray-600"),children:[s.jsx("i",{className:"ri-user-line text-xl"}),s.jsx("span",{className:"font-medium",children:"ìœ ì € ê´€ë¦¬"})]}),s.jsxs("button",{onClick:()=>q("chats"),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-colors "+("chats"===i?"bg-pink-50 text-pink-600":"text-gray-600"),children:[s.jsx("i",{className:"ri-chat-3-line text-xl"}),s.jsx("span",{className:"font-medium",children:"ì±„íŒ… ê´€ë¦¬"})]}),s.jsxs("button",{onClick:()=>q("reports"),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-colors "+("reports"===i?"bg-pink-50 text-pink-600":"text-gray-600"),children:[s.jsx("i",{className:"ri-flag-line text-xl"}),s.jsx("span",{className:"font-medium",children:"ì‹ ê³  ê´€ë¦¬"})]})]}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t",children:s.jsxs("button",{onClick:()=>l("/"),className:"w-full flex items-center space-x-3 px-4 py-3 text-gray-600 rounded-xl",children:[s.jsx("i",{className:"ri-logout-box-line text-xl"}),s.jsx("span",{className:"font-medium",children:"ë©”ì¸ìœ¼ë¡œ"})]})})]}),s.jsxs("div",{className:"p-4 pt-20 pb-8",children:[s.jsx("div",{className:"mb-4",children:s.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["dashboard"===i&&"ëŒ€ì‹œë³´ë“œ","users"===i&&"ìœ ì € ê´€ë¦¬","chats"===i&&"ì±„íŒ… ê´€ë¦¬","reports"===i&&"ì‹ ê³  ê´€ë¦¬"]})}),"dashboard"===i&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"ì „ì²´ ìœ ì €"}),s.jsx("p",{className:"text-xl font-bold text-gray-800",children:U.totalUsers})]}),s.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"í™œì„± ìœ ì €"}),s.jsx("p",{className:"text-xl font-bold text-green-600",children:U.activeUsers})]}),s.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"ì´ ì½”ì¸"}),s.jsx("p",{className:"text-xl font-bold text-yellow-600",children:U.totalCoins.toLocaleString()})]}),s.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"ì±„íŒ…ë°©"}),s.jsx("p",{className:"text-xl font-bold text-purple-600",children:U.totalChatRooms})]}),s.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm col-span-2",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"ì´ ë©”ì‹œì§€"}),s.jsx("p",{className:"text-xl font-bold text-pink-600",children:U.totalMessages.toLocaleString()})]})]}),s.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[s.jsx("h3",{className:"font-bold text-gray-800 mb-3",children:"ìµœê·¼ ê°€ì… ìœ ì €"}),s.jsx("div",{className:"space-y-2",children:m.slice(0,5).map(e=>s.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm",children:(e.name||"?")[0]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-800 text-sm",children:e.name||"ì´ë¦„ ì—†ìŒ"}),s.jsx("p",{className:"text-xs text-gray-500",children:e.phone_number})]})]}),s.jsxs("p",{className:"text-xs font-medium text-yellow-600",children:[e.coins||0," ì½”ì¸"]})]},e.id))})]})]}),"users"===i&&s.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[s.jsx("div",{className:"p-3 border-b",children:s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",value:p,onChange:e=>j(e.target.value),placeholder:"ì´ë¦„ ë˜ëŠ” ì „í™”ë²ˆí˜¸ ê²€ìƒ‰...",className:"w-full pl-10 pr-4 py-2 bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm"}),s.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"})]})}),s.jsx("div",{className:"divide-y divide-gray-100 max-h-[60vh] overflow-y-auto",children:D.map(e=>s.jsxs("div",{className:"p-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 flex items-center justify-center text-white font-bold overflow-hidden",children:e.profile_image?s.jsx("img",{src:e.profile_image,alt:"",className:"w-full h-full object-cover"}):(e.name||"?")[0]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-800 text-sm",children:e.name||"ì´ë¦„ ì—†ìŒ"}),s.jsx("p",{className:"text-xs text-gray-500",children:e.phone_number||"-"})]})]}),s.jsx("button",{onClick:()=>u(e),className:"text-pink-500 text-sm font-medium",children:"ìƒì„¸"})]}),s.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[s.jsxs("span",{className:"flex items-center",children:[s.jsx("i",{className:"ri-coin-line text-yellow-500 mr-1"}),e.coins||0]}),s.jsx("span",{children:"male"===e.gender?"ë‚¨":"female"===e.gender?"ì—¬":"-"}),s.jsx("span",{children:e.created_at?new Date(e.created_at).toLocaleDateString("ko-KR"):"-"})]})]},e.id))}),0===D.length&&s.jsx("div",{className:"p-8 text-center text-gray-500 text-sm",children:"ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."})]}),"chats"===i&&s.jsxs("div",{className:"space-y-4",children:[v&&s.jsxs("button",{onClick:()=>_(null),className:"flex items-center text-pink-500 text-sm",children:[s.jsx("i",{className:"ri-arrow-left-line mr-1"}),"ì±„íŒ…ë°© ëª©ë¡ìœ¼ë¡œ"]}),v?s.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[s.jsx("div",{className:"p-3 border-b",children:s.jsxs("h3",{className:"font-bold text-gray-800 text-sm",children:["ğŸ’¬ ",v.user1_name," â†” ",v.user2_name]})}),s.jsx("div",{className:"max-h-[60vh] overflow-y-auto p-3",children:S?s.jsx("div",{className:"text-center text-gray-500 py-10 text-sm",children:"ë¡œë”© ì¤‘..."}):0===k.length?s.jsxs("div",{className:"text-center text-gray-500 py-10",children:[s.jsx("i",{className:"ri-message-3-line text-3xl text-gray-300 mb-2 block"}),s.jsx("p",{className:"text-sm",children:"ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤."})]}):s.jsx("div",{className:"space-y-2",children:k.map(e=>s.jsx("div",{className:"flex "+(e.sender_id===v.user1_id?"justify-start":"justify-end"),children:s.jsxs("div",{className:`max-w-[85%] ${e.sender_id===v.user1_id?"bg-blue-100 text-blue-900":"bg-pink-100 text-pink-900"} rounded-xl px-3 py-2`,children:[s.jsx("p",{className:"text-xs font-medium mb-1 opacity-70",children:e.sender_name}),s.jsx("p",{className:"text-sm",children:e.content}),s.jsx("p",{className:"text-[10px] mt-1 opacity-50",children:new Date(e.created_at).toLocaleString("ko-KR")})]})},e.id))})})]}):s.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[s.jsxs("div",{className:"p-3 border-b flex items-center justify-between",children:[s.jsx("h3",{className:"font-bold text-gray-800 text-sm",children:"ì±„íŒ…ë°© ëª©ë¡"}),s.jsxs("button",{onClick:R,className:"text-xs text-pink-500",children:[s.jsx("i",{className:"ri-refresh-line mr-1"}),"ìƒˆë¡œê³ ì¹¨"]})]}),s.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:n?s.jsx("div",{className:"p-8 text-center text-gray-500 text-sm",children:"ë¡œë”© ì¤‘..."}):0===y.length?s.jsx("div",{className:"p-8 text-center text-gray-500 text-sm",children:"ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤."}):y.map(t=>s.jsxs("div",{onClick:()=>(async s=>{_(s),L(!0);try{const{data:t,error:a}=await e.from("messages").select("*").eq("room_id",s.id).order("created_at",{ascending:!0});if(a)throw a;const l=new Set((t||[]).map(e=>e.sender_id)),{data:i}=await e.from("users").select("id, name").in("id",Array.from(l)),r=new Map((i||[]).map(e=>[e.id,e.name])),n=(t||[]).map(e=>({...e,sender_name:r.get(e.sender_id)||"ì•Œ ìˆ˜ ì—†ìŒ"}));C(n)}catch(t){}finally{L(!1)}})(t),className:"p-3 border-b cursor-pointer hover:bg-gray-50 active:bg-gray-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-7 h-7 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-xs",children:(t.user1_name||"?")[0]}),s.jsx("i",{className:"ri-arrow-left-right-line text-gray-400 text-sm"}),s.jsx("div",{className:"w-7 h-7 rounded-full bg-pink-100 flex items-center justify-center text-pink-600 font-bold text-xs",children:(t.user2_name||"?")[0]})]}),s.jsxs("span",{className:"text-xs text-gray-400",children:[t.message_count,"ê°œ"]})]}),s.jsxs("p",{className:"text-sm font-medium text-gray-800",children:[t.user1_name," â†” ",t.user2_name]}),t.last_message&&s.jsxs("p",{className:"text-xs text-gray-500 mt-1 truncate",children:['"',t.last_message,'"']})]},t.id))})]})]}),"reports"===i&&s.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm text-center",children:[s.jsx("i",{className:"ri-flag-line text-3xl text-gray-300 mb-2 block"}),s.jsx("p",{className:"text-gray-500 text-sm",children:"ì‹ ê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤"})]})]}),h&&s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[s.jsx("h3",{className:"font-bold",children:"ìœ ì € ìƒì„¸"}),s.jsx("button",{onClick:()=>u(null),children:s.jsx("i",{className:"ri-close-line text-xl"})})]}),s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[s.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 flex items-center justify-center text-white text-xl font-bold overflow-hidden",children:h.profile_image?s.jsx("img",{src:h.profile_image,alt:"",className:"w-full h-full object-cover"}):(h.name||"?")[0]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-gray-800",children:h.name||"ì´ë¦„ ì—†ìŒ"}),s.jsx("p",{className:"text-gray-500 text-sm",children:h.phone_number})]})]}),s.jsxs("div",{className:"space-y-3 mb-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"ë‚˜ì´"}),s.jsxs("p",{className:"font-medium text-sm",children:[h.age||"-","ì„¸"]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"ì„±ë³„"}),s.jsx("p",{className:"font-medium text-sm",children:"male"===h.gender?"ë‚¨ì„±":"female"===h.gender?"ì—¬ì„±":"-"})]})]}),s.jsxs("div",{className:"bg-yellow-50 rounded-lg p-3 text-center",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"ë³´ìœ  ì½”ì¸"}),s.jsx("p",{className:"text-xl font-bold text-yellow-600",children:h.coins||0})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"ID"}),s.jsx("p",{className:"font-mono text-xs break-all",children:h.id})]})]}),s.jsxs("button",{onClick:()=>g(!0),className:"w-full py-3 bg-gradient-to-r from-yellow-400 to-yellow-500 text-white rounded-xl font-medium text-sm",children:[s.jsx("i",{className:"ri-coin-line mr-2"}),"ì½”ì¸ ì§€ê¸‰"]})]})]})}),f&&h&&s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm p-4",children:[s.jsx("h3",{className:"font-bold mb-3",children:"ì½”ì¸ ì§€ê¸‰"}),s.jsxs("p",{className:"text-gray-500 mb-3 text-sm",children:[h.name,"ë‹˜ì—ê²Œ ì§€ê¸‰"]}),s.jsx("input",{type:"number",value:N,onChange:e=>b(e.target.value),placeholder:"ì½”ì¸ ìˆ˜",className:"w-full px-4 py-3 bg-gray-100 rounded-xl mb-4 text-sm"}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("button",{onClick:()=>{g(!1),b("")},className:"flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium text-sm",children:"ì·¨ì†Œ"}),s.jsx("button",{onClick:async()=>{if(h&&N)try{const s=(h.coins||0)+parseInt(N),{error:t}=await e.from("users").update({coins:s}).eq("id",h.id);if(t)throw t;o(e=>e.map(e=>e.id===h.id?{...e,coins:s}:e)),u(e=>e?{...e,coins:s}:null),g(!1),b(""),alert("ì½”ì¸ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!")}catch(s){alert("ì½”ì¸ ì§€ê¸‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},disabled:!N||parseInt(N)<=0,className:"flex-1 py-3 bg-yellow-500 text-white rounded-xl font-medium disabled:opacity-50 text-sm",children:"ì§€ê¸‰"})]})]})})]})}export{l as default};
