import{u as e,j as s,s as t}from"./index-C3G5SuOE.js";import{e as a,f as r,r as n}from"./vendor-DkI5JUVe.js";import"./supabase-DEy9n1le.js";function l(){const l=a(),{user:c}=e(),[i]=r(),[o,d]=n.useState(!0),[m,x]=n.useState(null);return n.useEffect(()=>{(async()=>{const e=i.get("orderId"),s=i.get("paymentKey"),a=i.get("amount");if(!e||!s||!a)return alert("결제 정보가 올바르지 않습니다."),void l("/coin-shop");if(!c?.id)return alert("로그인이 필요합니다."),void l("/login");try{const r=parseInt(localStorage.getItem("selectedCoins")||"0"),n=parseInt(localStorage.getItem("selectedBonusCoins")||"0"),l=localStorage.getItem("selectedPackageId")||"",i=localStorage.getItem("selectedPackageName")||"",{data:o}=await t.auth.getSession(),m=o?.session?.access_token,g=await fetch("https://ytffobltrwkgxiedorsd.supabase.co/functions/v1/confirm-payment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({orderId:e,paymentKey:s,amount:parseInt(a),userId:c.id,coins:r,bonusCoins:n,packageId:l,packageName:i})}),p=await g.json();if(!g.ok||!p.success)throw new Error(p.message||"결제 승인에 실패했습니다.");x({orderId:p.data.orderId,amount:p.data.amount,coins:p.data.coins,currentCoins:p.data.currentCoins,approvedAt:p.data.approvedAt}),localStorage.removeItem("selectedPackageId"),localStorage.removeItem("selectedCoins"),localStorage.removeItem("selectedBonusCoins"),localStorage.removeItem("selectedPackageName"),d(!1)}catch(r){const e=r.message||"결제 승인에 실패했습니다.";alert(e),l(`/payment/fail?message=${encodeURIComponent(e)}`)}})()},[i,l,c]),o?s.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"결제를 처리하고 있습니다..."})]})}):s.jsxs("div",{className:"min-h-screen bg-white",children:[s.jsx("div",{className:"border-b border-gray-100 sticky top-0 z-30 bg-white",children:s.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[s.jsx("div",{className:"w-10"}),s.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"결제 완료"}),s.jsx("div",{className:"w-10"})]})}),s.jsxs("div",{className:"flex flex-col items-center justify-center px-5 py-12",children:[s.jsx("div",{className:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6",children:s.jsx("i",{className:"ri-check-line text-5xl text-green-500"})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"결제가 완료되었습니다"}),s.jsx("p",{className:"text-gray-500 mb-8",children:"자석이 충전되었습니다"}),m&&s.jsxs("div",{className:"w-full max-w-md bg-gray-50 rounded-2xl p-6 mb-6",children:[s.jsxs("div",{className:"flex items-center justify-center mb-6 pb-6 border-b border-gray-200",children:[s.jsx("img",{src:"/image/magnet.png",alt:"자석",className:"w-12 h-12 mr-3"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"충전된 자석"}),s.jsxs("p",{className:"text-3xl font-bold text-pink-500",children:["+",m.coins.toLocaleString()]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"주문번호"}),s.jsx("span",{className:"text-gray-900 font-medium text-sm",children:m.orderId})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"결제금액"}),s.jsxs("span",{className:"text-gray-900 font-bold text-xl",children:[m.amount.toLocaleString(),"원"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"현재 보유 자석"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("img",{src:"/image/magnet.png",alt:"자석",className:"w-5 h-5"}),s.jsx("span",{className:"text-gray-900 font-bold text-lg",children:m.currentCoins?.toLocaleString()||0})]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-gray-600",children:"결제일시"}),s.jsx("span",{className:"text-gray-900 font-medium",children:new Date(m.approvedAt).toLocaleString("ko-KR")})]})]})]}),s.jsxs("div",{className:"w-full max-w-md space-y-3",children:[s.jsx("button",{onClick:()=>l("/"),className:"w-full bg-gray-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-800 transition-all cursor-pointer",children:"홈으로 돌아가기"}),s.jsx("button",{onClick:()=>l("/coin-shop"),className:"w-full bg-white text-gray-900 py-4 rounded-xl font-bold text-lg border-2 border-gray-200 hover:bg-gray-50 transition-all cursor-pointer",children:"더 충전하기"})]})]})]})}export{l as default};
