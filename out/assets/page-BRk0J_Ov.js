import{u as e,s as t,j as s}from"./index-MGgYOwZh.js";import{d as a,r}from"./vendor-DxrR1XxW.js";import"./supabase-DKAQY1gD.js";function i({coins:i=0}){const l=a(),{user:n}=e(),[o,c]=r.useState(!1),[d,m]=r.useState(0);r.useEffect(()=>{if(!n?.id)return;x();const e=setInterval(x,3e4);return()=>clearInterval(e)},[n?.id]);const x=async()=>{try{if(!n?.id)return void m(0);const{count:e,error:s}=await t.from("notifications").select("*",{count:"exact",head:!0}).eq("read",!1);s||null===e||m(e)}catch(e){}};return s.jsxs(s.Fragment,{children:[s.jsx("header",{className:"fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-[400px] glass z-50 transition-all duration-300",style:{paddingTop:"env(safe-area-inset-top)"},children:s.jsxs("div",{className:"flex items-center justify-between px-4 py-1 h-14",children:[s.jsx("div",{className:"flex items-center cursor-pointer",onClick:()=>l("/"),children:s.jsxs("h1",{className:"flex items-center space-x-1 group",children:[s.jsx("div",{className:"relative transform transition-transform group-hover:scale-110 duration-300 -my-2",children:s.jsx("img",{src:"/image/icon.png",alt:"Attract 마스코트",className:"w-14 h-14 object-contain drop-shadow-md"})}),s.jsx("span",{className:"text-xl font-bold font-display bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent tracking-tight",children:"Attract"})]})}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{onClick:()=>l("/coin-shop"),className:"group flex items-center gap-1 bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-2 py-1 rounded-full hover:from-blue-600 hover:to-cyan-600 transition-all duration-300 shadow-lg shadow-blue-500/30 hover:shadow-blue-500/50 transform hover:-translate-y-0.5",children:[s.jsx("img",{src:"/image/magnet.png",alt:"자석",className:"w-8 h-8 object-contain group-hover:rotate-12 transition-transform"}),s.jsx("span",{className:"text-sm font-bold font-display pr-1",children:i.toLocaleString()})]}),s.jsxs("button",{onClick:()=>l("/notifications"),className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 transition-colors relative group",children:[s.jsx("i",{className:"ri-notification-line text-slate-600 text-xl group-hover:text-primary-600 transition-colors"}),d>0&&s.jsx("span",{className:"absolute -top-0.5 -right-0.5 bg-red-500 text-white text-[10px] font-bold rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1 border-2 border-white shadow-sm animate-pulse",children:d>9?"9+":d})]}),s.jsx("button",{onClick:()=>c(!o),className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 transition-colors group",children:s.jsx("i",{className:`ri-menu-line text-slate-600 text-xl group-hover:text-primary-600 transition-colors ${o?"rotate-90":""} duration-300`})})]})]})}),o&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-slate-900/20 backdrop-blur-sm z-40 animate-fade-in",onClick:()=>c(!1)}),s.jsxs("div",{className:"fixed top-20 right-4 bg-white/90 backdrop-blur-xl rounded-2xl shadow-2xl py-2 w-56 z-50 animate-slide-up border border-white/20",children:[s.jsxs("div",{className:"px-4 py-3 border-b border-slate-100",children:[s.jsx("p",{className:"text-sm text-slate-500",children:"환영합니다!"}),s.jsxs("p",{className:"font-bold text-slate-800",children:[n?.name||"사용자","님"]})]}),s.jsx("div",{className:"py-2",children:[{icon:"ri-user-line",label:"마이페이지",action:()=>{c(!1),l("/"),setTimeout(()=>{const e=new CustomEvent("switchTab",{detail:{tab:"profile"}});window.dispatchEvent(e)},100)}},{icon:"ri-settings-line",label:"설정",action:()=>{c(!1),l("/settings")}},{icon:"ri-question-line",label:"FAQ",action:()=>{c(!1),l("/faq")}},{icon:"ri-customer-service-line",label:"1:1문의",action:()=>{c(!1),l("/support")}}].map((e,t)=>s.jsxs("button",{onClick:e.action,className:"w-full text-left px-4 py-2.5 hover:bg-primary-50 text-slate-600 hover:text-primary-600 transition-colors flex items-center space-x-3 group",children:[s.jsx("i",{className:`${e.icon} text-lg group-hover:scale-110 transition-transform`}),s.jsx("span",{className:"font-medium",children:e.label})]},t))}),s.jsx("div",{className:"border-t border-slate-100 mt-1 pt-1",children:s.jsxs("button",{onClick:()=>{localStorage.removeItem("auth_user"),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userEmail"),localStorage.removeItem("user_id"),localStorage.removeItem("user_data"),window.location.href="/login"},className:"w-full text-left px-4 py-2.5 hover:bg-red-50 text-red-500 hover:text-red-600 transition-colors flex items-center space-x-3 group",children:[s.jsx("i",{className:"ri-logout-box-line text-lg group-hover:scale-110 transition-transform"}),s.jsx("span",{className:"font-medium",children:"로그아웃"})]})})]})]})]})}function l({activeTab:e,onTabChange:t}){return s.jsx("div",{className:"fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[400px] z-50 bg-white border-t border-gray-200",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:s.jsx("div",{className:"flex items-center justify-around py-2",children:[{id:"matching",icon:"ri-heart-3-line",activeIcon:"ri-heart-3-fill",label:"매칭"},{id:"community",icon:"ri-group-line",activeIcon:"ri-group-fill",label:"커뮤니티"},{id:"chat",icon:"ri-chat-3-line",activeIcon:"ri-chat-3-fill",label:"채팅"},{id:"profile",icon:"ri-user-line",activeIcon:"ri-user-fill",label:"My"}].map(a=>{const r=e===a.id;return s.jsxs("button",{onClick:()=>t(a.id),className:"flex flex-col items-center justify-center flex-1 py-2 "+(r?"text-primary-600":"text-gray-400"),children:[s.jsx("i",{className:`text-2xl ${r?a.activeIcon:a.icon}`}),s.jsx("span",{className:"text-[10px] font-medium mt-1",children:a.label})]},a.id)})})})}function n(){return s.jsxs("div",{className:"bg-white rounded-3xl overflow-hidden shadow-lg",children:[s.jsx("div",{className:"aspect-[3/4] bg-slate-200 animate-pulse"}),s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"h-6 w-24 bg-slate-200 rounded animate-pulse"}),s.jsx("div",{className:"h-5 w-12 bg-slate-200 rounded-full animate-pulse"})]}),s.jsx("div",{className:"h-4 w-32 bg-slate-200 rounded animate-pulse"}),s.jsx("div",{className:"h-4 w-40 bg-slate-200 rounded animate-pulse"})]})]})}function o(){return s.jsx("div",{className:"grid grid-cols-2 gap-3 px-3 py-4",children:[...Array(4)].map((e,t)=>s.jsx(n,{},t))})}function c(){return s.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-200 animate-pulse"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("div",{className:"h-4 w-20 bg-slate-200 rounded animate-pulse"}),s.jsx("div",{className:"h-3 w-32 bg-slate-200 rounded animate-pulse"})]}),s.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-200 animate-pulse"})]}),s.jsxs("div",{className:"mt-3 space-y-2",children:[s.jsx("div",{className:"h-4 w-full bg-slate-200 rounded animate-pulse"}),s.jsx("div",{className:"h-4 w-3/4 bg-slate-200 rounded animate-pulse"})]})]})}function d(){return s.jsx("div",{className:"space-y-3 px-4",children:[...Array(5)].map((e,t)=>s.jsx(c,{},t))})}function m({src:e,alt:t,className:a="",placeholderColor:i="bg-slate-200",...l}){const[n,o]=r.useState(!1),[c,d]=r.useState(!1),[m,x]=r.useState(!1),h=r.useRef(null);r.useEffect(()=>{const e=new IntersectionObserver(([t])=>{t.isIntersecting&&(d(!0),e.disconnect())},{rootMargin:"100px",threshold:.1});return h.current&&e.observe(h.current),()=>e.disconnect()},[]);return s.jsxs("div",{ref:h,className:`relative overflow-hidden ${a}`,children:[!n&&s.jsx("div",{className:`absolute inset-0 ${i} animate-pulse`,children:s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx("i",{className:"ri-image-line text-slate-300 text-3xl"})})}),c&&!m&&s.jsx("img",{src:e,alt:t,onLoad:()=>{o(!0)},onError:()=>{x(!0),o(!0)},className:"w-full h-full object-cover transition-opacity duration-300 "+(n?"opacity-100":"opacity-0"),...l}),m&&s.jsx("div",{className:`absolute inset-0 ${i} flex items-center justify-center`,children:s.jsx("i",{className:"ri-user-line text-slate-400 text-4xl"})})]})}let x={male:[],female:[]},h={male:0,female:0};function u(){const i=a(),{user:l}=e(),[n,c]=r.useState(""),[d,u]=r.useState(!1),[p,f]=r.useState(!1),[g,b]=r.useState(""),[j,v]=r.useState(!0),[y,w]=r.useState([]),[N,k]=r.useState(0),[_,C]=r.useState(!0),q=r.useRef(!1);r.useEffect(()=>{(async()=>{if(l?.id)try{const{data:e}=await t.from("users").select("gender").eq("id",l.id).single();e?.gender&&("male"===e.gender?c("female"):"female"===e.gender&&c("male"))}catch(e){}})()},[l?.id]),r.useEffect(()=>{if(!n)return;const e=n,t=Date.now();x[e].length>0&&t-h[e]<3e5?(w(x[e]),v(!1)):q.current||S()},[n]);const S=async(e=!1)=>{if(n&&(!q.current||e)){q.current=!0,v(!0);try{const s=e?N+1:0;let a=t.from("users").select("id, name, age, gender, location, school, mbti, bio, avatar_url, profile_image",{count:"exact"});if(l?.id&&(a=a.neq("id",l.id)),!n)return;a=a.eq("gender",n),a=a.range(20*s,20*(s+1)-1).order("created_at",{ascending:!1});const{data:r,error:i,count:o}=await a;if(i)throw i;if(r){const t=r.filter(e=>!!(e.avatar_url||e.profile_image)).map(e=>{const t=e.avatar_url||e.profile_image||"";return{id:e.id,name:e.name||"알 수 없음",age:e.age||20,gender:e.gender||"무관",location:e.location||"위치 미설정",school:e.school||"학교 미설정",mbti:e.mbti||"MBTI",character:t,bio:e.bio||"자기소개가 없습니다.",hasLikedMe:!1,photos:t?[t]:[]}});e?w(e=>[...e,...t]):(w(t),"male"!==n&&"female"!==n||(x[n]=t,h[n]=Date.now())),k(s),C(!!o&&20*(s+1)<o)}}catch(s){e||w([])}finally{v(!1),q.current=!1}}},I=r.useMemo(()=>y.filter(e=>e.gender===n),[y,n]);return j?s.jsxs("div",{className:"min-h-screen bg-slate-50 pt-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4 px-3",children:[s.jsx("div",{className:"h-7 w-16 bg-slate-200 rounded animate-pulse"}),s.jsx("div",{className:"h-10 w-10 bg-slate-200 rounded-full animate-pulse"})]}),s.jsx(o,{})]}):0===I.length?s.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-50 space-y-4 px-4",children:[s.jsx("i",{className:"ri-search-line text-6xl text-slate-300"}),s.jsx("p",{className:"text-center text-slate-600 font-medium",children:"조건에 맞는 프로필이 없습니다"})]}):s.jsxs("div",{className:"px-3 py-4 min-h-screen",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"매칭"}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsx("button",{onClick:()=>u(!d),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md cursor-pointer hover:shadow-lg transition-all hover:scale-105 group",children:s.jsx("i",{className:"ri-filter-line text-slate-400 group-hover:text-primary-500 text-lg transition-colors"})})})]}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:I.map(e=>s.jsxs("div",{onClick:()=>(e=>{i("/profile-detail",{state:{profile:e}})})(e),className:"bg-white rounded-2xl shadow-lg overflow-hidden cursor-pointer hover:shadow-2xl hover:shadow-primary-500/10 transition-all duration-300 relative group transform hover:-translate-y-1",children:[e.hasLikedMe&&s.jsx("div",{className:"absolute top-2 right-2 w-7 h-7 bg-gradient-to-br from-pink-500 to-rose-500 rounded-full flex items-center justify-center z-10 shadow-lg shadow-pink-500/30 animate-pulse-soft",children:s.jsx("i",{className:"ri-heart-fill text-white text-xs"})}),s.jsx("div",{className:"absolute top-2 left-2 w-7 h-7 glass rounded-full flex items-center justify-center z-10",children:s.jsx("i",{className:`text-sm ${"female"===e.gender?"ri-women-line text-pink-500":"ri-men-line text-blue-500"} font-bold`})}),s.jsx("div",{className:"absolute top-2 left-10 z-10",children:s.jsx("span",{className:"glass text-primary-700 px-2 py-0.5 rounded-full text-[10px] font-bold",children:e.mbti||"MBTI"})}),s.jsxs("div",{className:"relative aspect-[3/4] overflow-hidden bg-slate-100",children:[s.jsx(m,{src:e.character,alt:e.name,className:"w-full h-full"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900/90 via-slate-900/30 to-transparent opacity-80"}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3 text-white",children:[s.jsx("h3",{className:"font-bold text-base mb-0.5 truncate",children:e.name}),s.jsxs("div",{className:"flex items-center text-xs text-slate-200 space-x-1",children:[s.jsxs("span",{children:[e.age,"세"]}),s.jsx("span",{children:"·"}),s.jsx("span",{className:"truncate",children:e.location})]}),s.jsxs("div",{className:"flex items-center text-[10px] mt-1.5 text-slate-300 bg-white/10 rounded px-1.5 py-0.5 w-fit backdrop-blur-sm",children:[s.jsx("i",{className:"ri-school-line mr-1"}),s.jsx("span",{className:"truncate max-w-[80px]",children:e.school})]})]})]})]},e.id))}),s.jsx("div",{className:"mt-10 text-center pb-8",children:s.jsxs("button",{onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},className:"bg-white text-slate-600 px-8 py-3 rounded-full font-bold shadow-lg hover:shadow-xl hover:text-primary-600 hover:scale-105 transition-all cursor-pointer whitespace-nowrap flex items-center mx-auto space-x-2",children:[s.jsx("span",{children:"친구 더보기"}),s.jsx("i",{className:"ri-arrow-down-s-line"})]})}),d&&s.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-end animate-fade-in",children:s.jsxs("div",{className:"bg-white w-full rounded-t-[2rem] p-8 max-h-[85vh] overflow-y-auto animate-slide-up shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsx("h3",{className:"text-2xl font-bold font-display text-slate-800",children:"필터"}),s.jsx("button",{onClick:()=>u(!1),className:"w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-slate-100 rounded-full transition-colors",children:s.jsx("i",{className:"ri-close-line text-2xl text-slate-400"})})]}),s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-slate-800 mb-4 text-lg",children:"성별"}),s.jsxs("div",{className:"flex space-x-4",children:[s.jsx("button",{onClick:()=>c("female"),className:"flex-1 py-4 rounded-2xl font-bold transition-all cursor-pointer border-2 "+("female"===n?"border-primary-500 bg-primary-50 text-primary-600":"border-slate-100 bg-white text-slate-400 hover:border-slate-200"),children:"여자"}),s.jsx("button",{onClick:()=>c("male"),className:"flex-1 py-4 rounded-2xl font-bold transition-all cursor-pointer border-2 "+("male"===n?"border-primary-500 bg-primary-50 text-primary-600":"border-slate-100 bg-white text-slate-400 hover:border-slate-200"),children:"남자"})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-slate-800 mb-4 text-lg",children:"지역"}),s.jsx("div",{className:"grid grid-cols-3 gap-3",children:["전체","인천/서울","경기/강원","경상권","충청권","호남권"].map(e=>s.jsx("button",{className:"px-2 py-3 bg-slate-50 text-slate-600 rounded-xl text-sm font-medium hover:bg-primary-50 hover:text-primary-600 transition-colors cursor-pointer whitespace-nowrap border border-transparent hover:border-primary-200",children:e},e))})]})]}),s.jsxs("div",{className:"flex space-x-4 mt-10",children:[s.jsx("button",{onClick:()=>u(!1),className:"flex-1 py-4 bg-slate-100 text-slate-600 rounded-2xl font-bold cursor-pointer hover:bg-slate-200 transition-colors",children:"닫기"}),s.jsx("button",{onClick:()=>{u(!1),S()},className:"flex-1 py-4 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-2xl font-bold cursor-pointer shadow-lg shadow-primary-500/30 hover:shadow-primary-500/50 transition-all",children:"적용하기"})]})]})}),p&&s.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",children:s.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl animate-slide-up",children:[s.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-slate-100",children:[s.jsx("h3",{className:"text-xl font-bold font-display text-slate-800",children:g}),s.jsx("button",{onClick:()=>f(!1),className:"w-8 h-8 flex items-center justify-center cursor-pointer hover:bg-slate-100 rounded-full transition-colors",children:s.jsx("i",{className:"ri-close-line text-xl text-slate-400"})})]}),s.jsxs("div",{className:"p-5",children:[s.jsx("div",{className:"w-full h-64 bg-slate-100 rounded-2xl overflow-hidden shadow-inner",children:s.jsx("iframe",{src:`https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dO_X0Q&q=${encodeURIComponent(g)}`,width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:`${g} 지도`})}),s.jsxs("div",{className:"mt-5 space-y-3",children:[s.jsxs("div",{className:"flex items-center text-sm text-slate-600 bg-slate-50 p-3 rounded-xl",children:[s.jsx("i",{className:"ri-map-pin-line text-primary-500 text-lg mr-3"}),s.jsx("span",{className:"font-medium",children:g})]}),s.jsxs("div",{className:"flex items-center text-sm text-slate-600 bg-slate-50 p-3 rounded-xl cursor-pointer hover:bg-primary-50 hover:text-primary-700 transition-colors group",children:[s.jsx("i",{className:"ri-navigation-line text-primary-500 text-lg mr-3 group-hover:scale-110 transition-transform"}),s.jsx("span",{className:"font-medium",children:"길찾기로 이동"})]})]}),s.jsx("button",{onClick:()=>f(!1),className:"w-full mt-6 bg-gradient-to-r from-primary-500 to-primary-600 text-white py-4 rounded-2xl font-bold hover:from-primary-600 hover:to-primary-700 transition-all cursor-pointer shadow-lg shadow-primary-500/30",children:"확인"})]})]})})]})}function p({post:e,onBack:i,onUpdatePost:l,onDeletePost:n}){const o=a(),[c,d]=r.useState(e),[m,x]=r.useState(""),[h,u]=r.useState(null),[p,f]=r.useState(!1);r.useEffect(()=>{window.scrollTo(0,0);(async()=>{try{const{data:{user:e}}=await t.auth.getUser();if(e){const{data:s}=await t.from("users").select("*").eq("id",e.id).single();s&&u({...e,profile:s})}else{const e=localStorage.getItem("user");e&&u(JSON.parse(e))}}catch(e){const t=localStorage.getItem("user");t&&u(JSON.parse(t))}})()},[e]);const g=async()=>{if(m.trim())if(h)try{const e={post_id:c.id,user_id:h.id,author_name:h.profile?.name||"익명",avatar_url:h.profile?.avatar_url||"",content:m,likes:0},{data:s,error:a}=await t.from("post_comments").insert([e]).select().single();if(a)throw a;if(s){const e={id:s.id,author:s.author_name,avatar:s.avatar_url||"https://readdy.ai/api/search-image?query=Korean%20person%20profile%20avatar%2C%20friendly%20expression%2C%20professional%20portrait%20photography%2C%20soft%20natural%20lighting%2C%20clean%20white%20background%2C%20high%20quality%2C%20realistic&width=100&height=100&seq=myavatar&orientation=squarish",content:s.content,timeAgo:"방금 전",likes:0,isLiked:!1},t={...c,comments:[...c.comments,e]};d(t),l(t),x("")}}catch(e){alert("댓글 작성에 실패했습니다.")}else alert("로그인이 필요합니다.")};return s.jsxs("div",{className:"min-h-screen bg-slate-50",children:[s.jsx("div",{className:"bg-white/90 backdrop-blur-md border-b border-slate-100 sticky top-0 z-20",children:s.jsxs("div",{className:"flex items-center px-4 py-3 max-w-md mx-auto",children:[s.jsx("button",{onClick:i,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 transition-colors cursor-pointer group",children:s.jsx("i",{className:"ri-arrow-left-line text-xl text-slate-600 group-hover:text-primary-600 transition-colors"})}),s.jsx("h1",{className:"flex-1 text-center font-bold text-slate-800 font-display",children:"게시글"}),s.jsx("div",{className:"w-10"})]})}),s.jsx("div",{className:"px-4 py-6 pb-20",children:s.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-3xl shadow-lg shadow-primary-500/5 p-6 animate-slide-up",children:[s.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[s.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>o("/profile-detail",{state:{authorData:c.authorData||{id:c.id,name:c.author,avatar_url:c.avatar}}}),children:[s.jsx("img",{src:c.avatar,alt:c.author,className:"w-14 h-14 rounded-2xl object-cover object-top shadow-md group-hover:scale-105 transition-transform duration-300"}),s.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{onClick:()=>o("/profile-detail",{state:{authorData:c.authorData||{id:c.id,name:c.author,avatar_url:c.avatar}}}),className:"font-bold text-lg text-slate-800 cursor-pointer hover:text-primary-600 transition-colors font-display",children:c.author}),s.jsx("p",{className:"text-xs font-medium text-slate-400",children:c.timeAgo})]}),s.jsx("button",{onClick:()=>{c.userId!==h?.id&&c.userId!==h?.profile?.id||(async()=>{if(c.userId===h?.id||c.userId===h?.profile?.id){if(window.confirm("게시글을 삭제하시겠습니까?")){f(!0);try{const{error:e}=await t.from("community_posts").delete().eq("id",c.id);if(e)throw e;n&&n(c.id),alert("게시글이 삭제되었습니다."),i()}catch(e){alert("게시글 삭제 중 오류가 발생했습니다.")}finally{f(!1)}}}else alert("자신의 게시글만 삭제할 수 있습니다.")})()},disabled:p||c.userId!==h?.id&&c.userId!==h?.profile?.id,className:"w-8 h-8 flex items-center justify-center rounded-full text-slate-400 transition-all "+(c.userId===h?.id||c.userId===h?.profile?.id?"hover:bg-red-50 hover:text-red-500 cursor-pointer":"cursor-default opacity-0"),children:s.jsx("i",{className:"ri-"+(p?"loader-4-line animate-spin":"delete-bin-line")})})]}),s.jsx("p",{className:"text-slate-600 mb-6 text-base leading-relaxed whitespace-pre-wrap",children:c.content}),c.image&&s.jsx("div",{className:"rounded-2xl overflow-hidden mb-6 shadow-md",children:s.jsx("img",{src:c.image,alt:"게시글 이미지",className:"w-full h-auto object-cover hover:scale-105 transition-transform duration-500"})}),s.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-slate-50",children:s.jsxs("div",{className:"flex space-x-3 w-full",children:[s.jsxs("button",{onClick:async()=>{const e=c.isLiked?c.likes-1:c.likes+1,s={...c,isLiked:!c.isLiked,likes:e};d(s),l(s);try{await t.from("community_posts").update({likes:e}).eq("id",c.id)}catch(a){}},className:"flex-1 flex items-center justify-center space-x-2 py-3.5 rounded-xl transition-all cursor-pointer whitespace-nowrap group "+(c.isLiked?"bg-pink-50 text-pink-500 shadow-inner":"bg-slate-50 text-slate-500 hover:bg-slate-100"),children:[s.jsx("i",{className:"text-xl transition-transform group-hover:scale-110 "+(c.isLiked?"ri-heart-fill animate-pulse-soft":"ri-heart-line")}),s.jsxs("span",{className:"text-sm font-bold",children:["좋아요 ",c.likes>0&&c.likes]})]}),s.jsxs("button",{className:"flex-1 flex items-center justify-center space-x-2 py-3.5 rounded-xl bg-slate-50 text-slate-500 hover:bg-slate-100 transition-all cursor-pointer whitespace-nowrap group",children:[s.jsx("i",{className:"ri-chat-3-line text-xl group-hover:scale-110 transition-transform"}),s.jsxs("span",{className:"text-sm font-bold",children:["댓글 ",c.comments.length>0&&c.comments.length]})]})]})})]}),s.jsxs("div",{className:"bg-white rounded-3xl shadow-lg shadow-primary-500/5 p-6 animate-slide-up",style:{animationDelay:"0.1s"},children:[s.jsxs("h3",{className:"font-bold text-slate-800 mb-6 flex items-center",children:["댓글 ",s.jsx("span",{className:"ml-2 text-primary-500",children:c.comments.length})]}),s.jsxs("div",{className:"flex space-x-4 mb-8 pb-6 border-b border-slate-100",children:[s.jsx("img",{src:h?.avatar_url||h?.profile?.avatar_url||"https://readdy.ai/api/search-image?query=Korean%20person%20profile%20avatar%2C%20friendly%20expression%2C%20professional%20portrait%20photography%2C%20soft%20natural%20lighting%2C%20clean%20white%20background%2C%20high%20quality%2C%20realistic&width=100&height=100&seq=myavatar&orientation=squarish",alt:h?.name||"내 프로필",className:"w-12 h-12 rounded-full object-cover object-top flex-shrink-0 shadow-sm border-2 border-primary-100"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-xs font-bold text-slate-600 mb-2",children:h?.name||"사용자"}),s.jsxs("div",{className:"relative",children:[s.jsx("textarea",{value:m,onChange:e=>x(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),g())},placeholder:"댓글을 남겨보세요...",className:"w-full px-4 py-3 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm resize-none bg-white transition-all placeholder-slate-400 shadow-sm",rows:2,maxLength:500}),s.jsx("button",{onClick:g,disabled:!m.trim(),className:"absolute bottom-3 right-3 p-2 rounded-full transition-all "+(m.trim()?"bg-primary-500 text-white hover:bg-primary-600 shadow-md transform hover:scale-105":"bg-slate-200 text-slate-400 cursor-not-allowed"),children:s.jsx("i",{className:"ri-send-plane-fill"})})]})]})]}),c.comments.length>0?s.jsx("div",{className:"space-y-5",children:c.comments.map(e=>s.jsxs("div",{className:"flex space-x-3 group pb-5 border-b border-slate-50 last:border-b-0",children:[s.jsx("img",{src:e.avatar,alt:e.author,onClick:()=>o("/profile-detail",{state:{userId:e.id}}),className:"w-11 h-11 rounded-full object-cover object-top flex-shrink-0 cursor-pointer hover:opacity-80 transition-all shadow-sm border-2 border-slate-100 group-hover:border-primary-300"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("button",{onClick:()=>o("/profile-detail",{state:{userId:e.id}}),className:"font-bold text-sm text-slate-800 cursor-pointer hover:text-primary-600 hover:underline transition-colors",children:e.author}),s.jsx("span",{className:"text-xs font-medium text-slate-400",children:e.timeAgo})]}),s.jsx("div",{className:"bg-slate-50 rounded-2xl rounded-tl-none px-4 py-3 group-hover:bg-slate-100 transition-colors border border-slate-100 group-hover:border-primary-200",children:s.jsx("p",{className:"text-sm text-slate-700 leading-relaxed break-words",children:e.content})}),s.jsxs("div",{className:"flex items-center space-x-5 mt-2 ml-1",children:[s.jsxs("button",{onClick:()=>(async e=>{const s=c.comments.find(t=>t.id===e);if(!s)return;const a=s.isLiked?s.likes-1:s.likes+1,r={...c,comments:c.comments.map(t=>t.id===e?{...t,isLiked:!t.isLiked,likes:a}:t)};d(r),l(r);try{await t.from("post_comments").update({likes:a}).eq("id",e)}catch(i){}})(e.id),className:"flex items-center space-x-1.5 text-xs font-medium transition-all cursor-pointer group/like "+(e.isLiked?"text-pink-500":"text-slate-400 hover:text-pink-500"),children:[s.jsx("i",{className:(e.isLiked?"ri-heart-fill":"ri-heart-line")+" group-hover/like:scale-125 transition-transform"}),s.jsx("span",{children:e.likes>0?e.likes:"좋아요"})]}),s.jsx("button",{onClick:()=>alert("답글 기능 준비중입니다."),className:"text-xs font-medium text-slate-400 hover:text-primary-500 transition-colors cursor-pointer hover:font-semibold",children:"답글달기"})]})]})]},e.id))}):s.jsxs("div",{className:"text-center py-16 bg-gradient-to-br from-slate-50 to-slate-100 rounded-3xl border border-dashed border-slate-200",children:[s.jsx("div",{className:"w-20 h-20 flex items-center justify-center mx-auto mb-4 bg-white rounded-full shadow-md",children:s.jsx("i",{className:"ri-chat-smile-2-line text-4xl text-primary-300"})}),s.jsx("p",{className:"text-slate-600 font-semibold text-lg",children:"아직 댓글이 없어요"}),s.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"첫 번째 댓글의 주인공이 되어보세요!"})]})]})]})})]})}let f=null,g=0;function b(){const e=a(),[i,l]=r.useState("dating"),[n,o]=r.useState(f||[]),[c,m]=r.useState(""),[x,h]=r.useState(!1),[u,b]=r.useState(null),[j,v]=r.useState(!f),[y,w]=r.useState(void 0),[N,k]=r.useState(!1),_=r.useRef(!1);r.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("auth_user");if(s)try{const e=JSON.parse(s);return void w(e)}catch(e){}const{data:{user:a}}=await t.auth.getUser();if(a){w(a);try{const{data:e,error:s}=await t.from("users").select("*").eq("id",a.id).single();!s&&e&&w({...a,profile:e})}catch(e){}}else w(null)}catch(e){w(null)}})()},[]),r.useEffect(()=>{const e=Date.now();f&&e-g<3e5?(o(f),v(!1)):_.current||C()},[]);const C=async()=>{if(!_.current){_.current=!0,v(!0);try{const e=new Promise((e,t)=>setTimeout(()=>t(new Error("Timeout")),5e3)),s=t.from("community_posts").select("\n          *,\n          post_comments (\n            id,\n            author_name,\n            avatar_url,\n            content,\n            likes,\n            created_at\n          )\n        ").order("created_at",{ascending:!1}),{data:a,error:r}=await Promise.race([s,e]);if(r)throw r;if(!(a&&a.length>0))throw new Error("No data");{let e=[];if(y){const{data:s}=await t.from("community_post_likes").select("post_id").eq("user_id",y.id);e=s?.map(e=>e.post_id)||[]}const s=[...new Set(a.map(e=>e.user_id).filter(Boolean))];let r={};if(s.length>0){const{data:e}=await t.from("users").select("id, name, avatar_url, profile_image, age, location, gender, bio, school, job").in("id",s);e&&e.forEach(e=>{r[e.id]=e})}const i=a.map(t=>{const s=r[t.user_id],a=s?.name||t.author_name||"익명",i=s?.avatar_url||s?.profile_image||t.avatar_url||"https://via.placeholder.com/100";return{id:t.id,author:a,avatar:i,content:t.content,image:t.image_url,likes:t.likes,comments:t.post_comments?.map(e=>({id:e.id,author:e.author_name,avatar:e.avatar_url||"https://via.placeholder.com/100",content:e.content,timeAgo:q(e.created_at),likes:e.likes,isLiked:!1}))||[],timeAgo:q(t.created_at),isLiked:e.includes(t.id),age:s?.age||t.age,location:s?.location||t.location,job:s?.job||t.job,views:t.views,category:t.category,userId:t.user_id,authorData:s?{id:s.id,name:s.name||"익명",avatar_url:s.avatar_url||s.profile_image,age:s.age,location:s.location,gender:s.gender,bio:s.bio,school:s.school,job:s.job}:{id:t.user_id,name:t.author_name||"익명",avatar_url:t.avatar_url,age:t.age,location:t.location,gender:t.gender,bio:t.bio,school:t.school,job:t.job}}});f=i,g=Date.now(),o(i)}}catch(e){o([])}finally{v(!1),_.current=!1}}},q=e=>{const t=new Date,s=new Date(e),a=Math.floor((t.getTime()-s.getTime())/6e4);if(a<1)return"방금 전";if(a<60)return`${a}분 전`;const r=Math.floor(a/60);if(r<24)return`${r}시간 전`;return`${Math.floor(r/24)}일 전`},S=r.useMemo(()=>n.filter(e=>e.category===i),[n,i]),I=()=>{b(null),window.scrollTo(0,0)},$=e=>{o(n.map(t=>t.id===e.id?e:t))};return u?s.jsx(p,{post:u,onBack:I,onUpdatePost:$,onDeletePost:e=>{o(n.filter(t=>t.id!==e)),b(null)}}):s.jsxs("div",{className:"px-4 py-4 pb-20 min-h-screen",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-bold font-display text-slate-800 whitespace-nowrap",children:"커뮤니티"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("div",{className:"flex items-center space-x-1.5 bg-slate-50 px-2.5 py-1 rounded-full",children:[s.jsx("span",{className:"bg-gradient-to-r from-primary-500 to-primary-600 text-white text-[9px] font-bold px-1.5 py-0.5 rounded",children:"TODAY"}),s.jsx("span",{className:"text-primary-600 font-bold text-sm",children:"30,301"})]}),s.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 transition-colors cursor-pointer group",children:s.jsx("i",{className:"ri-equalizer-line text-lg text-slate-400 group-hover:text-primary-500 transition-colors"})}),s.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 transition-colors cursor-pointer group",children:s.jsx("i",{className:"ri-layout-grid-line text-lg text-slate-400 group-hover:text-primary-500 transition-colors"})})]})]}),s.jsxs("div",{className:"flex space-x-3 mb-6 overflow-x-auto pb-2 scrollbar-hide",children:[s.jsx("button",{onClick:()=>l("dating"),className:"px-5 py-2.5 rounded-full text-sm font-bold whitespace-nowrap cursor-pointer transition-all duration-300 "+("dating"===i?"bg-gradient-to-r from-primary-500 to-primary-600 text-white shadow-lg shadow-primary-500/30 scale-105":"bg-white text-slate-500 hover:bg-slate-50 border border-slate-100"),children:"셀프소개팅"}),s.jsx("button",{onClick:()=>l("chat"),className:"px-5 py-2.5 rounded-full text-sm font-bold whitespace-nowrap cursor-pointer transition-all duration-300 "+("chat"===i?"bg-gradient-to-r from-primary-500 to-primary-600 text-white shadow-lg shadow-primary-500/30 scale-105":"bg-white text-slate-500 hover:bg-slate-50 border border-slate-100"),children:"잡담"})]}),s.jsxs("div",{className:"flex space-x-2 mb-6",children:[s.jsx("button",{className:"px-4 py-1.5 bg-primary-50 text-primary-600 rounded-full text-xs font-bold whitespace-nowrap cursor-pointer border border-primary-100",children:"추천순"}),s.jsx("button",{className:"px-4 py-1.5 bg-white text-slate-400 rounded-full text-xs font-medium whitespace-nowrap cursor-pointer hover:bg-slate-50 border border-transparent hover:border-slate-100 transition-colors",children:"최신순"})]}),j?s.jsx(d,{}):s.jsx("div",{className:"space-y-3",children:S.map(e=>s.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden cursor-pointer hover:shadow-lg hover:border-primary-100 transition-all duration-300",onClick:()=>(async e=>{if(localStorage.getItem("auth_user")){try{await t.from("community_posts").update({views:(e.views||0)+1}).eq("id",e.id),o(n.map(t=>t.id===e.id?{...t,views:(t.views||0)+1}:t))}catch(s){}b(e)}else k(!0)})(e),children:s.jsxs("div",{className:"flex p-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("div",{className:"w-16 h-16 rounded-full p-0.5 bg-gradient-to-br from-pink-400 to-pink-500",children:s.jsx("img",{src:e.avatar,alt:e.author,className:"w-full h-full rounded-full object-cover border-2 border-white",onError:e=>{e.target.src="https://via.placeholder.com/100"}})})}),s.jsxs("div",{className:"flex-1 ml-3 min-w-0",children:[s.jsx("h3",{className:"text-[15px] font-bold text-slate-800 line-clamp-1 mb-1",children:e.content.split("\n")[0]}),s.jsxs("p",{className:"text-sm text-slate-500 mb-2",children:[e.author," (",e.location||"위치 미설정"," / ",e.age||"?","세 / ",e.job||"직업 미설정",")"]}),s.jsxs("div",{className:"flex items-center space-x-3 text-xs text-slate-400",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("i",{className:"ri-eye-line"}),s.jsx("span",{children:e.views||0})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("i",{className:"ri-chat-3-line"}),s.jsx("span",{children:e.comments.length})]}),s.jsx("span",{children:"|"}),s.jsx("span",{children:e.timeAgo})]})]}),e.image&&s.jsx("div",{className:"flex-shrink-0 ml-3",children:s.jsx("div",{className:"w-16 h-16 rounded-xl overflow-hidden",children:s.jsx("img",{src:e.image,alt:"게시물 이미지",className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}})})})]})},e.id))}),s.jsx("button",{onClick:()=>e("/post/create"),className:"fixed bottom-24 right-6 w-14 h-14 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-full shadow-lg shadow-primary-500/40 flex items-center justify-center hover:from-primary-600 hover:to-primary-700 hover:scale-110 transition-all cursor-pointer z-30 group",children:s.jsx("i",{className:"ri-add-line text-2xl group-hover:rotate-90 transition-transform duration-300"})}),x&&s.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-end animate-fade-in",children:s.jsxs("div",{className:"bg-white w-full rounded-t-[2rem] p-6 animate-slide-up shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h3",{className:"text-xl font-bold font-display text-slate-800",children:"새 글 작성"}),s.jsx("button",{onClick:()=>h(!1),className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 transition-colors cursor-pointer",children:s.jsx("i",{className:"ri-close-line text-xl text-slate-400"})})]}),s.jsx("textarea",{value:c,onChange:e=>m(e.target.value),placeholder:"무슨 일이 일어나고 있나요?",className:"w-full px-5 py-4 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm resize-none bg-slate-50 placeholder-slate-400 transition-all",rows:5,maxLength:500}),s.jsxs("div",{className:"flex justify-between items-center mt-4",children:[s.jsxs("span",{className:"text-xs font-medium text-slate-400",children:[c.length,"/500"]}),s.jsx("button",{onClick:async()=>{if(c.trim())if(y)try{const e={user_id:y.id,author_name:y.profile?.name||"익명",avatar_url:y.profile?.avatar_url||"",title:c.substring(0,50),content:`${y.profile?.name||"익명"} (${y.profile?.location||"위치 미설정"} / ${y.profile?.age||"나이 미설정"}세 / ${y.profile?.school||"직업 미설정"})`,image_url:y.profile?.avatar_url||"https://readdy.ai/api/search-image?query=Korean%20person%20casual%20portrait%2C%20friendly%20expression%2C%20natural%20lighting%2C%20clean%20background%2C%20high%20quality%2C%20realistic&width=400&height=500&seq=newpost&orientation=portrait",likes:0,views:0,category:i,age:y.profile?.age,location:y.profile?.location,job:y.profile?.school},{data:s,error:a}=await t.from("community_posts").insert([e]).select().single();if(a)throw a;if(s){const e={id:s.id,author:s.title,avatar:s.avatar_url,content:s.content,image:s.image_url,likes:0,comments:[],timeAgo:"방금 전",isLiked:!1,age:s.age,location:s.location,job:s.job,views:0,category:s.category};o([e,...n]),m(""),h(!1)}}catch(e){alert("게시글 작성에 실패했습니다.")}else alert("로그인이 필요합니다.")},className:"px-6 py-2.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-full hover:from-primary-600 hover:to-primary-700 transition-all cursor-pointer whitespace-nowrap text-sm font-bold shadow-lg shadow-primary-500/30",children:"게시하기"})]})]})}),N&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-md",onClick:()=>k(!1)}),s.jsxs("div",{className:"relative bg-white rounded-3xl p-8 max-w-sm w-full mx-4 text-center shadow-2xl",children:[s.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("i",{className:"ri-lock-line text-3xl text-primary-500"})}),s.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"로그인이 필요합니다"}),s.jsx("p",{className:"text-slate-500 text-sm mb-6",children:"게시글을 보려면 로그인해주세요"}),s.jsx("button",{onClick:()=>e("/login"),className:"w-full bg-gradient-to-r from-primary-500 to-primary-600 text-white py-3 rounded-2xl font-bold hover:from-primary-600 hover:to-primary-700 transition-all",children:"로그인하기"})]})]})]})}const j=e=>"male"===e?"https://readdy.ai/api/search-image?query=minimalist%20male%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=male-default-avatar&orientation=squarish":"https://readdy.ai/api/search-image?query=minimalist%20female%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=female-default-avatar&orientation=squarish";function v(){const{user:a}=e(),[i,l]=r.useState(null),[n,o]=r.useState(""),c=r.useRef(null),[d,m]=r.useState([]),[x,h]=r.useState({});r.useEffect(()=>{i&&c.current&&c.current.scrollIntoView({behavior:"smooth"})},[x,i]),r.useEffect(()=>{if(!a?.id)return;u();const e=t.channel("messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},()=>{u(),i&&p(i)}).subscribe();return()=>{e.unsubscribe()}},[a?.id,i]);const u=async()=>{if(a?.id)try{const{data:e}=await t.from("messages").select("sender_id, recipient_id").or(`sender_id.eq.${a.id},recipient_id.eq.${a.id}`).order("created_at",{ascending:!1}).limit(100);if(!e)return;const s=new Set;e.forEach(e=>{e.sender_id===a.id?s.add(e.recipient_id):s.add(e.sender_id)});const r=Array.from(s);if(0===r.length)return void m([]);const{data:i}=await t.from("users").select("id, name, profile_image, gender").in("id",r);if(!i)return void m([]);const l=Object.fromEntries(i.map(e=>[e.id,e])),n=[];for(const o of r){const e=l[o];if(!e)continue;const{data:s}=await t.from("messages").select("content, created_at, is_read, sender_id").or(`and(sender_id.eq.${a.id},recipient_id.eq.${o}),and(sender_id.eq.${o},recipient_id.eq.${a.id})`).order("created_at",{ascending:!1}).limit(1).maybeSingle();n.push({id:e.id,name:e.name||"사용자",avatar:e.profile_image||j(e.gender),lastMessage:s?.content||"Conversation started",lastMessageTime:s?new Date(s.created_at).toLocaleTimeString("ko-KR",{hour:"numeric",minute:"2-digit",hour12:!0}):"방금 전",unreadCount:s&&!s.is_read&&s.sender_id===o?1:0,isOnline:!0,gender:e.gender})}m(n)}catch(e){}},p=async e=>{if(a?.id)try{const{data:s}=await t.from("messages").select("id, sender_id, content, created_at, is_read").or(`and(sender_id.eq.${a.id},recipient_id.eq.${e}),and(sender_id.eq.${e},recipient_id.eq.${a.id})`).order("created_at",{ascending:!0});if(s){const r=s.map(e=>({id:e.id,senderId:e.sender_id,content:e.content,timestamp:new Date(e.created_at).toLocaleTimeString("ko-KR",{hour:"numeric",minute:"2-digit",hour12:!0}),isRead:e.is_read}));h(t=>({...t,[e]:r})),await t.from("messages").update({is_read:!0}).eq("recipient_id",a.id).eq("sender_id",e)}}catch(s){}},f=async()=>{if(n.trim()&&i&&a?.id)try{const{error:e}=await t.from("messages").insert({sender_id:a.id,recipient_id:i,content:n,is_read:!1});if(e)throw e;o("")}catch(e){alert("메시지 전송에 실패했습니다.")}},g=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),f())};if(i){const e=d.find(e=>e.id===i),t=x[i]||[];return s.jsxs("div",{className:"fixed inset-0 top-0 bottom-20 flex flex-col bg-slate-50 z-50",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-100 bg-white/90 backdrop-blur-md flex-shrink-0 pt-16",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:()=>l(null),className:"w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-slate-100 rounded-full transition-colors",children:s.jsx("i",{className:"ri-arrow-left-line text-xl text-slate-600"})}),s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:e?.avatar||j(e?.gender),alt:e?.name,loading:"lazy",decoding:"async",className:"w-10 h-10 rounded-full object-cover object-top shadow-sm",onError:t=>{t.target.src=j(e?.gender)}}),e?.isOnline&&s.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-bold text-slate-800 font-display",children:e?.name}),e?.isOnline&&s.jsx("span",{className:"text-[10px] text-green-500 font-medium",children:"온라인"})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{className:"w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-primary-500",children:s.jsx("i",{className:"ri-phone-line text-xl"})}),s.jsx("button",{className:"w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-primary-500",children:s.jsx("i",{className:"ri-video-line text-xl"})}),s.jsx("button",{className:"w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-primary-500",children:s.jsx("i",{className:"ri-more-line text-xl"})})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50",children:[t.map(t=>s.jsx("div",{className:`flex ${t.senderId===a?.id?"justify-end":"justify-start"} animate-slide-up`,children:s.jsxs("div",{className:"flex items-end space-x-2 max-w-[80%]",children:[t.senderId!==a?.id&&s.jsx("img",{src:e?.avatar||j(e?.gender),alt:e?.name,loading:"lazy",decoding:"async",className:"w-8 h-8 rounded-full object-cover object-top shadow-sm mb-1",onError:t=>{t.target.src=j(e?.gender)}}),s.jsx("div",{className:"px-5 py-3 rounded-2xl shadow-sm "+(t.senderId===a?.id?"bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-br-none":"bg-white text-slate-700 rounded-bl-none border border-slate-100"),children:s.jsx("p",{className:"text-sm leading-relaxed",children:t.content})})]})},t.id)),t.length>0&&s.jsx("div",{className:"text-center py-2",children:s.jsx("span",{className:"text-[10px] font-medium text-slate-400 bg-slate-100 px-3 py-1 rounded-full",children:t[t.length-1]?.timestamp})}),s.jsx("div",{ref:c})]}),s.jsx("div",{className:"p-4 bg-white border-t border-slate-100 flex-shrink-0",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{className:"w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-primary-500",children:s.jsx("i",{className:"ri-add-line text-xl"})}),s.jsxs("div",{className:"flex-1 relative",children:[s.jsx("input",{type:"text",value:n,onChange:e=>o(e.target.value),onKeyPress:g,placeholder:"메시지를 입력하세요...",className:"w-full px-5 py-3 bg-slate-50 rounded-full focus:outline-none focus:ring-2 focus:ring-primary-500 focus:bg-white transition-all text-sm border border-transparent focus:border-primary-200",maxLength:500}),s.jsx("button",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-primary-500 transition-colors",children:s.jsx("i",{className:"ri-emotion-line text-xl"})})]}),s.jsx("button",{onClick:f,disabled:!n.trim(),className:"w-10 h-10 rounded-full flex items-center justify-center transition-all cursor-pointer shadow-md "+(n.trim()?"bg-gradient-to-r from-primary-500 to-primary-600 text-white hover:scale-105 hover:shadow-primary-500/30":"bg-slate-100 text-slate-300 cursor-not-allowed"),children:s.jsx("i",{className:"ri-send-plane-fill text-lg"})})]})})]})}return s.jsx("div",{className:"px-4 py-6 pb-20 min-h-screen",children:s.jsxs("div",{className:"max-w-md mx-auto",children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsx("h2",{className:"text-2xl font-bold font-display text-slate-800",children:"채팅"}),s.jsx("div",{className:"flex space-x-2",children:s.jsx("button",{className:"w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center text-slate-400 hover:text-primary-500 hover:shadow-md transition-all",children:s.jsx("i",{className:"ri-search-line text-xl"})})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 px-2",children:"Recent Messages"}),d.map(e=>s.jsx("div",{onClick:()=>{return t=e.id,l(t),void p(t);var t},className:"bg-white rounded-3xl p-4 shadow-sm hover:shadow-lg hover:shadow-primary-500/5 transition-all duration-300 cursor-pointer border border-slate-50 group transform hover:-translate-y-0.5",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:e.avatar||j(e.gender),alt:e.name,loading:"lazy",decoding:"async",className:"w-14 h-14 rounded-2xl object-cover object-top shadow-sm group-hover:scale-105 transition-transform duration-300",onError:t=>{t.target.src=j(e.gender)}}),e.isOnline&&s.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white animate-pulse"})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("h3",{className:"font-bold text-slate-800 truncate text-base font-display group-hover:text-primary-600 transition-colors",children:e.name}),s.jsx("span",{className:"text-[10px] font-medium text-slate-400 bg-slate-50 px-2 py-0.5 rounded-full",children:e.lastMessageTime})]}),s.jsx("p",{className:"text-sm truncate "+(e.unreadCount>0?"text-slate-800 font-bold":"text-slate-500"),children:e.lastMessage})]}),e.unreadCount>0&&s.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-primary-600 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center shadow-lg shadow-primary-500/30 animate-bounce",children:e.unreadCount})]})},e.id))]}),0===d.length&&s.jsxs("div",{className:"text-center py-20",children:[s.jsx("div",{className:"w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse",children:s.jsx("i",{className:"ri-chat-3-line text-4xl text-slate-300"})}),s.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2 font-display",children:"아직 채팅이 없어요"}),s.jsx("p",{className:"text-slate-500",children:"매칭된 친구들과 대화를 시작해보세요!"})]})]})})}function y({width:e=320,height:t=100,className:a="",text:r="광고 영역"}){return s.jsx("div",{className:`flex items-center justify-center bg-gradient-to-r from-gray-100 to-gray-200 rounded-xl border-2 border-dashed border-gray-300 ${a}`,style:{width:`${e}px`,height:`${t}px`,maxWidth:"100%"},children:s.jsxs("div",{className:"text-center",children:[s.jsx("i",{className:"ri-advertisement-line text-2xl text-gray-400 mb-1"}),s.jsx("p",{className:"text-xs text-gray-500",children:r})]})})}const w=e=>"남자"===e||"male"===e?"https://readdy.ai/api/search-image?query=minimalist%20male%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=male-default-avatar&orientation=squarish":"https://readdy.ai/api/search-image?query=minimalist%20female%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=female-default-avatar&orientation=squarish";function N(){const i=a(),{user:l}=e(),[n,o]=r.useState({name:"사용자",age:0,gender:"여자",location:"위치 미설정",avatar:"",bio:"",interests:[]}),[c,d]=r.useState({received:0,sent:0}),[m,x]=r.useState(!0);r.useEffect(()=>{h(),u()},[l?.id]);const h=async()=>{try{if(!l?.id)return void x(!1);const{data:e,error:s}=await t.from("users").select("*").eq("id",l.id).single();if(s)return void x(!1);e&&o({name:e.name||"사용자",age:e.age||0,gender:"male"===e.gender?"남자":"여자",location:e.location||"위치 미설정",avatar:e.avatar_url||e.profile_image||"",bio:e.bio||"",interests:e.interests||[]})}catch(e){}finally{x(!1)}},u=async()=>{try{if(!l?.id)return;const{count:e}=await t.from("matching_requests").select("*",{count:"exact",head:!0}).eq("to_user_id",l.id).eq("status","pending"),{count:s}=await t.from("matching_requests").select("*",{count:"exact",head:!0}).eq("from_user_id",l.id).eq("status","pending");d({received:e||0,sent:s||0})}catch(e){}};if(m)return s.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-50 space-y-4",children:[s.jsxs("div",{className:"relative w-16 h-16",children:[s.jsx("div",{className:"absolute inset-0 border-4 border-slate-200 rounded-full"}),s.jsx("div",{className:"absolute inset-0 border-4 border-primary-500 border-t-transparent rounded-full animate-spin"})]}),s.jsx("div",{className:"text-sm font-medium text-slate-500",children:"프로필 로드 중..."})]});const p=()=>{i("/profile-edit")},f=()=>{i("/matching-requests")};return s.jsx("div",{className:"px-4 py-6 pb-20 min-h-screen",children:s.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-[2rem] shadow-lg shadow-primary-500/5 p-8 animate-slide-up relative overflow-hidden group",children:[s.jsx("div",{className:"absolute top-0 left-0 w-full h-32 bg-gradient-to-br from-primary-100 to-secondary-100 opacity-50"}),s.jsxs("div",{className:"relative text-center",children:[s.jsxs("div",{className:"relative inline-block mb-4",children:[s.jsx("div",{className:"p-1 bg-white rounded-full shadow-lg",children:s.jsx("img",{src:n.avatar||w(n.gender),alt:n.name,className:"w-28 h-28 rounded-full object-cover group-hover:scale-105 transition-transform duration-500",onError:e=>{e.target.src=w(n.gender)}})}),s.jsx("button",{onClick:p,className:"absolute bottom-2 right-2 w-9 h-9 bg-slate-800 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-black transition-colors cursor-pointer hover:scale-110 transform duration-300 border-2 border-white",children:s.jsx("i",{className:"ri-camera-line text-lg"})})]}),s.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-1 font-display",children:n.name}),s.jsxs("p",{className:"text-slate-500 mb-4 font-medium",children:[n.age,"세 · ",n.location]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("button",{onClick:p,className:"w-full bg-slate-800 text-white py-3 rounded-2xl font-bold hover:bg-black transition-all cursor-pointer whitespace-nowrap shadow-lg shadow-slate-200 hover:shadow-xl transform hover:-translate-y-0.5",children:"프로필 수정하기"}),s.jsxs("button",{onClick:()=>i("/my-profile"),className:"w-full bg-gradient-to-r from-primary-500 to-secondary-500 text-white py-3 rounded-2xl font-bold hover:from-primary-600 hover:to-secondary-600 transition-all cursor-pointer whitespace-nowrap flex items-center justify-center gap-2",children:[s.jsx("i",{className:"ri-eye-line"}),"내 프로필 미리보기"]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-[2rem] shadow-lg shadow-primary-500/5 p-6 animate-slide-up",style:{animationDelay:"0.1s"},children:[s.jsxs("div",{className:"flex items-center justify-between mb-5",children:[s.jsx("h3",{className:"font-bold text-lg text-slate-800 font-display",children:"매칭 현황"}),s.jsx("button",{onClick:f,className:"text-primary-500 text-sm font-medium hover:text-primary-600 cursor-pointer",children:"전체보기"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{onClick:f,className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-2xl p-4 cursor-pointer hover:shadow-md transition-all",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm",children:s.jsx("i",{className:"ri-heart-fill text-pink-500 text-xl"})}),s.jsx("span",{className:"text-2xl font-bold text-pink-600",children:c.received})]}),s.jsx("div",{className:"text-sm font-bold text-pink-700",children:"받은 요청"}),s.jsx("div",{className:"text-xs text-pink-500 mt-0.5",children:"새로운 관심 표시"})]}),s.jsxs("div",{onClick:f,className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-4 cursor-pointer hover:shadow-md transition-all",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm",children:s.jsx("i",{className:"ri-send-plane-fill text-blue-500 text-xl"})}),s.jsx("span",{className:"text-2xl font-bold text-blue-600",children:c.sent})]}),s.jsx("div",{className:"text-sm font-bold text-blue-700",children:"보낸 요청"}),s.jsx("div",{className:"text-xs text-blue-500 mt-0.5",children:"대기 중인 요청"})]})]})]}),s.jsx("div",{className:"animate-slide-up",style:{animationDelay:"0.2s"},children:s.jsx(y,{width:320,height:100,text:"광고 영역 1",className:"mx-auto"})}),s.jsx("div",{className:"animate-slide-up",style:{animationDelay:"0.25s"},children:s.jsx(y,{width:320,height:100,text:"광고 영역 2",className:"mx-auto"})}),s.jsx("div",{className:"bg-white rounded-[2rem] shadow-lg shadow-primary-500/5 p-4 animate-slide-up",style:{animationDelay:"0.3s"},children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("button",{onClick:()=>i("/settings"),className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-2xl transition-all cursor-pointer group",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center group-hover:bg-blue-100 transition-colors",children:s.jsx("i",{className:"ri-settings-3-line text-blue-500 text-xl"})}),s.jsx("span",{className:"font-bold text-slate-700 group-hover:text-slate-900",children:"설정"})]}),s.jsx("i",{className:"ri-arrow-right-s-line text-slate-300 group-hover:text-slate-500 text-xl transition-colors"})]}),s.jsxs("button",{onClick:()=>alert("개인정보 보호 정책 페이지 준비중입니다."),className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-2xl transition-all cursor-pointer group",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-full flex items-center justify-center group-hover:bg-green-100 transition-colors",children:s.jsx("i",{className:"ri-shield-check-line text-green-500 text-xl"})}),s.jsx("span",{className:"font-bold text-slate-700 group-hover:text-slate-900",children:"개인정보 보호"})]}),s.jsx("i",{className:"ri-arrow-right-s-line text-slate-300 group-hover:text-slate-500 text-xl transition-colors"})]}),s.jsxs("button",{onClick:()=>i("/support"),className:"w-full flex items-center justify-between p-4 hover:bg-slate-50 rounded-2xl transition-all cursor-pointer group",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-full flex items-center justify-center group-hover:bg-purple-100 transition-colors",children:s.jsx("i",{className:"ri-question-line text-purple-500 text-xl"})}),s.jsx("span",{className:"font-bold text-slate-700 group-hover:text-slate-900",children:"고객센터"})]}),s.jsx("i",{className:"ri-arrow-right-s-line text-slate-300 group-hover:text-slate-500 text-xl transition-colors"})]})]})})]})})}function k(){const t=a(),{user:n,loading:o}=e(),[c,d]=r.useState("matching"),[m]=r.useState(150);if(r.useEffect(()=>{if(!o){const e=localStorage.getItem("user");n||e||t("/login")}},[o,n,t]),o)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"로딩 중..."})]})});return s.jsxs("div",{className:"min-h-screen bg-slate-50",children:[s.jsx(i,{coins:m}),s.jsx("main",{className:"pb-28 px-4 max-w-screen-xl mx-auto",style:{paddingTop:"calc(5rem + env(safe-area-inset-top))"},children:(()=>{switch(c){case"matching":default:return s.jsx(u,{});case"community":return s.jsx(b,{});case"chat":return s.jsx(v,{});case"profile":return s.jsx(N,{})}})()}),s.jsx(l,{activeTab:c,onTabChange:d})]})}export{k as default};
