import{j as e,s,l}from"./index-C_8blxm2.js";import{e as a,u as o,r as t}from"./vendor-DkI5JUVe.js";import{M as r}from"./mbti-Cb-19GtP.js";import{K as n,g as i,s as c}from"./schools-BXrPHggY.js";import"./supabase-DEy9n1le.js";function d(){const d=a(),x=o(),[u,m]=t.useState({phone_number:"",name:"",age:20,gender:"male",location:"",bio:"",mbti:"",school:"",job:"",height:"160~165",body_type:"보통",style:"캐주얼",religion:"무교",smoking:"비흡연",drinking:"가끔",interests:[],profile_image:""}),[h,b]=t.useState(""),[p,g]=t.useState(!1),[y,f]=t.useState(""),[j,v]=t.useState(!1),[N,w]=t.useState(""),[k,_]=t.useState(""),[C,S]=t.useState([]);t.useEffect(()=>{const e=x.state?.phoneNumber;if(e){(async()=>{const{data:l}=await s.from("users").select("*").eq("phone_number",e).single();l&&m(e=>({...e,phone_number:l.phone_number,name:l.name,age:l.age||20,gender:l.gender||"male",location:l.location||"",bio:l.bio||"",mbti:l.mbti||"",school:l.school||"",job:l.job||""}))})()}},[x]);const q=()=>{h.trim()&&!u.interests.includes(h)&&(m(e=>({...e,interests:[...e.interests,h]})),b(""))};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 via-sky-50 to-blue-50 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"프로필 완성"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"추가 정보를 입력하여 더 나은 매칭을 받으세요"})]}),e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-8 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"MBTI"}),e.jsxs("select",{value:u.mbti,onChange:e=>m(s=>({...s,mbti:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 bg-white cursor-pointer",children:[e.jsx("option",{value:"",children:"MBTI를 선택하세요"}),r.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:[e.jsx("span",{className:"text-cyan-500",children:"거주지역"}),"을 선택해 주세요"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:N,onChange:e=>{w(e.target.value),m(e=>({...e,location:""}))},className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 bg-white appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"시/도 선택"}),n.map(s=>e.jsx("option",{value:s.sido,children:s.sido},s.sido))]}),e.jsx("i",{className:"ri-arrow-down-s-line absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:u.location?u.location.split(" ").slice(1).join(" "):"",onChange:e=>{e.target.value&&m(s=>({...s,location:`${N} ${e.target.value}`}))},className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 bg-white appearance-none cursor-pointer",disabled:!N,children:[e.jsx("option",{value:"",children:"시/군/구 선택"}),N&&i(N).map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx("i",{className:"ri-arrow-down-s-line absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]})]}),u.location&&e.jsxs("div",{className:"mt-2 bg-cyan-50 px-4 py-2 rounded-xl flex items-center",children:[e.jsx("i",{className:"ri-map-pin-line mr-2 text-cyan-500"}),e.jsx("span",{className:"text-cyan-700 font-medium",children:u.location})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:[e.jsx("span",{className:"text-cyan-500",children:"학교/직업"}),"을 입력해 주세요"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:k||u.school||u.job,onChange:e=>{_(e.target.value),S(c(e.target.value,8))},placeholder:"학교 또는 직업을 검색하세요",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500"}),C.length>0&&e.jsx("div",{className:"absolute z-20 w-full mt-1 bg-white border border-gray-200 rounded-xl shadow-lg max-h-48 overflow-y-auto",children:C.map(s=>e.jsx("button",{type:"button",onClick:()=>{s.includes("대학교")||s.includes("대학")||s.includes("학교")?m(e=>({...e,school:s,job:""})):m(e=>({...e,job:s,school:""})),_(""),S([])},className:"w-full px-4 py-3 text-left hover:bg-cyan-50 border-b border-gray-100 last:border-b-0 transition-colors",children:s},s))})]}),(u.school||u.job)&&e.jsxs("div",{className:"mt-2 bg-cyan-50 px-4 py-2 rounded-xl flex items-center justify-between",children:[e.jsx("span",{className:"text-cyan-700 font-medium",children:u.school||u.job}),e.jsx("button",{type:"button",onClick:()=>m(e=>({...e,school:"",job:""})),className:"text-cyan-500 hover:text-cyan-700",children:e.jsx("i",{className:"ri-close-line"})})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[e.jsx("i",{className:"ri-information-line mr-1 text-cyan-500"}),"직장인, 스타트업, 자영업 등도 검색 가능합니다"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"키"}),e.jsxs("select",{value:u.height,onChange:e=>m(s=>({...s,height:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"150~155",children:"150~155"}),e.jsx("option",{value:"155~160",children:"155~160"}),e.jsx("option",{value:"160~165",children:"160~165"}),e.jsx("option",{value:"165~170",children:"165~170"}),e.jsx("option",{value:"170~175",children:"170~175"}),e.jsx("option",{value:"175~180",children:"175~180"}),e.jsx("option",{value:"180~185",children:"180~185"}),e.jsx("option",{value:"185+",children:"185+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"체형"}),e.jsxs("select",{value:u.body_type,onChange:e=>m(s=>({...s,body_type:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"마름",children:"마름"}),e.jsx("option",{value:"보통",children:"보통"}),e.jsx("option",{value:"근육질",children:"근육질"}),e.jsx("option",{value:"통통",children:"통통"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"스타일"}),e.jsxs("select",{value:u.style,onChange:e=>m(s=>({...s,style:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"캐주얼",children:"캐주얼"}),e.jsx("option",{value:"포멀",children:"포멀"}),e.jsx("option",{value:"스포츠",children:"스포츠"}),e.jsx("option",{value:"클래식",children:"클래식"}),e.jsx("option",{value:"트렌디",children:"트렌디"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"종교"}),e.jsxs("select",{value:u.religion,onChange:e=>m(s=>({...s,religion:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"무교",children:"무교"}),e.jsx("option",{value:"기독교",children:"기독교"}),e.jsx("option",{value:"천주교",children:"천주교"}),e.jsx("option",{value:"불교",children:"불교"}),e.jsx("option",{value:"이슬람",children:"이슬람"}),e.jsx("option",{value:"기타",children:"기타"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"흡연"}),e.jsxs("select",{value:u.smoking,onChange:e=>m(s=>({...s,smoking:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"비흡연",children:"비흡연"}),e.jsx("option",{value:"흡연",children:"흡연"}),e.jsx("option",{value:"가끔",children:"가끔"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"음주"}),e.jsxs("select",{value:u.drinking,onChange:e=>m(s=>({...s,drinking:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"안함",children:"안함"}),e.jsx("option",{value:"가끔",children:"가끔"}),e.jsx("option",{value:"자주",children:"자주"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"관심사"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",value:h,onChange:e=>b(e.target.value),onKeyPress:e=>"Enter"===e.key&&q(),placeholder:"관심사 입력",maxLength:20,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500"}),e.jsx("button",{onClick:q,className:"px-4 py-3 bg-cyan-500 text-white rounded-xl hover:bg-cyan-600 transition-colors cursor-pointer whitespace-nowrap font-semibold",children:"추가"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.interests.map((s,l)=>e.jsxs("div",{className:"flex items-center gap-2 bg-cyan-100 text-cyan-800 px-3 py-2 rounded-full text-sm",children:[s,e.jsx("button",{onClick:()=>(e=>{m(s=>({...s,interests:s.interests.filter((s,l)=>l!==e)}))})(l),className:"text-cyan-600 hover:text-cyan-800 cursor-pointer",children:"×"})]},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"자기소개"}),e.jsx("textarea",{value:u.bio,onChange:e=>m(s=>({...s,bio:e.target.value})),placeholder:"자신을 소개해주세요...",maxLength:200,rows:4,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 resize-none"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[u.bio.length,"/200"]})]}),e.jsxs("div",{className:"text-center pt-6 border-t border-gray-100",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-800 mb-4",children:["프로필 사진 ",e.jsx("span",{className:"text-red-500",children:"*"})," (필수)"]}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"얼굴이 잘 나온 사진을 업로드해주세요"}),e.jsxs("div",{className:"relative inline-block mb-4",children:[j&&e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center z-10",children:e.jsx("i",{className:"ri-loader-4-line text-white text-2xl animate-spin"})}),e.jsx("img",{src:y||u.profile_image||"https://readdy.ai/api/search-image?query=minimalist%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=default-avatar&orientation=squarish",alt:"프로필",className:"w-32 h-32 rounded-full object-cover border-4 border-cyan-200",onError:e=>{e.target.src="https://readdy.ai/api/search-image?query=minimalist%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=default-avatar&orientation=squarish"}}),e.jsx("input",{type:"file",id:"profile-image-upload",accept:"image/*",onChange:async e=>{const a=e.target.files?.[0];if(!a)return;l.info("파일 선택",{name:a.name,type:a.type,size:a.size});if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(a.type))return void alert("JPG, PNG, WEBP, GIF 형식의 이미지만 업로드 가능합니다.");if(a.size>5242880)alert("이미지 크기는 5MB 이하여야 합니다.");else{v(!0);try{const e=`profile_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;l.info("업로드 시작",{fileName:e});const{error:o,data:t}=await s.storage.from("profile-images").upload(e,a,{cacheControl:"3600",upsert:!1});if(l.info("업로드 결과",{error:o,data:t}),o){let e=o.message||"알 수 없는 오류";return e.includes("Bucket not found")?e='⚠️ Supabase Storage가 제대로 설정되지 않았습니다.\n관리자에게 문의해주세요.\n\n기술 정보: "user-profiles" bucket이 없습니다.':(e.includes("401")||e.includes("Unauthorized"))&&(e="⚠️ 인증 오류: Supabase 설정을 확인해주세요."),alert("이미지 업로드 실패: "+e),void l.error("업로드 에러 상세",o)}const r=`${"https://ytffobltrwkgxiedorsd.supabase.co"}/storage/v1/object/public/profile-images/${e}`;l.info("생성된 공개 URL",{publicUrl:r}),f(r),alert("이미지가 업로드되었습니다!")}catch(o){l.error("업로드 중 오류",o),alert("업로드 중 오류: "+o.message)}finally{v(!1)}}},disabled:j,className:"hidden"}),e.jsx("label",{htmlFor:"profile-image-upload",className:"absolute bottom-0 right-0 w-10 h-10 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-full flex items-center justify-center shadow-lg transition-all cursor-pointer "+(j?"opacity-50 cursor-not-allowed":"hover:from-cyan-600 hover:to-blue-700"),children:e.jsx("i",{className:"ri-camera-line"})})]}),y||u.profile_image?e.jsx("p",{className:"text-sm text-green-500 font-semibold",children:"✓ 프로필 사진 완료"}):e.jsx("p",{className:"text-sm text-red-500 font-semibold",children:"프로필 사진을 업로드해주세요"})]}),e.jsxs("div",{className:"flex gap-3 pt-6",children:[e.jsx("button",{onClick:()=>d("/"),className:"flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors cursor-pointer font-semibold",children:"나중에"}),e.jsx("button",{onClick:async()=>{if(y||u.profile_image){l.info("프로필 저장",{uploadedImageUrl:y,profile_image:u.profile_image}),g(!0);try{const{error:e}=await s.from("users").update({mbti:u.mbti,location:u.location,bio:u.bio,school:u.school,job:u.job,height:u.height,body_type:u.body_type,style:u.style,religion:u.religion,smoking:u.smoking,drinking:u.drinking,interests:u.interests,profile_image:y||u.profile_image,profile_completed:!0}).eq("phone_number",u.phone_number);if(e)return alert("프로필 저장 실패: "+e.message),void l.error("저장 에러",e);alert("프로필이 완성되었습니다!"),d("/")}catch(e){alert("저장 중 오류: "+e.message)}finally{g(!1)}}else alert("프로필 사진을 업로드해주세요. (필수)")},disabled:p,className:"flex-1 px-4 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl hover:from-cyan-600 hover:to-blue-600 transition-colors disabled:opacity-50 cursor-pointer font-semibold",children:p?"저장 중...":"완성"})]})]})]})})}export{d as default};
