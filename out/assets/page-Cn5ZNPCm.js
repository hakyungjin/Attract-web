import{u as e,j as t,s as r}from"./index-B3GHrogv.js";import{e as n,r as s}from"./vendor-DkI5JUVe.js";import"./supabase-DEy9n1le.js";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function u(e,t,r){return(u=l()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var s=new(Function.bind.apply(e,n));return r&&c(s,r.prototype),s}).apply(null,arguments)}function d(e){var t="function"==typeof Map?new Map:void 0;return d=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return u(e,arguments,a(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,e)},d(e)}function m(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function x(e){var t=l();return function(){var r,n=a(e);if(t){var s=a(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return m(this,r)}}var f=null;function p(e){return window[e]}var b=function(){o(t,d(Error));var e=x(t);function t(r){var n;return i(this,t),(n=e.call(this,"[TossPayments SDK] ".concat(r," is not available"))).name="NamespaceNotAvailableError",n}return t}(),h=function(){o(t,d(Error));var e=x(t);function t(r){var n;return i(this,t),(n=e.call(this,"[TossPayments SDK] Failed to load script: [".concat(r,"]"))).name="ScriptLoadFailedError",n}return t}();function y(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).src,r=void 0===t?"https://js.tosspayments.com/v1":t;return"undefined"==typeof window?Promise.resolve({requestPayment:function(){throw new Error("[TossPayments SDK] It looks like runtime is not from browser. This method is only executable on browser.")},requestBillingAuth:function(){throw new Error("[TossPayments SDK] It looks like runtime is not from browser. This method is only executable on browser.")},cancelPayment:function(){throw new Error("[TossPayments SDK] It looks like runtime is not from browser. This method is only executable on browser.")}}):function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=f)return f;var n=new Promise(function(n,s){try{var i=function(){null!=p(t)?n(p(t)):s(new b(t))},o=function(){s(new h(e))};if("undefined"==typeof window||"undefined"==typeof document)return n(null);if(null!=p(t))return n(p(t));var a,c=document.querySelector('script[src="'.concat(e,'"]'));null!=c&&(c.removeEventListener("load",i),c.removeEventListener("error",o),null===(a=c.parentElement)||void 0===a||a.removeChild(c));var l=document.createElement("script");l.src=e,l.addEventListener("load",i),l.addEventListener("error",o),null!=r.priority&&(l.fetchPriority=r.priority),document.head.appendChild(l)}catch(u){return void s(u)}});return f=n.catch(function(e){return f=null,Promise.reject(e)})}(r,"TossPayments").then(function(t){return t(e)})}function g(){const i=n(),{user:o}=e(),[a,c]=s.useState(null),[l,u]=s.useState(!1),[d,m]=s.useState("토스페이"),[x,f]=s.useState(null),[p,b]=s.useState([]),[h,g]=s.useState(0),[j,v]=s.useState(!0);s.useEffect(()=>{(async()=>{try{const{data:e,error:t}=await r.from("coin_packages").select("*").order("display_order",{ascending:!0});if(t)b([{id:"basic",coins:50,price:5e3},{id:"standard",coins:100,price:9e3,bonus:10},{id:"premium",coins:300,price:25e3,bonus:50,popular:!0},{id:"vip",coins:500,price:4e4,bonus:100},{id:"mega",coins:1e3,price:75e3,bonus:250},{id:"ultra",coins:2e3,price:14e4,bonus:600}]);else if(e&&e.length>0){const t=e.map(e=>({id:e.id.toString(),name:e.name,coins:e.coins,price:e.price,bonus_coins:e.bonus_coins,bonus:e.bonus_coins,is_popular:e.is_popular,popular:e.is_popular}));b(t)}if(o?.id){const{data:e,error:t}=await r.from("users").select("coins").eq("id",o.id).single();!t&&e&&g(e.coins||0)}}catch(e){}finally{v(!1)}})()},[o]),s.useEffect(()=>{(async()=>{try{const e=await y("test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq");f(e)}catch(e){}})()},[]);return t.jsxs("div",{className:"min-h-screen bg-white",children:[t.jsx("div",{className:"border-b border-gray-100 sticky top-0 z-30 bg-white",children:t.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[t.jsx("button",{onClick:()=>i(-1),className:"w-10 h-10 flex items-center justify-center cursor-pointer",children:t.jsx("i",{className:"ri-arrow-left-line text-2xl text-gray-800"})}),t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"자석 충전"}),t.jsx("div",{className:"w-10"})]})}),t.jsxs("div",{className:"px-5 py-8 text-center border-b border-gray-100",children:[t.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"보유 자석"}),t.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t.jsx("img",{src:"/image/magnet.png",alt:"자석",className:"w-8 h-8"}),t.jsx("span",{className:"text-4xl font-bold text-gray-900",children:j?"...":h.toLocaleString()})]})]}),t.jsx("div",{className:"px-5 py-6",children:t.jsx("div",{className:"space-y-3",children:p.map(e=>t.jsxs("button",{onClick:()=>(e=>{c(e),u(!0)})(e),className:"w-full flex items-center justify-between p-5 rounded-2xl border-2 transition-all cursor-pointer "+(e.popular?"border-pink-500 bg-pink-50":"border-gray-200 bg-white hover:border-gray-300"),children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center "+(e.popular?"bg-pink-50":"bg-gray-100"),children:t.jsx("img",{src:"/image/magnet.png",alt:"자석",className:"w-8 h-8"})}),t.jsxs("div",{className:"text-left",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[t.jsx("span",{className:"text-2xl font-bold text-gray-900",children:e.coins.toLocaleString()}),(e.bonus||e.bonus_coins)&&t.jsxs("span",{className:"text-sm font-medium text-pink-500",children:["+",e.bonus_coins||e.bonus]})]}),(e.popular||e.is_popular)&&t.jsx("span",{className:"text-xs font-medium text-pink-500",children:"인기"})]})]}),t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"text-xl font-bold text-gray-900",children:[e.price.toLocaleString(),"원"]})})]},e.id))})}),l&&a&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center",children:t.jsxs("div",{className:"bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl overflow-hidden animate-slide-up",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-5 border-b border-gray-100",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"결제하기"}),t.jsx("button",{onClick:()=>u(!1),className:"w-9 h-9 flex items-center justify-center cursor-pointer",children:t.jsx("i",{className:"ri-close-line text-2xl text-gray-600"})})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"bg-gray-50 rounded-2xl p-5 mb-6",children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-12 h-12 bg-pink-50 rounded-full flex items-center justify-center",children:t.jsx("img",{src:"/images/magnet.png",alt:"자석",className:"w-8 h-8"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"자석"}),t.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[a.coins.toLocaleString(),(a.bonus||a.bonus_coins)&&t.jsxs("span",{className:"text-base text-pink-500 ml-1",children:["+",a.bonus_coins||a.bonus]})]})]})]})}),t.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[t.jsx("span",{className:"text-gray-600",children:"결제금액"}),t.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:[a.price.toLocaleString(),t.jsx("span",{className:"text-lg text-gray-600 ml-1",children:"원"})]})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("h4",{className:"font-bold text-gray-900 mb-3",children:"결제 수단"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("button",{onClick:()=>m("토스페이"),className:"w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all cursor-pointer "+("토스페이"===d?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center",children:t.jsx("span",{className:"text-white font-bold text-sm",children:"toss"})}),t.jsx("span",{className:"font-medium text-gray-900",children:"토스페이"})]}),"토스페이"===d&&t.jsx("i",{className:"ri-check-line text-xl text-blue-500"})]}),t.jsxs("button",{onClick:()=>m("CARD"),className:"w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all cursor-pointer "+("CARD"===d?"border-purple-500 bg-purple-50":"border-gray-200 bg-white"),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center",children:t.jsx("i",{className:"ri-bank-card-2-line text-white text-lg"})}),t.jsx("span",{className:"font-medium text-gray-900",children:"신용/체크카드"})]}),"CARD"===d&&t.jsx("i",{className:"ri-check-line text-xl text-purple-500"})]}),t.jsxs("button",{onClick:()=>m("TRANSFER"),className:"w-full flex items-center justify-between p-4 rounded-xl border-2 transition-all cursor-pointer "+("TRANSFER"===d?"border-green-500 bg-green-50":"border-gray-200 bg-white"),children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center",children:t.jsx("i",{className:"ri-bank-line text-white text-lg"})}),t.jsx("span",{className:"font-medium text-gray-900",children:"계좌이체"})]}),"TRANSFER"===d&&t.jsx("i",{className:"ri-check-line text-xl text-green-500"})]})]})]}),t.jsxs("button",{onClick:async()=>{if(a&&x){if(!o?.id)return alert("로그인이 필요합니다."),void i("/login");try{const e=`ORDER_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,t=a.bonus_coins||a.bonus||0,r=a.coins+t,n=`자석 ${a.coins}개${t>0?` (+${t} 보너스)`:""}`;localStorage.setItem("selectedPackageId",a.id),localStorage.setItem("selectedCoins",r.toString()),localStorage.setItem("selectedBonusCoins",t.toString()),localStorage.setItem("selectedPackageName",a.name||n),await x.requestPayment(d,{amount:a.price,orderId:e,orderName:n,successUrl:`${window.location.origin}/payment/success?orderId=${e}`,failUrl:`${window.location.origin}/payment/fail`,customerName:o.name||"사용자"})}catch(e){alert(e.message||"결제 요청에 실패했습니다. 다시 시도해주세요.")}}},className:"w-full bg-gray-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-800 transition-all cursor-pointer whitespace-nowrap",children:[a.price.toLocaleString(),"원 결제하기"]})]})]})})]})}export{g as default};
