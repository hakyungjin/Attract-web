import{j as e}from"./index-0bpRGtBK.js";import{u as s,r as t}from"./vendor-DiTsd9F_.js";import{s as a}from"./supabase-CdHtCIDc.js";import"./supabase-F6L96wRu.js";function l(){const l=s(),[i,r]=t.useState("dashboard"),[n,c]=t.useState(!0),[d,x]=t.useState(!1),[m,o]=t.useState([]),[h,u]=t.useState(null),[p,j]=t.useState(""),[f,g]=t.useState(!1),[N,b]=t.useState(""),[y,w]=t.useState([]),[v,_]=t.useState(null),[k,C]=t.useState([]),[S,L]=t.useState(!1),[U,z]=t.useState({totalUsers:0,activeUsers:0,totalCoins:0,totalChatRooms:0,totalMessages:0});t.useEffect(()=>{M()},[]);const M=async()=>{c(!0);try{const{data:e}=await a.from("users").select("*").order("created_at",{ascending:!1});if(e){o(e);const s=e.reduce((e,s)=>e+(s.coins||0),0);z(t=>({...t,totalUsers:e.length,activeUsers:e.filter(e=>e.last_login).length,totalCoins:s}))}const{count:s}=await a.from("chat_rooms").select("*",{count:"exact",head:!0}),{count:t}=await a.from("messages").select("*",{count:"exact",head:!0});z(e=>({...e,totalChatRooms:s||0,totalMessages:t||0}))}catch(e){}finally{c(!1)}},R=async()=>{c(!0);try{const{data:e,error:s}=await a.from("chat_rooms").select("*").order("last_message_at",{ascending:!1,nullsFirst:!1});if(s)throw s;if(e&&e.length>0){const s=new Set;e.forEach(e=>{s.add(e.user1_id),s.add(e.user2_id)});const{data:t}=await a.from("users").select("id, name, profile_image").in("id",Array.from(s)),l=new Map((t||[]).map(e=>[e.id,e])),i=await Promise.all(e.map(async e=>{const{count:s}=await a.from("messages").select("*",{count:"exact",head:!0}).eq("room_id",e.id),t=l.get(e.user1_id),i=l.get(e.user2_id);return{...e,user1_name:t?.name||"ì•Œ ìˆ˜ ì—†ìŒ",user2_name:i?.name||"ì•Œ ìˆ˜ ì—†ìŒ",user1_avatar:t?.profile_image,user2_avatar:i?.profile_image,message_count:s||0}}));w(i)}else w([])}catch(e){}finally{c(!1)}};t.useEffect(()=>{"chats"===i&&R()},[i]);const D=m.filter(e=>(e.name||"").toLowerCase().includes(p.toLowerCase())||(e.phone_number||"").includes(p)),q=e=>{r(e),x(!1)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"fixed top-0 left-0 right-0 bg-white shadow-sm z-30 px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>x(!0),className:"w-10 h-10 flex items-center justify-center",children:e.jsx("i",{className:"ri-menu-line text-xl text-gray-600"})}),e.jsx("h1",{className:"font-bold text-gray-800",children:"ê´€ë¦¬ì"}),e.jsx("button",{onClick:()=>l("/"),className:"w-10 h-10 flex items-center justify-center",children:e.jsx("i",{className:"ri-home-line text-xl text-gray-600"})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>x(!1)}),e.jsxs("div",{className:"fixed left-0 top-0 bottom-0 w-64 bg-white shadow-lg z-50 transform transition-transform "+(d?"translate-x-0":"-translate-x-full"),children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"ri-admin-line text-white text-xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-gray-800",children:"ê´€ë¦¬ì"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Admin Panel"})]})]}),e.jsx("button",{onClick:()=>x(!1),className:"w-8 h-8 flex items-center justify-center",children:e.jsx("i",{className:"ri-close-line text-xl text-gray-500"})})]}),e.jsxs("nav",{className:"p-4 space-y-2",children:[e.jsxs("button",{onClick:()=>q("dashboard"),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-colors "+("dashboard"===i?"bg-pink-50 text-pink-600":"text-gray-600"),children:[e.jsx("i",{className:"ri-dashboard-line text-xl"}),e.jsx("span",{className:"font-medium",children:"ëŒ€ì‹œë³´ë“œ"})]}),e.jsxs("button",{onClick:()=>q("users"),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-colors "+("users"===i?"bg-pink-50 text-pink-600":"text-gray-600"),children:[e.jsx("i",{className:"ri-user-line text-xl"}),e.jsx("span",{className:"font-medium",children:"ìœ ì € ê´€ë¦¬"})]}),e.jsxs("button",{onClick:()=>q("chats"),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-colors "+("chats"===i?"bg-pink-50 text-pink-600":"text-gray-600"),children:[e.jsx("i",{className:"ri-chat-3-line text-xl"}),e.jsx("span",{className:"font-medium",children:"ì±„íŒ… ê´€ë¦¬"})]}),e.jsxs("button",{onClick:()=>q("reports"),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-colors "+("reports"===i?"bg-pink-50 text-pink-600":"text-gray-600"),children:[e.jsx("i",{className:"ri-flag-line text-xl"}),e.jsx("span",{className:"font-medium",children:"ì‹ ê³  ê´€ë¦¬"})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 border-t",children:e.jsxs("button",{onClick:()=>l("/"),className:"w-full flex items-center space-x-3 px-4 py-3 text-gray-600 rounded-xl",children:[e.jsx("i",{className:"ri-logout-box-line text-xl"}),e.jsx("span",{className:"font-medium",children:"ë©”ì¸ìœ¼ë¡œ"})]})})]}),e.jsxs("div",{className:"p-4 pt-20 pb-8",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["dashboard"===i&&"ëŒ€ì‹œë³´ë“œ","users"===i&&"ìœ ì € ê´€ë¦¬","chats"===i&&"ì±„íŒ… ê´€ë¦¬","reports"===i&&"ì‹ ê³  ê´€ë¦¬"]})}),"dashboard"===i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ì „ì²´ ìœ ì €"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:U.totalUsers})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"í™œì„± ìœ ì €"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:U.activeUsers})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ì´ ì½”ì¸"}),e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:U.totalCoins.toLocaleString()})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ì±„íŒ…ë°©"}),e.jsx("p",{className:"text-xl font-bold text-purple-600",children:U.totalChatRooms})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm col-span-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ì´ ë©”ì‹œì§€"}),e.jsx("p",{className:"text-xl font-bold text-pink-600",children:U.totalMessages.toLocaleString()})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3",children:"ìµœê·¼ ê°€ì… ìœ ì €"}),e.jsx("div",{className:"space-y-2",children:m.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm",children:(s.name||"?")[0]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:s.name||"ì´ë¦„ ì—†ìŒ"}),e.jsx("p",{className:"text-xs text-gray-500",children:s.phone_number})]})]}),e.jsxs("p",{className:"text-xs font-medium text-yellow-600",children:[s.coins||0," ì½”ì¸"]})]},s.id))})]})]}),"users"===i&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:p,onChange:e=>j(e.target.value),placeholder:"ì´ë¦„ ë˜ëŠ” ì „í™”ë²ˆí˜¸ ê²€ìƒ‰...",className:"w-full pl-10 pr-4 py-2 bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm"}),e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"})]})}),e.jsx("div",{className:"divide-y divide-gray-100 max-h-[60vh] overflow-y-auto",children:D.map(s=>e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 flex items-center justify-center text-white font-bold overflow-hidden",children:s.profile_image?e.jsx("img",{src:s.profile_image,alt:"",className:"w-full h-full object-cover"}):(s.name||"?")[0]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:s.name||"ì´ë¦„ ì—†ìŒ"}),e.jsx("p",{className:"text-xs text-gray-500",children:s.phone_number||"-"})]})]}),e.jsx("button",{onClick:()=>u(s),className:"text-pink-500 text-sm font-medium",children:"ìƒì„¸"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx("i",{className:"ri-coin-line text-yellow-500 mr-1"}),s.coins||0]}),e.jsx("span",{children:"male"===s.gender?"ë‚¨":"female"===s.gender?"ì—¬":"-"}),e.jsx("span",{children:s.created_at?new Date(s.created_at).toLocaleDateString("ko-KR"):"-"})]})]},s.id))}),0===D.length&&e.jsx("div",{className:"p-8 text-center text-gray-500 text-sm",children:"ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."})]}),"chats"===i&&e.jsxs("div",{className:"space-y-4",children:[v&&e.jsxs("button",{onClick:()=>_(null),className:"flex items-center text-pink-500 text-sm",children:[e.jsx("i",{className:"ri-arrow-left-line mr-1"}),"ì±„íŒ…ë°© ëª©ë¡ìœ¼ë¡œ"]}),v?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("h3",{className:"font-bold text-gray-800 text-sm",children:["ğŸ’¬ ",v.user1_name," â†” ",v.user2_name]})}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto p-3",children:S?e.jsx("div",{className:"text-center text-gray-500 py-10 text-sm",children:"ë¡œë”© ì¤‘..."}):0===k.length?e.jsxs("div",{className:"text-center text-gray-500 py-10",children:[e.jsx("i",{className:"ri-message-3-line text-3xl text-gray-300 mb-2 block"}),e.jsx("p",{className:"text-sm",children:"ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤."})]}):e.jsx("div",{className:"space-y-2",children:k.map(s=>e.jsx("div",{className:"flex "+(s.sender_id===v.user1_id?"justify-start":"justify-end"),children:e.jsxs("div",{className:`max-w-[85%] ${s.sender_id===v.user1_id?"bg-blue-100 text-blue-900":"bg-pink-100 text-pink-900"} rounded-xl px-3 py-2`,children:[e.jsx("p",{className:"text-xs font-medium mb-1 opacity-70",children:s.sender_name}),e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:"text-[10px] mt-1 opacity-50",children:new Date(s.created_at).toLocaleString("ko-KR")})]})},s.id))})})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-gray-800 text-sm",children:"ì±„íŒ…ë°© ëª©ë¡"}),e.jsxs("button",{onClick:R,className:"text-xs text-pink-500",children:[e.jsx("i",{className:"ri-refresh-line mr-1"}),"ìƒˆë¡œê³ ì¹¨"]})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:n?e.jsx("div",{className:"p-8 text-center text-gray-500 text-sm",children:"ë¡œë”© ì¤‘..."}):0===y.length?e.jsx("div",{className:"p-8 text-center text-gray-500 text-sm",children:"ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤."}):y.map(s=>e.jsxs("div",{onClick:()=>(async e=>{_(e),L(!0);try{const{data:s,error:t}=await a.from("messages").select("*").eq("room_id",e.id).order("created_at",{ascending:!0});if(t)throw t;const l=new Set((s||[]).map(e=>e.sender_id)),{data:i}=await a.from("users").select("id, name").in("id",Array.from(l)),r=new Map((i||[]).map(e=>[e.id,e.name])),n=(s||[]).map(e=>({...e,sender_name:r.get(e.sender_id)||"ì•Œ ìˆ˜ ì—†ìŒ"}));C(n)}catch(s){}finally{L(!1)}})(s),className:"p-3 border-b cursor-pointer hover:bg-gray-50 active:bg-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-xs",children:(s.user1_name||"?")[0]}),e.jsx("i",{className:"ri-arrow-left-right-line text-gray-400 text-sm"}),e.jsx("div",{className:"w-7 h-7 rounded-full bg-pink-100 flex items-center justify-center text-pink-600 font-bold text-xs",children:(s.user2_name||"?")[0]})]}),e.jsxs("span",{className:"text-xs text-gray-400",children:[s.message_count,"ê°œ"]})]}),e.jsxs("p",{className:"text-sm font-medium text-gray-800",children:[s.user1_name," â†” ",s.user2_name]}),s.last_message&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1 truncate",children:['"',s.last_message,'"']})]},s.id))})]})]}),"reports"===i&&e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm text-center",children:[e.jsx("i",{className:"ri-flag-line text-3xl text-gray-300 mb-2 block"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"ì‹ ê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤"})]})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold",children:"ìœ ì € ìƒì„¸"}),e.jsx("button",{onClick:()=>u(null),children:e.jsx("i",{className:"ri-close-line text-xl"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 flex items-center justify-center text-white text-xl font-bold overflow-hidden",children:h.profile_image?e.jsx("img",{src:h.profile_image,alt:"",className:"w-full h-full object-cover"}):(h.name||"?")[0]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-800",children:h.name||"ì´ë¦„ ì—†ìŒ"}),e.jsx("p",{className:"text-gray-500 text-sm",children:h.phone_number})]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ë‚˜ì´"}),e.jsxs("p",{className:"font-medium text-sm",children:[h.age||"-","ì„¸"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ì„±ë³„"}),e.jsx("p",{className:"font-medium text-sm",children:"male"===h.gender?"ë‚¨ì„±":"female"===h.gender?"ì—¬ì„±":"-"})]})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ë³´ìœ  ì½”ì¸"}),e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:h.coins||0})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"ID"}),e.jsx("p",{className:"font-mono text-xs break-all",children:h.id})]})]}),e.jsxs("button",{onClick:()=>g(!0),className:"w-full py-3 bg-gradient-to-r from-yellow-400 to-yellow-500 text-white rounded-xl font-medium text-sm",children:[e.jsx("i",{className:"ri-coin-line mr-2"}),"ì½”ì¸ ì§€ê¸‰"]})]})]})}),f&&h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm p-4",children:[e.jsx("h3",{className:"font-bold mb-3",children:"ì½”ì¸ ì§€ê¸‰"}),e.jsxs("p",{className:"text-gray-500 mb-3 text-sm",children:[h.name,"ë‹˜ì—ê²Œ ì§€ê¸‰"]}),e.jsx("input",{type:"number",value:N,onChange:e=>b(e.target.value),placeholder:"ì½”ì¸ ìˆ˜",className:"w-full px-4 py-3 bg-gray-100 rounded-xl mb-4 text-sm"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{g(!1),b("")},className:"flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium text-sm",children:"ì·¨ì†Œ"}),e.jsx("button",{onClick:async()=>{if(h&&N)try{const e=(h.coins||0)+parseInt(N),{error:s}=await a.from("users").update({coins:e}).eq("id",h.id);if(s)throw s;o(s=>s.map(s=>s.id===h.id?{...s,coins:e}:s)),u(s=>s?{...s,coins:e}:null),g(!1),b(""),alert("ì½”ì¸ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!")}catch(e){alert("ì½”ì¸ ì§€ê¸‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},disabled:!N||parseInt(N)<=0,className:"flex-1 py-3 bg-yellow-500 text-white rounded-xl font-medium disabled:opacity-50 text-sm",children:"ì§€ê¸‰"})]})]})})]})}export{l as default};
