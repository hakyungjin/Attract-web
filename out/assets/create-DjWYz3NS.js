import{u as e,j as t}from"./index-0bpRGtBK.js";import{u as a,r as s}from"./vendor-DiTsd9F_.js";import{u as r}from"./imageUpload-CI3qHXbn.js";import{s as l}from"./supabase-CdHtCIDc.js";import"./supabase-F6L96wRu.js";function i(){const i=a(),{user:n}=e(),[o,c]=s.useState(""),[d,m]=s.useState("dating"),[u,g]=s.useState([]),[x,h]=s.useState([]),[b,p]=s.useState(!1),[f,y]=s.useState(!1),j=async e=>{if(e.preventDefault(),!o.trim())return void alert("내용을 입력해주세요.");const t=(()=>{if(n)return n;const e=localStorage.getItem("user");return e?JSON.parse(e):null})();if(!t)return alert("로그인이 필요합니다."),void i("/login");y(!0);try{const{data:e,error:a}=await l.from("community_posts").insert({user_id:t.id,author_name:t.name||"익명",avatar_url:t.avatar_url||"",title:o.substring(0,50),content:o.trim(),image_url:u.length>0?u[0]:null,likes:0,views:0,category:d,age:t.age,location:t.location,job:t.school||t.job}).select().single();if(a)throw a;alert("게시물이 작성되었습니다!"),i("/")}catch(a){alert(`게시물 작성에 실패했습니다: ${a.message}`)}finally{y(!1)}};return t.jsxs("div",{className:"min-h-screen bg-white",children:[t.jsx("div",{className:"border-b border-gray-100 sticky top-0 z-30 bg-white",children:t.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[t.jsx("button",{onClick:()=>i(-1),className:"text-gray-600 hover:text-gray-900",children:t.jsx("i",{className:"ri-close-line text-2xl"})}),t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"새 게시물"}),t.jsx("button",{onClick:j,disabled:f||!o.trim(),className:"text-pink-500 font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:f?"게시 중...":"게시"})]})}),t.jsxs("form",{onSubmit:j,className:"p-5",children:[t.jsxs("div",{className:"flex gap-2 mb-4",children:[t.jsx("button",{type:"button",onClick:()=>m("dating"),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors "+("dating"===d?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"소개팅"}),t.jsx("button",{type:"button",onClick:()=>m("chat"),className:"flex-1 py-2 px-4 rounded-lg font-medium transition-colors "+("chat"===d?"bg-cyan-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"잡담"})]}),t.jsx("textarea",{value:o,onChange:e=>c(e.target.value),placeholder:"무슨 생각을 하고 계신가요?",className:"w-full min-h-[200px] text-lg border-none outline-none resize-none",autoFocus:!0}),x.length>0&&t.jsx("div",{className:"grid grid-cols-2 gap-2 mt-4",children:x.map((e,a)=>t.jsxs("div",{className:"relative aspect-square",children:[t.jsx("img",{src:e,alt:`미리보기 ${a+1}`,className:"w-full h-full object-cover rounded-lg"}),t.jsx("button",{type:"button",onClick:()=>(e=>{g(t=>t.filter((t,a)=>a!==e)),h(t=>t.filter((t,a)=>a!==e))})(a),className:"absolute top-2 right-2 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center text-white hover:bg-black/70",children:t.jsx("i",{className:"ri-close-line text-lg"})})]},a))}),t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-5",children:t.jsxs("label",{className:"flex items-center justify-center w-full py-4 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer hover:border-pink-500 hover:bg-pink-50 transition-all "+(b?"opacity-50 cursor-not-allowed":""),children:[t.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:async e=>{const t=Array.from(e.target.files||[]);if(0!==t.length)if(u.length+t.length>5)alert("이미지는 최대 5개까지 업로드할 수 있습니다.");else{p(!0);try{const e=t.map(async e=>{const t=URL.createObjectURL(e);h(e=>[...e,t]);return await r(e,"posts","community")}),a=await Promise.all(e);g(e=>[...e,...a])}catch(a){alert("이미지 업로드에 실패했습니다.")}finally{p(!1)}}},className:"hidden",disabled:b||u.length>=5}),b?t.jsxs("span",{className:"text-gray-600",children:[t.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"업로드 중..."]}):t.jsxs("span",{className:"text-gray-600",children:[t.jsx("i",{className:"ri-image-add-line text-xl mr-2"}),"사진 추가 (",u.length,"/5)"]})]})})]})]})}export{i as default};
