import{s as e,u as s,j as t}from"./index-BQmPUlpM.js";import{d as r,e as a,r as i}from"./vendor-D2kRphhb.js";import"./supabase-XLYZcxPH.js";const l=async(s,t)=>{try{const{data:r,error:a}=await e.functions.invoke("send-push",{body:{userId:s,title:t.title,body:t.body,data:t.data||{}}});return a?{success:!1,error:a}:{success:!0,result:r}}catch(r){return{success:!1,error:r}}};function n(){const n=r(),c=a(),{user:o}=s(),d=c.state?.profile||c.state?.authorData,[m,x]=i.useState(0),[h,u]=i.useState(!1),[f,b]=i.useState(!1),[g,y]=i.useState(!1),[j,p]=i.useState(!1),[N,w]=i.useState(0),[v,_]=i.useState(0),[k,q]=i.useState(!1),[S,C]=i.useState(null),[T,$]=i.useState(null),I=50,z=(()=>{const e=localStorage.getItem("user");if(!e)return null;try{return JSON.parse(e).id}catch{return null}})(),E=z&&d?.id===z;i.useEffect(()=>{o||z||y(!0)},[o,z]),i.useEffect(()=>{(async()=>{if(!o?.id)return;const{data:s}=await e.from("users").select("coins").eq("id",o.id).single();s&&w(s.coins||0)})()},[o?.id]);const B=d?.photos&&d.photos.length>0?d.photos:[(M=d?.gender||"","ë‚¨ì"===M||"male"===M?"https://readdy.ai/api/search-image?query=minimalist%20male%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=male-default-avatar&orientation=squarish":"https://readdy.ai/api/search-image?query=minimalist%20female%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=female-default-avatar&orientation=squarish")];var M;if(!d)return n(-1),null;const D={school:d?.school||"ì •ë³´ì—†ìŒ",height:d?.height||"ì •ë³´ì—†ìŒ",bodyType:d?.bodyType||"ì •ë³´ì—†ìŒ",style:d?.style||"ì •ë³´ì—†ìŒ",religion:d?.religion||"ì •ë³´ì—†ìŒ",mbti:d?.mbti||"ESTP",smoking:d?.smoking||"ì •ë³´ì—†ìŒ",drinking:d?.drinking||"ì •ë³´ì—†ìŒ"},O=d?.interests||["ê´€ì‹¬ì‚¬"];return t.jsxs("div",{className:"min-h-screen bg-cyan-50 pb-24 "+(g?"overflow-hidden":""),children:[t.jsxs("div",{className:""+(g?"blur-sm pointer-events-none":""),children:[t.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:t.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[t.jsx("button",{onClick:()=>{n(-1)},className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors cursor-pointer",children:t.jsx("i",{className:"ri-arrow-left-s-line text-2xl"})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("img",{src:B[0],alt:d.name,className:"w-8 h-8 rounded-full object-cover"}),t.jsx("span",{className:"font-medium text-gray-800",children:d.name})]}),t.jsx("button",{onClick:()=>{window.confirm("ì´ ì‚¬ìš©ìë¥¼ ì‹ ê³  ë˜ëŠ” ì°¨ë‹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní™•ì¸: ì‹ ê³ í•˜ê¸°\nì·¨ì†Œ: ë‹«ê¸°")&&alert("ì‹ ê³  ê¸°ëŠ¥ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤. ê³ ê°ì„¼í„°ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.")},className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors cursor-pointer",children:t.jsx("i",{className:"ri-more-2-fill text-xl"})})]})}),t.jsx("div",{className:"relative bg-white",children:t.jsxs("div",{className:"relative h-96 overflow-hidden",children:[t.jsx("img",{src:B[v],alt:`${d.name} ì‚¬ì§„ ${v+1}`,className:"w-full h-full object-cover"}),B.length>1&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{_(e=>0===e?B.length-1:e-1)},className:"absolute left-3 top-1/2 -translate-y-1/2 w-10 h-10 bg-black/30 hover:bg-black/50 rounded-full flex items-center justify-center transition-colors cursor-pointer",children:t.jsx("i",{className:"ri-arrow-left-s-line text-white text-xl"})}),t.jsx("button",{onClick:()=>{_(e=>e===B.length-1?0:e+1)},className:"absolute right-3 top-1/2 -translate-y-1/2 w-10 h-10 bg-black/30 hover:bg-black/50 rounded-full flex items-center justify-center transition-colors cursor-pointer",children:t.jsx("i",{className:"ri-arrow-right-s-line text-white text-xl"})})]}),B.length>1&&t.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2",children:B.map((e,s)=>t.jsx("button",{onClick:()=>_(s),className:"w-2 h-2 rounded-full transition-colors cursor-pointer "+(s===v?"bg-white":"bg-white/50")},s))})]})}),t.jsxs("div",{className:"bg-white px-4 py-4 border-b",children:[t.jsx("div",{className:"flex items-center justify-center space-x-2",children:[1,2,3,4,5].map(e=>t.jsx("button",{onClick:()=>{return s=e,void(o?.id||z?x(s):y(!0));var s},className:"cursor-pointer",children:t.jsx("i",{className:"text-3xl "+(e<=m?"ri-star-fill text-yellow-400":"ri-star-line text-gray-300")})},e))}),t.jsx("p",{className:"text-center text-sm text-gray-500 mt-2",children:"í˜¸ê°ë„ë¥¼ ì²´í¬í•´ì£¼ì„¸ìš”"})]}),t.jsxs("div",{className:"px-4 py-6 space-y-4",children:[t.jsx("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:t.jsxs("div",{className:"grid grid-cols-2",children:[t.jsxs("div",{className:"border-b border-r border-gray-100 p-4",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"í•™êµ"}),t.jsx("div",{className:"font-medium text-gray-800",children:D.school})]}),t.jsxs("div",{className:"border-b border-gray-100 p-4",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"í‚¤"}),t.jsx("div",{className:"font-medium text-gray-800",children:D.height})]}),t.jsxs("div",{className:"border-b border-r border-gray-100 p-4",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ì²´í˜•"}),t.jsx("div",{className:"font-medium text-gray-800",children:D.bodyType})]}),t.jsxs("div",{className:"border-b border-gray-100 p-4",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ìŠ¤íƒ€ì¼"}),t.jsx("div",{className:"font-medium text-gray-800",children:D.style})]}),t.jsxs("div",{className:"border-b border-r border-gray-100 p-4",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ì¢…êµ"}),t.jsx("div",{className:"font-medium text-gray-800",children:D.religion})]}),t.jsxs("div",{className:"border-b border-gray-100 p-4",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"MBTI"}),t.jsx("div",{className:"font-medium text-gray-800",children:D.mbti})]}),t.jsxs("div",{className:"border-r border-gray-100 p-4",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"í¡ì—°"}),t.jsx("div",{className:"font-medium text-gray-800",children:D.smoking})]}),t.jsxs("div",{className:"p-4",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ìŒì£¼"}),t.jsx("div",{className:"font-medium text-gray-800",children:D.drinking})]})]})}),t.jsxs("button",{onClick:()=>alert("MBTI ê¶í•© ë¶„ì„ ê¸°ëŠ¥ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤."),className:"w-full bg-white rounded-2xl p-4 shadow-sm flex items-center justify-between hover:shadow-md transition-shadow cursor-pointer",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-full flex items-center justify-center",children:t.jsx("i",{className:"ri-heart-line text-white"})}),t.jsx("span",{className:"font-medium text-gray-800",children:"MBTI ê¶í•© ë³´ê¸°"})]}),t.jsx("i",{className:"ri-arrow-right-s-line text-xl text-gray-400"})]}),t.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[t.jsxs("h3",{className:"font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx("i",{className:"ri-heart-3-line mr-2 text-cyan-500"}),"ê´€ì‹¬ì‚¬"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:O.map((e,s)=>t.jsx("span",{className:"bg-cyan-50 text-cyan-600 px-4 py-2 rounded-full text-sm font-medium",children:e},s))})]}),t.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[t.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[t.jsx("i",{className:"ri-chat-quote-line mr-2 text-cyan-500"}),"ìê¸°ì†Œê°œ"]}),t.jsx("p",{className:"text-gray-700 leading-relaxed",children:d?.bio||"ìê¸°ì†Œê°œê°€ ì—†ìŠµë‹ˆë‹¤."})]})]}),!E&&t.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-cyan-50 px-8 py-6 flex justify-center space-x-8",children:[t.jsx("button",{onClick:()=>{o?.id&&d?.id?p(!0):y(!0)},className:"w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-lg hover:shadow-xl transition-shadow cursor-pointer border-2 border-cyan-200",children:t.jsx("i",{className:"ri-heart-fill text-cyan-400 text-2xl"})}),t.jsx("button",{onClick:()=>{n(-1)},className:"w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-lg hover:shadow-xl transition-shadow cursor-pointer border-2 border-gray-200",children:t.jsx("i",{className:"ri-close-line text-gray-400 text-2xl"})})]})]}),h&&t.jsx("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/80 text-white px-6 py-4 rounded-2xl z-50",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("i",{className:"ri-heart-fill text-pink-400"}),t.jsxs("span",{children:[d.name,"ë‹˜ì—ê²Œ ì¢‹ì•„ìš”ë¥¼ ë³´ëƒˆì–´ìš”!"]})]})}),j&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-sm w-full text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx("i",{className:"ri-magnet-line text-white text-2xl"})}),t.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"í•˜íŠ¸ë¥¼ ë³´ë‚´ì‹œê² ì–´ìš”?"}),t.jsxs("p",{className:"text-gray-600 mb-2",children:[t.jsx("span",{className:"font-bold text-cyan-600",children:d.name}),"ë‹˜ì—ê²Œ",t.jsx("br",{}),"í•˜íŠ¸ë¥¼ ë³´ë‚´ë ¤ë©´ ìì„ ",t.jsxs("span",{className:"font-bold text-cyan-600",children:[I,"ê°œ"]}),"ê°€ ì†Œëª¨ë©ë‹ˆë‹¤."]}),t.jsx("div",{className:"bg-cyan-50 rounded-xl p-3 mb-4",children:t.jsxs("p",{className:"text-sm text-cyan-700",children:[t.jsx("i",{className:"ri-information-line mr-1"}),"ìƒëŒ€ê°€ ê±°ì ˆí•˜ë©´ ìì„ì´ í™˜ë¶ˆë©ë‹ˆë‹¤"]})}),t.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["ë³´ìœ  ìì„: ",t.jsxs("span",{className:"font-bold",children:[N,"ê°œ"]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("button",{onClick:async()=>{p(!1);try{if(!o?.id||!d?.id)return void y(!0);if(N<I)return alert(`ìì„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. í˜„ì¬ ${N}ê°œ ë³´ìœ  ì¤‘`),void n("/coin-shop");const s=String(o.id),t=String(d.id),{data:r}=await e.from("matching_requests").select("id").eq("from_user_id",t).eq("to_user_id",s).eq("status","pending").limit(1),a=r&&r.length>0,{data:i}=await e.from("matching_requests").select("id").eq("from_user_id",s).eq("to_user_id",t).limit(1);if(i&&i.length>0)return void alert("ì´ë¯¸ ë§¤ì¹­ ìš”ì²­ì„ ë³´ë‚¸ ìƒëŒ€ì…ë‹ˆë‹¤");const{error:c}=await e.from("users").update({coins:N-I}).eq("id",o.id);if(c)return void alert("ìì„ ì°¨ê°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");w(e=>e-I);const{data:m,error:x}=await e.from("matching_requests").insert({from_user_id:s,to_user_id:t,status:a?"accepted":"pending"}).select();if(x){if("23505"===x.code)return void alert("ì´ë¯¸ ë§¤ì¹­ ìš”ì²­ì„ ë³´ë‚¸ ìƒëŒ€ì…ë‹ˆë‹¤");throw x}if(a){await e.from("matching_requests").update({status:"accepted"}).eq("from_user_id",t).eq("to_user_id",s);const{data:r,error:a}=await e.from("chat_rooms").insert({user1_id:s,user2_id:t,created_at:(new Date).toISOString()}).select().single();await e.from("notifications").insert([{user_id:t,type:"match_success",title:"ë§¤ì¹­ ì„±ì‚¬! ğŸ’•",message:`${o.name||"ëˆ„êµ°ê°€"}ë‹˜ê³¼ ë§¤ì¹­ë˜ì—ˆìŠµë‹ˆë‹¤! ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”.`,data:{matched_user_id:s,chat_room_id:r?.id},read:!1},{user_id:s,type:"match_success",title:"ë§¤ì¹­ ì„±ì‚¬! ğŸ’•",message:`${d.name}ë‹˜ê³¼ ë§¤ì¹­ë˜ì—ˆìŠµë‹ˆë‹¤! ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”.`,data:{matched_user_id:t,chat_room_id:r?.id},read:!1}]),await(async(e,s,t)=>l(e,{title:"ğŸ‰ ë§¤ì¹­ ì„±ì‚¬!",body:`${s}ë‹˜ê³¼ ë§¤ì¹­ë˜ì—ˆìŠµë‹ˆë‹¤! ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”.`,data:{type:"match_success",chat_room_id:t||""}}))(t,o.name||"ëˆ„êµ°ê°€",r?.id),b(!0)}else await e.from("notifications").insert({user_id:t,type:"match_request",title:"ìƒˆë¡œìš´ ë§¤ì¹­ ìš”ì²­",message:`${o.name||"ëˆ„êµ°ê°€"}ë‹˜ì´ ë§¤ì¹­ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤`,data:{from_user_id:s,from_user_name:o.name},read:!1}),await(async(e,s,t)=>l(e,{title:"ğŸ’• ìƒˆë¡œìš´ ë§¤ì¹­ ìš”ì²­",body:`${s}ë‹˜ì´ ë§¤ì¹­ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤`,data:{type:"match_request",from_user_id:t}}))(t,o.name||"ëˆ„êµ°ê°€",s),u(!0),setTimeout(()=>{u(!1),n(-1)},2e3)}catch(s){alert("ë§¤ì¹­ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: "+(s?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"))}},disabled:N<I,className:"w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white py-3 rounded-full font-medium hover:from-cyan-600 hover:to-blue-700 transition-all cursor-pointer whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",children:N<I?"ìì„ ë¶€ì¡±":"í™•ì¸"}),t.jsx("button",{onClick:()=>p(!1),className:"w-full bg-gray-100 text-gray-600 py-3 rounded-full font-medium hover:bg-gray-200 transition-colors cursor-pointer whitespace-nowrap",children:"ì·¨ì†Œ"})]})]})}),f&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-sm w-full text-center",children:[t.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx("i",{className:"ri-heart-fill text-white text-3xl"})}),t.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2",children:"ë§¤ì¹­ ì„±ê³µ! ğŸ‰"}),t.jsxs("p",{className:"text-gray-600 mb-6",children:[d.name,"ë‹˜ê³¼ ì„œë¡œ ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ì–´ìš”!",t.jsx("br",{}),"ì§€ê¸ˆ ë°”ë¡œ ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”."]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("button",{onClick:()=>{b(!1);const e=new CustomEvent("openChat",{detail:{userId:d.id,userName:d.name,userAvatar:B[0]||""}});window.dispatchEvent(e),n("/")},className:"w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white py-3 rounded-full font-medium hover:from-cyan-600 hover:to-blue-700 transition-all cursor-pointer whitespace-nowrap",children:"ëŒ€í™” ì‹œì‘í•˜ê¸°"}),t.jsx("button",{onClick:()=>b(!1),className:"w-full bg-gray-100 text-gray-600 py-3 rounded-full font-medium hover:bg-gray-200 transition-colors cursor-pointer whitespace-nowrap",children:"ë‚˜ì¤‘ì—"})]})]})}),g&&t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-md"}),t.jsxs("div",{className:"relative bg-white rounded-3xl p-8 max-w-sm w-full mx-4 text-center shadow-2xl",children:[t.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx("i",{className:"ri-lock-line text-white text-3xl"})}),t.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-3",children:"ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤"}),t.jsxs("p",{className:"text-gray-600 mb-6",children:["í”„ë¡œí•„ ìƒì„¸ ì •ë³´ë¥¼ ë³´ë ¤ë©´",t.jsx("br",{}),"ë¡œê·¸ì¸ì´ í•„ìš”í•´ìš”"]}),t.jsx("button",{onClick:()=>n("/login"),className:"w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white py-4 rounded-full font-bold hover:from-cyan-600 hover:to-blue-700 transition-all shadow-lg cursor-pointer whitespace-nowrap",children:"ë‹«ê¸°"})]})]})]})}export{n as default};
