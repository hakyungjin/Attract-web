import{j as e,f as s,l}from"./index-0bpRGtBK.js";import{u as a,b as o,r as t}from"./vendor-DiTsd9F_.js";import{u as r}from"./imageUpload-CI3qHXbn.js";import{M as n}from"./mbti-Cb-19GtP.js";import{K as i,g as c,s as d}from"./schools-BXrPHggY.js";import"./supabase-F6L96wRu.js";function x(){const x=a(),u=o(),[m,h]=t.useState({phone_number:"",name:"",age:20,gender:"male",location:"",bio:"",mbti:"",school:"",job:"",height:"160~165",body_type:"보통",style:"캐주얼",religion:"무교",smoking:"비흡연",drinking:"가끔",interests:[],profile_image:""}),[b,p]=t.useState(""),[g,y]=t.useState(!1),[j,f]=t.useState(""),[v,N]=t.useState(!1),[w,k]=t.useState(""),[C,_]=t.useState(""),[S,U]=t.useState([]);t.useEffect(()=>{const e=u.state?.phoneNumber;if(e){(async()=>{const{user:l}=await s.users.findUserByPhoneNumber(e);l&&h(e=>({...e,phone_number:l.phone_number,name:l.name,age:l.age||20,gender:l.gender||"male",location:l.location||"",bio:l.bio||"",mbti:l.mbti||"",school:l.school||"",job:l.job||""}))})()}},[u]);const q=()=>{b.trim()&&!m.interests.includes(b)&&(h(e=>({...e,interests:[...e.interests,b]})),p(""))};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 via-sky-50 to-blue-50 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"프로필 완성"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"추가 정보를 입력하여 더 나은 매칭을 받으세요"})]}),e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-8 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"MBTI"}),e.jsxs("select",{value:m.mbti,onChange:e=>h(s=>({...s,mbti:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 bg-white cursor-pointer",children:[e.jsx("option",{value:"",children:"MBTI를 선택하세요"}),n.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:[e.jsx("span",{className:"text-cyan-500",children:"거주지역"}),"을 선택해 주세요"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:w,onChange:e=>{k(e.target.value),h(e=>({...e,location:""}))},className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 bg-white appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:"시/도 선택"}),i.map(s=>e.jsx("option",{value:s.sido,children:s.sido},s.sido))]}),e.jsx("i",{className:"ri-arrow-down-s-line absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:m.location?m.location.split(" ").slice(1).join(" "):"",onChange:e=>{e.target.value&&h(s=>({...s,location:`${w} ${e.target.value}`}))},className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 bg-white appearance-none cursor-pointer",disabled:!w,children:[e.jsx("option",{value:"",children:"시/군/구 선택"}),w&&c(w).map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx("i",{className:"ri-arrow-down-s-line absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]})]}),m.location&&e.jsxs("div",{className:"mt-2 bg-cyan-50 px-4 py-2 rounded-xl flex items-center",children:[e.jsx("i",{className:"ri-map-pin-line mr-2 text-cyan-500"}),e.jsx("span",{className:"text-cyan-700 font-medium",children:m.location})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:[e.jsx("span",{className:"text-cyan-500",children:"학교/직업"}),"을 입력해 주세요"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:C||m.school||m.job,onChange:e=>{_(e.target.value),U(d(e.target.value,8))},placeholder:"학교 또는 직업을 검색하세요",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500"}),S.length>0&&e.jsx("div",{className:"absolute z-20 w-full mt-1 bg-white border border-gray-200 rounded-xl shadow-lg max-h-48 overflow-y-auto",children:S.map(s=>e.jsx("button",{type:"button",onClick:()=>{s.includes("대학교")||s.includes("대학")||s.includes("학교")?h(e=>({...e,school:s,job:""})):h(e=>({...e,job:s,school:""})),_(""),U([])},className:"w-full px-4 py-3 text-left hover:bg-cyan-50 border-b border-gray-100 last:border-b-0 transition-colors",children:s},s))})]}),(m.school||m.job)&&e.jsxs("div",{className:"mt-2 bg-cyan-50 px-4 py-2 rounded-xl flex items-center justify-between",children:[e.jsx("span",{className:"text-cyan-700 font-medium",children:m.school||m.job}),e.jsx("button",{type:"button",onClick:()=>h(e=>({...e,school:"",job:""})),className:"text-cyan-500 hover:text-cyan-700",children:e.jsx("i",{className:"ri-close-line"})})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[e.jsx("i",{className:"ri-information-line mr-1 text-cyan-500"}),"직장인, 스타트업, 자영업 등도 검색 가능합니다"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"키"}),e.jsxs("select",{value:m.height,onChange:e=>h(s=>({...s,height:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"150~155",children:"150~155"}),e.jsx("option",{value:"155~160",children:"155~160"}),e.jsx("option",{value:"160~165",children:"160~165"}),e.jsx("option",{value:"165~170",children:"165~170"}),e.jsx("option",{value:"170~175",children:"170~175"}),e.jsx("option",{value:"175~180",children:"175~180"}),e.jsx("option",{value:"180~185",children:"180~185"}),e.jsx("option",{value:"185+",children:"185+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"체형"}),e.jsxs("select",{value:m.body_type,onChange:e=>h(s=>({...s,body_type:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"마름",children:"마름"}),e.jsx("option",{value:"보통",children:"보통"}),e.jsx("option",{value:"근육질",children:"근육질"}),e.jsx("option",{value:"통통",children:"통통"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"스타일"}),e.jsxs("select",{value:m.style,onChange:e=>h(s=>({...s,style:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"캐주얼",children:"캐주얼"}),e.jsx("option",{value:"포멀",children:"포멀"}),e.jsx("option",{value:"스포츠",children:"스포츠"}),e.jsx("option",{value:"클래식",children:"클래식"}),e.jsx("option",{value:"트렌디",children:"트렌디"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"종교"}),e.jsxs("select",{value:m.religion,onChange:e=>h(s=>({...s,religion:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"무교",children:"무교"}),e.jsx("option",{value:"기독교",children:"기독교"}),e.jsx("option",{value:"천주교",children:"천주교"}),e.jsx("option",{value:"불교",children:"불교"}),e.jsx("option",{value:"이슬람",children:"이슬람"}),e.jsx("option",{value:"기타",children:"기타"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"흡연"}),e.jsxs("select",{value:m.smoking,onChange:e=>h(s=>({...s,smoking:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"비흡연",children:"비흡연"}),e.jsx("option",{value:"흡연",children:"흡연"}),e.jsx("option",{value:"가끔",children:"가끔"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"음주"}),e.jsxs("select",{value:m.drinking,onChange:e=>h(s=>({...s,drinking:e.target.value})),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"안함",children:"안함"}),e.jsx("option",{value:"가끔",children:"가끔"}),e.jsx("option",{value:"자주",children:"자주"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"관심사"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",value:b,onChange:e=>p(e.target.value),onKeyPress:e=>"Enter"===e.key&&q(),placeholder:"관심사 입력",maxLength:20,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500"}),e.jsx("button",{onClick:q,className:"px-4 py-3 bg-cyan-500 text-white rounded-xl hover:bg-cyan-600 transition-colors cursor-pointer whitespace-nowrap font-semibold",children:"추가"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.interests.map((s,l)=>e.jsxs("div",{className:"flex items-center gap-2 bg-cyan-100 text-cyan-800 px-3 py-2 rounded-full text-sm",children:[s,e.jsx("button",{onClick:()=>(e=>{h(s=>({...s,interests:s.interests.filter((s,l)=>l!==e)}))})(l),className:"text-cyan-600 hover:text-cyan-800 cursor-pointer",children:"×"})]},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"자기소개"}),e.jsx("textarea",{value:m.bio,onChange:e=>h(s=>({...s,bio:e.target.value})),placeholder:"자신을 소개해주세요...",maxLength:200,rows:4,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-cyan-500 resize-none"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[m.bio.length,"/200"]})]}),e.jsxs("div",{className:"text-center pt-6 border-t border-gray-100",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-800 mb-4",children:["프로필 사진 ",e.jsx("span",{className:"text-red-500",children:"*"})," (필수)"]}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"얼굴이 잘 나온 사진을 업로드해주세요"}),e.jsxs("div",{className:"relative inline-block mb-4",children:[v&&e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center z-10",children:e.jsx("i",{className:"ri-loader-4-line text-white text-2xl animate-spin"})}),e.jsx("img",{src:j||m.profile_image||"https://readdy.ai/api/search-image?query=minimalist%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=default-avatar&orientation=squarish",alt:"프로필",className:"w-32 h-32 rounded-full object-cover border-4 border-cyan-200",onError:e=>{e.target.src="https://readdy.ai/api/search-image?query=minimalist%20silhouette%20profile%20avatar%20icon%20on%20clean%20white%20background%20simple%20modern%20design%20professional%20business%20style%20neutral%20gray%20color%20scheme%20front%20facing%20head%20and%20shoulders%20portrait%20clean%20lines%20vector%20style%20illustration&width=300&height=300&seq=default-avatar&orientation=squarish"}}),e.jsx("input",{type:"file",id:"profile-image-upload",accept:"image/*",onChange:async e=>{const s=e.target.files?.[0];if(!s)return;l.info("파일 선택",{name:s.name,type:s.type,size:s.size});if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(s.type))return void alert("JPG, PNG, WEBP, GIF 형식의 이미지만 업로드 가능합니다.");if(s.size>5242880)alert("이미지 크기는 5MB 이하여야 합니다.");else{N(!0);try{l.info("Firebase Storage 업로드 시작");const e=await r(s,"avatars");l.info("생성된 공개 URL",{publicUrl:e}),f(e),alert("이미지가 업로드되었습니다!")}catch(a){l.error("업로드 중 오류",a),alert("업로드 중 오류: "+a.message)}finally{N(!1)}}},disabled:v,className:"hidden"}),e.jsx("label",{htmlFor:"profile-image-upload",className:"absolute bottom-0 right-0 w-10 h-10 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-full flex items-center justify-center shadow-lg transition-all cursor-pointer "+(v?"opacity-50 cursor-not-allowed":"hover:from-cyan-600 hover:to-blue-700"),children:e.jsx("i",{className:"ri-camera-line"})})]}),j||m.profile_image?e.jsx("p",{className:"text-sm text-green-500 font-semibold",children:"✓ 프로필 사진 완료"}):e.jsx("p",{className:"text-sm text-red-500 font-semibold",children:"프로필 사진을 업로드해주세요"})]}),e.jsxs("div",{className:"flex gap-3 pt-6",children:[e.jsx("button",{onClick:()=>x("/"),className:"flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors cursor-pointer font-semibold",children:"나중에"}),e.jsx("button",{onClick:async()=>{if(j||m.profile_image){l.info("프로필 저장",{uploadedImageUrl:j,profile_image:m.profile_image}),y(!0);try{const{user:e}=await s.users.findUserByPhoneNumber(m.phone_number);if(!e)return void alert("사용자를 찾을 수 없습니다.");const{error:a}=await s.users.updateUser(e.id,{mbti:m.mbti,location:m.location,bio:m.bio,school:m.school,job:m.job,height:m.height,body_type:m.body_type,style:m.style,religion:m.religion,smoking:m.smoking,drinking:m.drinking,interests:m.interests,profile_image:j||m.profile_image,avatar_url:j||m.profile_image});if(a)return alert("프로필 저장 실패: "+a.message),void l.error("저장 에러",a);alert("프로필이 완성되었습니다!"),x("/")}catch(e){alert("저장 중 오류: "+e.message)}finally{y(!1)}}else alert("프로필 사진을 업로드해주세요. (필수)")},disabled:g,className:"flex-1 px-4 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl hover:from-cyan-600 hover:to-blue-600 transition-colors disabled:opacity-50 cursor-pointer font-semibold",children:g?"저장 중...":"완성"})]})]})]})})}export{x as default};
